<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Zero&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Love Linux ♥ Love Python. 猴赛雷">
<meta property="og:type" content="website">
<meta property="og:title" content="Zero's Blog">
<meta property="og:url" content="http://czero000.github.io/page/8/index.html">
<meta property="og:site_name" content="Zero's Blog">
<meta property="og:description" content="Love Linux ♥ Love Python. 猴赛雷">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zero's Blog">
<meta name="twitter:description" content="Love Linux ♥ Love Python. 猴赛雷">
  
    <link rel="alternate" href="/atom.xml" title="Zero&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Zero&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">点滴分享 多彩生活</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://czero000.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-how-to-properly-configure-nginx-php" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/04/how-to-properly-configure-nginx-php.html" class="article-date">
  <time datetime="2016-02-04T08:33:07.000Z" itemprop="datePublished">2016-02-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/how-to-properly-configure-nginx-php.html">如何正确配置Nginx+PHP（转载）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<p>对很多人而言，配置Nginx+PHP无外乎就是搜索一篇教程，然后拷贝粘贴。听上去似乎也没什么问题，可惜实际上网络上很多资料本身年久失修，漏洞百出，如果大家不求甚解，一味的拷贝粘贴，早晚有一天会为此付出代价。</p>
<p>假设我们用PHP实现了一个前端控制器，或者直白点说就是统一入口：把PHP请求都发送到同一个文件上，然后在此文件里通过解析<code>REQUEST_URI</code>实现路由。</p>
<p>此时很多教程会教大家这样配置Nginx+PHP<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name foo.com;</div><div class="line"></div><div class="line">    root /path;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        index index.html index.htm index.php;</div><div class="line"></div><div class="line">        if (!-e $request_filename) &#123;</div><div class="line">            rewrite . /index.php last;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        include fastcgi_params;</div><div class="line">        fastcgi_param SCRIPT_FILENAME /path$fastcgi_script_name;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">        fastcgi_index index.php;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里面有很多错误，或者说至少是坏味道的地方，大家看看能发现几个。</p>
<p>我们有必要先了解一下Nginx配置文件里指令的继承关系：Nginx配置文件分为好多块，常见的从外到内依次是<code>http</code>、<code>server</code>、<code>location</code>等等，缺省的继承关系是从外到内，也就是说内层块会自动获取外层块的值作为缺省值（有例外，详见参考）。</p>
<p>参考：<a href="http://blog.martinfjordvald.com/2012/08/understanding-the-nginx-configuration-inheritance-model/" target="_blank" rel="external">UNDERSTANDING THE NGINX CONFIGURATION INHERITANCE MODEL</a></p>
<p>让我们先从<a href="http://nginx.org/en/docs/http/ngx_http_index_module.html#index" target="_blank" rel="external">index</a>」指令入手吧，在问题配置中它是在[location]中定义的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location / &#123;</div><div class="line">    index index.html index.htm index.php;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>一旦未来需要加入新的<code>[location]</code>，必然会出现重复定义的<code>index</code>指令，这是因为多个<code>location</code>是平级的关系，不存在继承，此时应该在<code>server</code>里定义<code>index</code>，借助继承关系，<code>index</code>指令在所有的<code>location</code>中都能生效。</p>
<p>参考：<a href="http://wiki.nginx.org/Pitfalls" target="_blank" rel="external">Nginx Pitfalls</a></p>
<p>接下来看看「<a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if" target="_blank" rel="external">if</a>」指令，说它是大家误解最深的Nginx指令毫不为过：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if (!-e $request_filename) &#123;</div><div class="line">    rewrite . /index.php last;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>很多人喜欢用「<a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if" target="_blank" rel="external">if</a>」指令做一系列的检查，不过这实际上是<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files" target="_blank" rel="external">try_files</a>」指令的职责<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">try_files $uri $uri/ /index.php;</div></pre></td></tr></table></figure></p>
<p>除此以外，初学者往往会认为<a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#if" target="_blank" rel="external">if</a>」指令是内核级的指令，但是实际上它是rewrite模块的一部分，加上Nginx配置实际上是声明式的，而非过程式的，所以当其和非rewrite模块的指令混用时，结果可能会非你所愿。</p>
<p>参考：<a href="http://wiki.nginx.org/IfIsEvil" target="_blank" rel="external">IfIsEvil</a> and <a href="http://agentzh.blogspot.com/2011/03/how-nginx-location-if-works.html" target="_blank" rel="external">How nginx “location if” works</a></p>
<p>下面看看「fastcgi_params」配置文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include fastcgi_params;</div></pre></td></tr></table></figure></p>
<p>Nginx有两份fastcgi配置文件，分别是<code>fastcgi_params</code>和<code>fastcgi.conf</code>，它们没有太大的差异，唯一的区别是后者比前者多了一行<code>SCRIPT_FILENAME</code>的定义：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</div></pre></td></tr></table></figure></p>
<p>注意：<code>$document_root 和 $fastcgi_script_name 之间没有 /</code>。</p>
<p>原本Nginx只有<code>fastcgi_params</code>，后来发现很多人在定义<code>SCRIPT_FILENAME</code>时使用了硬编码的方式，于是为了规范用法便引入了<code>fastcgi.conf</code>。</p>
<p>不过这样的话就产生一个疑问：为什么一定要引入一个新的配置文件，而不是修改旧的配置文件？这是因为「fastcgi_param」指令是数组型的，和普通指令相同的是：内层替换外层；和普通指令不同的是：当在同级多次使用的时候，是新增而不是替换。换句话说，如果在同级定义两次「SCRIPT_FILENAME」，那么它们都会被发送到后端，这可能会导致一些潜在的问题，为了避免此类情况，便引入了一个新的配置文件。</p>
<p>参考：<a href="http://blog.martinfjordvald.com/2013/04/nginx-config-history-fastcgi_params-versus-fastcgi-conf/" target="_blank" rel="external">FASTCGI_PARAMS VERSUS FASTCGI.CONF – NGINX CONFIG HISTORY</a></p>
<p>此外，我们还需要考虑一个安全问题：在PHP开启「cgi.fix_pathinfo」的情况下，PHP可能会把错误的文件类型当作PHP文件来解析。如果Nginx和PHP安装在同一台服务器上的话，那么最简单的解决方法是用<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files" target="_blank" rel="external">try_files</a>指令做一次过滤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">try_files $uri =404;</div></pre></td></tr></table></figure>
<p>参考：<a href="http://www.80sec.com/nginx-securit.html" target="_blank" rel="external">Nginx文件类型错误解析漏洞</a></p>
<p>依照前面的分析，给出一份改良后的版本，是不是比开始的版本清爽了很多：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name foo.com;</div><div class="line"></div><div class="line">    root /path;</div><div class="line">    index index.html index.htm index.php;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ /index.php$is_args$args;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        try_files $uri =404;</div><div class="line"></div><div class="line">        include fastcgi.conf;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>实际上还有一些瑕疵，主要是<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files" target="_blank" rel="external">try_files</a>和<a href="http://wiki.nginx.org/HttpFastcgiModule#fastcgi_split_path_info" target="_blank" rel="external">fastcgi_split_path_info</a>不够兼容，虽然能够解决，但方案比较丑陋，具体就不多说了，有兴趣的可以参考<a href="http://trac.nginx.org/nginx/ticket/321" target="_blank" rel="external">问题描述</a>。</p>
<p>补充：因为<code>location</code>已经做了限定，所以<code>fastcgi_index</code>其实也没有必要。</p>
<p>希望大家以后不要再拷贝粘贴了，如果实在改不了，那么就请拷贝粘贴本文。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/04/how-to-properly-configure-nginx-php.html" data-id="civlqiud600gic15mxya2grbo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-php-fpm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/04/nginx-php-fpm.html" class="article-date">
  <time datetime="2016-02-04T08:01:39.000Z" itemprop="datePublished">2016-02-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/nginx-php-fpm.html">Nginx+PHP-FPM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Nginx-PHP-FPM-FastCGI-Process-Manager"><a href="#Nginx-PHP-FPM-FastCGI-Process-Manager" class="headerlink" title="Nginx + PHP-FPM(FastCGI Process Manager)"></a>Nginx + PHP-FPM(FastCGI Process Manager)</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Apache的效率和承载能力受到大多人的诟病，Nginx 藉由 Nob-blocking 与 epool 这些特性，大幅提高了并发数和处理速度，愈发收到人们的喜爱，但由于 Nginx 本身只是单纯的 HTTP Server，如果执行 php，需要配合 CGI 来完成，Nginx 把请求转发给 fastcig 管理进程，处理之后在将结果返回给 Nginx。</p>
<h3 id="什么是-PHP-FPM"><a href="#什么是-PHP-FPM" class="headerlink" title="什么是 PHP-FPM"></a>什么是 PHP-FPM</h3><p>相对于 Spawn-FCGI，PHP-FPM 在内存和CPU方面的控制更胜一筹，PHP-FPM 提供了更好的PHP进程管理方式。PHP-FPM 对于 PHP5.3 之前来说就是一个补丁，将 FastCGI 进程管理整合到PHP中，在 PHP 5.4 之后，PHP-FPM 已经集成到 PHP 的软件包中，在编译 PHP 过程中，增加 <code>--enable-fpm</code> 参数即可开启 PHP-FPM</p>
<h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h3><p>本文的安装环境采用：<code>CentOS Linux release 7.1.1503 (Core)</code></p>
<h3 id="软件获取"><a href="#软件获取" class="headerlink" title="软件获取"></a>软件获取</h3><ul>
<li>Nginx</li>
</ul>
<p>官方网站：<a href="http://nginx.org" target="_blank" rel="external">http://nginx.org</a><br>最新稳定版本：<a href="http://nginx.org/download/nginx-1.8.1.tar.gz" target="_blank" rel="external">nginx-1.8.1.tar.gz</a><br>帮助文档：<a href="http://nginx.org/en/docs" target="_blank" rel="external">http://nginx.org/en/docs</a><br>编译参数说明：<a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="external">http://nginx.org/en/docs/configure.html</a></p>
<ul>
<li>PHP</li>
</ul>
<p>官方网站：<a href="http://www.php.net" target="_blank" rel="external">http://www.php.net</a><br>稳定版：<a href="http://cn2.php.net/distributions/php-5.6.17.tar.gz" target="_blank" rel="external">php-5.6.17.tar.gz</a></p>
<ul>
<li>软件仓库</li>
</ul>
<p>yum 仓库包含 CentOS 官方和 EPEL 两个安装源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://mirrors.yun-idc.com/epel/7/x86_64/e/epel-release-7-5.noarch.rpm</div></pre></td></tr></table></figure></p>
<h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><h3 id="安装模块依赖包"><a href="#安装模块依赖包" class="headerlink" title="安装模块依赖包"></a>安装模块依赖包</h3><p>Nginx 的 gzip、rewrite、ssl 模块分别需要 zlib、pcre、openssl 的支持，可以通过源码或 yum 工具来安装</p>
<ul>
<li>安装zlib</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 使用 gzip 压缩</div><div class="line">yum install zlib zlib-devel -y</div></pre></td></tr></table></figure>
<ul>
<li>安装 pcre</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 使用 rewrite 功能</div><div class="line">yum install pcre pcre-devel</div></pre></td></tr></table></figure>
<ul>
<li>安装 openssl</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 如果需要 ssl 支持,不需要可以不安装</div><div class="line">yum install openssl openssl-devel</div></pre></td></tr></table></figure>
<h3 id="安装-Nginx-1"><a href="#安装-Nginx-1" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget http://nginx.org/download/nginx-1.8.1.tar.gz</div><div class="line">tar zxf nginx-1.8.1.tar.gz</div><div class="line">./configure --prefix=/usr/local/nginx --with-http_ssl_module  --with-http_stub_status_module --with-pcre</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="启动-Nginx，测试安装"><a href="#启动-Nginx，测试安装" class="headerlink" title="启动 Nginx，测试安装"></a>启动 Nginx，测试安装</h3><p>Nginx 的默认端口是 80，启动之前要确保 80 端口没有被占用，如果想保留 80 端口，只需要在 Nginx 配置文件中，<code>listen 80；</code>中80换成其他端口。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//启动 nginx</div><div class="line">/usr/local/nginx/sbin/nginx</div><div class="line"></div><div class="line">// 检查80端口是否启动</div><div class="line">netstat -ntpl</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </div><div class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      28608/nginx: master </div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      917/sshd            </div><div class="line">tcp6       0      0 :::22                   :::*                    LISTEN      917/sshd</div></pre></td></tr></table></figure></p>
<p>通过浏览器访问 Nginx Server 会出现欢迎页面，说明 nginx  安装正常</p>
<h2 id="安装-PHP-及-PHP-FPM"><a href="#安装-PHP-及-PHP-FPM" class="headerlink" title="安装 PHP 及 PHP-FPM"></a>安装 PHP 及 PHP-FPM</h2><ul>
<li>安装依赖软件包</li>
</ul>
<p>确保安装之前有安装 gd、png、curl、xml 等 lib 开发库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install gd-devel libjpeg-devel libpng-devel libxml2-devel bzip2-devel libcurl-devel -y</div></pre></td></tr></table></figure></p>
<ul>
<li>下载软件包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://cn2.php.net/distributions/php-5.6.17.tar.gz</div><div class="line">tar zxf php-5.6.17.tar.gz </div><div class="line">cd php-5.6.17/</div></pre></td></tr></table></figure>
<ul>
<li>编译安装 php5.6</li>
</ul>
<p>以下参数支持，ftp、图片函数、pdo 等，因为使用了 php 自带的 mysqlnd，所以不需要额外安装 mysql 的 lib 库，如果是 64 位系统，参数后面需要添加 –wtih-libdir=lib64<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-bz2 --with-curl --enable-ftp --enable-sockets --disable-ipv6 --with-gd --with-jpeg-dir=/usr/local --with-png-dir=/usr/local --with-freetype-dir=/usr/local --enable-gd-native-ttf --with-iconv-dir=/usr/local --enable-mbstring --enable-calendar --with-gettext --with-libxml-dir=/usr/local --with-zlib --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd --with-mysql=mysqlnd --enable-dom --enable-xml --enable-fpm --with-libdir=lib64</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure></p>
<p>注： 编译参数可以根据实际需求，增加或者删减</p>
<ul>
<li>配置 php-fpm</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp php.ini-production /usr/local/php/etc/php.ini</div><div class="line">cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</div></pre></td></tr></table></figure>
<ul>
<li>启动 PHP-FPM</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">systemctl start php-fpm</div><div class="line"></div><div class="line">// init方式</div><div class="line">cp /usr/local/src/php-5.6.17/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</div><div class="line">chmod +x /etc/init.d/php-fpm</div><div class="line">/etc/init.d/php-fpm start</div><div class="line"></div><div class="line">//执行没有报错，说明启动成功，还可以通过端口检查服务是否启动,9000 端口是 fpm 的服务端口</div><div class="line">netstat -ntpl</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </div><div class="line">tcp        0      0 127.0.0.1:9000              0.0.0.0:*                   LISTEN      23723/php-fpm       </div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1423/sshd           </div><div class="line">tcp        0      0 :::22                       :::*                        LISTEN      1423/sshd</div></pre></td></tr></table></figure>
<h2 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h2><h3 id="nginx主配置文件"><a href="#nginx主配置文件" class="headerlink" title="nginx主配置文件"></a>nginx主配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">cat nginx.conf</div><div class="line">user  nobody;</div><div class="line">worker_processes  8;  </div><div class="line">worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 1000000;</div><div class="line">worker_rlimit_nofile 65535;</div><div class="line"></div><div class="line">error_log  logs/error.log  notice;</div><div class="line">#error_log  logs/error.log  info;</div><div class="line"></div><div class="line">pid        logs/nginx.pid;</div><div class="line"></div><div class="line">events &#123;</div><div class="line">    use epoll;</div><div class="line">    worker_connections  10240;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    server_names_hash_bucket_size 128;</div><div class="line">    client_header_buffer_size 32k;</div><div class="line">    client_body_buffer_size 32k;</div><div class="line">    client_max_body_size 8m; </div><div class="line">    large_client_header_buffers 4 32k;</div><div class="line">    </div><div class="line">    log_format access  &apos;$http_host $remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot;&apos;;</div><div class="line"></div><div class="line">    index index.php index.html;</div><div class="line">    autoindex off;</div><div class="line">    fastcgi_intercept_errors on;</div><div class="line">    #access_log  logs/access.log  main;</div><div class="line"></div><div class="line">    sendfile        on;</div><div class="line">    tcp_nopush     on;</div><div class="line">    tcp_nodelay    off;</div><div class="line"></div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    fastcgi_connect_timeout 300;</div><div class="line">    fastcgi_send_timeout 300;</div><div class="line">    fastcgi_read_timeout 300;</div><div class="line">    fastcgi_buffer_size 64k;</div><div class="line">    fastcgi_buffers 4 64k;</div><div class="line">    fastcgi_busy_buffers_size 128k;</div><div class="line">    fastcgi_temp_file_write_size 128k;</div><div class="line"></div><div class="line">    gzip  on;</div><div class="line">    gzip_min_length 1k;</div><div class="line">    gzip_http_version 1.0;</div><div class="line">    gzip_comp_level 2;</div><div class="line">    gzip_buffers  4 16k;</div><div class="line">    gzip_proxied any;</div><div class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;</div><div class="line">    gzip_types  text/plain text/css application/x-javascript application/xml application/xml+rss text/javascript;</div><div class="line">    gzip_vary on;</div><div class="line">    server_name_in_redirect off;</div><div class="line">    include /usr/local/nginx/conf/vhost/*.conf;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="虚拟主机配置文件"><a href="#虚拟主机配置文件" class="headerlink" title="虚拟主机配置文件"></a>虚拟主机配置文件</h3><p>增加测试站点www.zerounix.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name www.zerounix.com;</div><div class="line">    root /data/website/www.zerounix.com;</div><div class="line">    charset utf-8;</div><div class="line">    index index.php index.html index.htm ;</div><div class="line">    access_log  logs/www.zerounix.com_access.log access;</div><div class="line">    error_log   logs/www.zerounix.com_error.log;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ /index.php$is_args$args;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ .*\.(php|php5)$ &#123;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">        include        fastcgi.conf;</div><div class="line">        try_files $uri =404;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Nginx 将会连接回环地址 9000 端口执行 php 文件，需要使用 tcp/ip 协议，速度较慢，建议设置为 socket 方式连接。将 <code>fastcgi_pass 127.0.0.1:9000</code> 变更为 <code>fastcgi_pass unix:/dev/shm/php-fpm.socket</code>; 同时变更 php-fpm 配置文件，在 <code>listen = 127.0.0.1:9000</code> 添加 <code>listen = /dev/shm/php5-fpm.socket</code>;分别重启 <code>nginx</code> 和 <code>php-fpm</code> 服务</p>
<h3 id="启动-Nginx"><a href="#启动-Nginx" class="headerlink" title="启动 Nginx"></a>启动 Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx</div></pre></td></tr></table></figure>
<h3 id="创建-PHP-测试文件"><a href="#创建-PHP-测试文件" class="headerlink" title="创建 PHP 测试文件"></a>创建 PHP 测试文件</h3><p>在<code>/data/website/www.zerounix.com/phpinfo.php</code> 添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">var_export($_SERVER)</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
<h3 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">curl -x 172.16.11.210:80 www.zerounix.com/phpinfo.php</div><div class="line">array (</div><div class="line">  &apos;USER&apos; =&gt; &apos;nobody&apos;,</div><div class="line">  &apos;HOME&apos; =&gt; &apos;/&apos;,</div><div class="line">  &apos;FCGI_ROLE&apos; =&gt; &apos;RESPONDER&apos;,</div><div class="line">  &apos;SCRIPT_FILENAME&apos; =&gt; &apos;/data/website/www.zerounix.com/phpinfo.php&apos;,</div><div class="line">  &apos;QUERY_STRING&apos; =&gt; &apos;&apos;,</div><div class="line">  &apos;REQUEST_METHOD&apos; =&gt; &apos;GET&apos;,</div><div class="line">  &apos;CONTENT_TYPE&apos; =&gt; &apos;&apos;,</div><div class="line">  &apos;CONTENT_LENGTH&apos; =&gt; &apos;&apos;,</div><div class="line">  &apos;SCRIPT_NAME&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;REQUEST_URI&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;DOCUMENT_URI&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;DOCUMENT_ROOT&apos; =&gt; &apos;/data/website/www.zerounix.com&apos;,</div><div class="line">  &apos;SERVER_PROTOCOL&apos; =&gt; &apos;HTTP/1.1&apos;,</div><div class="line">  &apos;GATEWAY_INTERFACE&apos; =&gt; &apos;CGI/1.1&apos;,</div><div class="line">  &apos;SERVER_SOFTWARE&apos; =&gt; &apos;nginx/1.8.1&apos;,</div><div class="line">  &apos;REMOTE_ADDR&apos; =&gt; &apos;172.16.11.210&apos;,</div><div class="line">  &apos;REMOTE_PORT&apos; =&gt; &apos;55060&apos;,</div><div class="line">  &apos;SERVER_ADDR&apos; =&gt; &apos;172.16.11.210&apos;,</div><div class="line">  &apos;SERVER_PORT&apos; =&gt; &apos;80&apos;,</div><div class="line">  &apos;SERVER_NAME&apos; =&gt; &apos;www.zerounix.com&apos;,</div><div class="line">  &apos;REDIRECT_STATUS&apos; =&gt; &apos;200&apos;,</div><div class="line">  &apos;HTTP_USER_AGENT&apos; =&gt; &apos;curl/7.29.0&apos;,</div><div class="line">  &apos;HTTP_HOST&apos; =&gt; &apos;www.zerounix.com&apos;,</div><div class="line">  &apos;HTTP_ACCEPT&apos; =&gt; &apos;*/*&apos;,</div><div class="line">  &apos;HTTP_PROXY_CONNECTION&apos; =&gt; &apos;Keep-Alive&apos;,</div><div class="line">  &apos;PHP_SELF&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;REQUEST_TIME_FLOAT&apos; =&gt; 1454568561.60866,</div><div class="line">  &apos;REQUEST_TIME&apos; =&gt; 1454568561,</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>说明 php 解析正常</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Nginx 安装配置相对容易，但是要调优就是另外一件事了，如果设定的不恰当，在高并发的时候，经常会出现 502 Bad Gateway。之后会研究下调优的为问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/04/nginx-php-fpm.html" data-id="civlqiuco00g3c15m70h5ljdz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php-fpm/">php-fpm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-configfile-detail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/04/nginx-configfile-detail.html" class="article-date">
  <time datetime="2016-02-04T07:59:49.000Z" itemprop="datePublished">2016-02-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/nginx-configfile-detail.html">Nginx配置文件详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="nginx-主配置文件详解"><a href="#nginx-主配置文件详解" class="headerlink" title="nginx 主配置文件详解"></a>nginx 主配置文件详解</h2><p>安装 nginx 后，会在安装目录下生成 conf 目录，目录中 <code>nginx.conf</code> 便是 nginx 的主配置文件，nginx 是基于模块化的构建方式，在 ningx 配置文件中也有体现，可以分为核心模块、事件模块、邮件模块、HTTP 模块。</p>
<h3 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">user  nobody;                                // 指定 nginx 运行的用户和组，默认为 nobody</div><div class="line">worker_processes  8;                         // 开启 nginx 的进程数，与 cpu 核数一致</div><div class="line">worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 1000000; // 将每个 nginx 进程绑定到一个CPU上</div><div class="line">worker_rlimit_nofile 65535;                  // 指定 nginx 进程打开的最多文件描述符数量，受系统的最大文件打开数限制</div><div class="line"></div><div class="line">error_log  logs/error.log;  notice;          // 设定全局错误日志文件，以什么级别显示，有 [debug、info、warn、error、crit] 模式可选，按照实际情况设定</div><div class="line">#error_log  logs/error.log  info;            </div><div class="line"></div><div class="line">pid        logs/nginx.pid;                   // 指定进程 id 的存储文件位置</div></pre></td></tr></table></figure>
<h3 id="事件模块"><a href="#事件模块" class="headerlink" title="事件模块"></a>事件模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">events &#123;</div><div class="line">    use epoll;	                             // 工作模式设定为 epoll，还有 select、poll、kqueue、rtsig 和 /dev/poll 模式可选</div><div class="line">    worker_connections  65535;                // 定义每个进程的最大连接数，受系统的最大文件打开数限制</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="http-模块"><a href="#http-模块" class="headerlink" title="http 模块"></a>http 模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">    include       mime.types;                             // 文件拓展名与文件类型映射表 </div><div class="line">    default_type  application/octet-stream;               // 默认文件类型 </div><div class="line">    charset utf-8;                                        // 默认编码</div><div class="line">   #autoindex on ;                                        // 关闭目录别表访问，默认关闭</div><div class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;    // 设置日志格式</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line">  </div><div class="line">    access_log  logs/access.log  main;                                 </div><div class="line">   </div><div class="line">    sendfile        on;                                   //开启高效文件传输模式，如果进行下载等磁盘 IO 重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成 off。</div><div class="line">    #tcp_nopush     on;                                   // 开启防止网络阻塞</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;                                // 设置客户端连接报错活动的超时时间</div><div class="line">    tcp_nodelay         on;</div><div class="line">    </div><div class="line">    </div><div class="line">    // 反向代理设置</div><div class="line">    proxy_connect_timeout 30;                           </div><div class="line">    proxy_send_timeout 30;</div><div class="line">    proxy_read_timeout 30;</div><div class="line">    proxy_buffer_size 32k;</div><div class="line">    proxy_buffers 4 64k;</div><div class="line">    proxy_busy_buffers_size 128k;</div><div class="line">    proxy_temp_file_write_size 128k;</div><div class="line">    proxy_ignore_client_abort on;</div><div class="line">    proxy_headers_hash_max_size 51200;</div><div class="line">    proxy_headers_hash_bucket_size 6400;</div><div class="line">    proxy_set_header  Host              $host;</div><div class="line">    proxy_set_header  X-Real-IP         $remote_addr;     </div><div class="line">    proxy_set_header  x-forwarded-for   $proxy_add_x_forwarded_for; //后端的Web服务器可以通过 X-Forwarded-For 获取用户真实IP</div><div class="line"></div><div class="line">    server_names_hash_bucket_size 128;                  // 服务器名字的 hash 表大小</div><div class="line">    client_header_buffer_size 32k;                      // 指定 client 请求头的 hearder buffers 大小</div><div class="line">    large_client_header_buffers 4 32k;                  // 大请求缓冲区数量和大小</div><div class="line">    client_max_body_size 8m;                            // 设置 client 请求的最大单个文件字节数</div><div class="line">    client_body_temp_path /dev/shm/client_body_temp;    // 指定连接请求试图写入缓存文件的目录路径</div><div class="line"> </div><div class="line"> </div><div class="line"> // FastCGI 相关参数设定</div><div class="line">    fastcgi_connect_timeout 300;</div><div class="line">    fastcgi_send_timeout 300;</div><div class="line">    fastcgi_read_timeout 300;</div><div class="line">    fastcgi_buffer_size 64k;</div><div class="line">    fastcgi_buffers 4 64k;</div><div class="line">    fastcgi_busy_buffers_size 128k;</div><div class="line">    fastcgi_temp_file_write_size 128k;</div><div class="line">    </div><div class="line">// Gzip 相关参数设定    </div><div class="line">    gzip  on;                                             // 开启 gzip 压缩</div><div class="line">    gzip_min_length 1k;                                   // 设置允许压缩的页面最小字节</div><div class="line">    gzip_http_version 1.0;                                // 设置识别 http 协议的版本，默认是 1.1</div><div class="line">    gzip_comp_level 2;                                    // 设置压缩比，1-9</div><div class="line">    gzip_buffers  4 16k;                                  // 设置 4 个单位 16k 的内存作为压缩结果流缓存 </div><div class="line">    gzip_proxied any;                                     // nginx 做前端代理时启用该选项，表示无论后端服务器的 headers 头返回什么信息，都无条件启用压缩</div><div class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;                          // 禁用 IE1-6 的 gzip 压缩</div><div class="line">    gzip_types  text/plain text/css application/x-javascript application/xml application/xml+rss text/javascript;  // 什么类型的页面或文档启用压缩</div><div class="line">    gzip_vary on;</div><div class="line">    server_name_in_redirect off;                          // nginx 在处理自己内部重定向时不默认使用 server_name 设置中的第一个域名</div><div class="line">    </div><div class="line">    include vhost/*.conf;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="虚拟主机文件"><a href="#虚拟主机文件" class="headerlink" title="虚拟主机文件"></a>虚拟主机文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;                                              // 监听端口</div><div class="line">        server_name  www.zerounix.com                           // 域名，可以多个，用空格分隔</div><div class="line">        root /data/htdocs/www.zerounix.com;                  // 虚拟主机根目录</div><div class="line">        charset uft-8;                                         // 访问编码</div><div class="line">        access_log  logs/www.zerounix.com_access.log access;   //设置虚拟主机访问日志的存放路径和格式main</div><div class="line">        error_log   logs/www.zerounix.com_error.log;            // 错误日志</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">          index index.php index.htm                          // 甚至首页索引文件类型</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        error_page  404              /404.html;              // 定义 404 页面</div><div class="line"></div><div class="line">        error_page   500 502 503 504  /50x.html;             // 定义 50x 页面</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        </div><div class="line">        </div><div class="line">        // php 请求转发到本地 9000，交给 fastcig 处理</div><div class="line">        location ~.*\.(php|php5)?$ &#123;</div><div class="line">          fastcgi_pass   127.0.0.1:9000;</div><div class="line">          fastcgi_index  index.php;</div><div class="line">          fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">          include        fastcgi_params;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // 设置 nginx status 页面</div><div class="line">        location /status &#123;                                     </div><div class="line">           stub_status on; </div><div class="line">           access_log logs/www.zerounix.com_status.log;</div><div class="line">           auth_basic &quot;NginxStatus&quot;</div><div class="line">           auth_baaic_user_file conf/htpasswd;                // apache 提供的 htpasswd 工具</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // 图片缓存时间</div><div class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|sfw)$ &#123;             </div><div class="line">          expires 10d;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // JS 和 CSS 缓存时间</div><div class="line">        location ~ .*\.&#123;js|css&#125;$ &#123;</div><div class="line">          expires 1h;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        //所有静态文件由nginx直接读取不经过 tomcat 或 resin</div><div class="line">        location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ &#123; </div><div class="line">          expires 15d; </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">       </div><div class="line">        // 本地动静分离反向代理配置，所有 jsp 的页面均交由 tomcat 或 resin 处理</div><div class="line">        location ~ .(jsp|jspx|do)?$ &#123;</div><div class="line">          proxy_set_header Host $host;</div><div class="line">          proxy_set_header X-Real-IP $remote_addr;</div><div class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">          proxy_pass http://127.0.0.1:8080;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        #对 &quot;/&quot; 启用反向代理</div><div class="line">     	location / &#123;</div><div class="line">  proxy_pass	http://18.26.154.72:8090;</div><div class="line">          proxy_redirect off;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/04/nginx-configfile-detail.html" data-id="civlqiuck00fvc15m3skv5jnn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-compiler-parameters" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/04/nginx-compiler-parameters.html" class="article-date">
  <time datetime="2016-02-04T07:55:26.000Z" itemprop="datePublished">2016-02-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/nginx-compiler-parameters.html">Nginx编译参数详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>编译参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>–prefix=</td>
<td>指向安装目录</td>
</tr>
<tr>
<td>–sbin-path</td>
<td>指向（执行）程序文件（nginx）</td>
</tr>
<tr>
<td>–conf-path=</td>
<td>指向配置文件（nginx.conf）</td>
</tr>
<tr>
<td>–error-log-path=</td>
<td>指向错误日志目录</td>
</tr>
<tr>
<td>–pid-path=</td>
<td>指向 pid 文件（nginx.pid）</td>
</tr>
<tr>
<td>–lock-path=</td>
<td>指向 lock 文件（nginx.lock）（安装文件锁定，防止安装文件被别人利用，或自己误操作）</td>
</tr>
<tr>
<td>–user=</td>
<td>指定程序运行时的非特权用户</td>
</tr>
<tr>
<td>–group=</td>
<td>指定程序运行时的非特权用户组</td>
</tr>
<tr>
<td>–builddir=</td>
<td>指向编译目录</td>
</tr>
<tr>
<td>–with-rtsig_module</td>
<td>启用 rtsig 模块支持（实时信号）</td>
</tr>
<tr>
<td>–with-select_module</td>
<td>启用 select 模块支持（一种轮询模式,不推荐在高载环境下使用）禁用：–without-select_module</td>
</tr>
<tr>
<td>–with-poll_module</td>
<td>启用 poll 模块支持（功能与 select 相同，与select特性相同，为一种轮询模式,不推荐在高载环境下使用）</td>
</tr>
<tr>
<td>–with-file-aio</td>
<td>启用 file aio 支持（一种APL文件传输格式）</td>
</tr>
<tr>
<td>–with-ipv6</td>
<td>启用ipv6支持</td>
</tr>
<tr>
<td>–with-http_ssl_module</td>
<td>启用ngx_http_ssl_module支持（使支持https请求，需已安装openssl）</td>
</tr>
<tr>
<td>–with-http_realip_module</td>
<td>启用ngx_http_realip_module支持（这个模块允许从请求标头更改客户端的IP地址值，默认为关）</td>
</tr>
<tr>
<td>–with-http_addition_module</td>
<td>启用ngx_http_addition_module支持（作为一个输出过滤器，支持不完全缓冲，分部分响应请求）</td>
</tr>
<tr>
<td>–with-http_xslt_module</td>
<td>启用ngx_http_xslt_module支持（过滤转换XML请求）</td>
</tr>
<tr>
<td>–with-http_image_filter_module</td>
<td>启用 ngx_http_image_filter_module支持（传输JPEG/GIF/PNG 图片的一个过滤器）（默认为不启用。gd库要用到）</td>
</tr>
<tr>
<td>–with-http_geoip_module</td>
<td>启用 ngx_http_geoip_module支持（该模块创建基于与MaxMind GeoIP二进制文件相配的客户端IP地址的ngx_http_geoip_module变量）</td>
</tr>
<tr>
<td>–with-http_sub_module</td>
<td>启用 ngx_http_sub_module支持（允许用一些其他文本替换nginx响应中的一些文本）</td>
</tr>
<tr>
<td>–with-http_dav_module</td>
<td>启用 ngx_http_dav_module支持（增加PUT,DELETE,MKCOL：创建集合,COPY和MOVE方法）默认情况下为关闭，需编译开启</td>
</tr>
<tr>
<td>–with-http_flv_module</td>
<td>启用 ngx_http_flv_module支持（提供寻求内存使用基于时间的偏移量文件）</td>
</tr>
<tr>
<td>–with-http_gzip_static_module</td>
<td>启用 ngx_http_gzip_static_module支持（在线实时压缩输出数据流）</td>
</tr>
<tr>
<td>–with-http_random_index_module</td>
<td>启用ngx_http_random_index_module支持（从目录中随机挑选一个目录索引）</td>
</tr>
<tr>
<td>–with-http_secure_link_module</td>
<td>启用ngx_http_secure_link_module支持（计算和检查要求所需的安全链接网址）</td>
</tr>
<tr>
<td>–with-http_degradation_module</td>
<td>启用ngx_http_degradation_module支持（允许在内存不足的情况下返回204或444码）</td>
</tr>
<tr>
<td>–with-http_stub_status_module</td>
<td>启用ngx_http_stub_status_module支持（获取nginx自上次启动以来的工作状态） –without-http_charset_module 禁用ngx_http_charset_module支持（重新编码web页面，但只能是一个方向–服务器端到客户端，并且只有一个字节的编码可以被重新编码）</td>
</tr>
<tr>
<td>–without-http_gzip_module</td>
<td>禁用ngx_http_gzip_module支持（该模块同-with-http_gzip_static_module功能一样）</td>
</tr>
<tr>
<td>–without-http_ssi_module</td>
<td>禁用ngx_http_ssi_module支持（该模块提供了一个在输入端处理处理服务器包含文件（SSI）的过滤器，目前支持SSI命令的列表是不完整的）</td>
</tr>
<tr>
<td>–without-http_userid_module</td>
<td>禁用ngx_http_userid_module支持（该模块用来处理用来确定客户端后续请求的cookies）</td>
</tr>
<tr>
<td>–without-http_access_module</td>
<td>禁用ngx_http_access_module支持（该模块提供了一个简单的基于主机的访问控制。允许/拒绝基于ip地址）</td>
</tr>
<tr>
<td>–without-http_auth_basic_module</td>
<td>禁用ngx_http_auth_basic_module（该模块是可以使用用户名和密码基于http基本认证方法来保护你的站点或其部分内容）</td>
</tr>
<tr>
<td>–without-http_autoindex_module</td>
<td>禁用disable ngx_http_autoindex_module支持（该模块用于自动生成目录列表，只在ngx_http_index_module模块未找到索引文件时发出请求。）</td>
</tr>
<tr>
<td>–without-http_geo_module</td>
<td>禁用ngx_http_geo_module支持（创建一些变量，其值依赖于客户端的IP地址）</td>
</tr>
<tr>
<td>–without-http_map_module</td>
<td>禁用ngx_http_map_module支持（使用任意的键/值对设置配置变量）</td>
</tr>
<tr>
<td>–without-http_split_clients_module</td>
<td>禁用ngx_http_split_clients_module支持（该模块用来基于某些条件划分用户。条件如：ip地址、报头、cookies等等）</td>
</tr>
<tr>
<td>–without-http_referer_module</td>
<td>禁用disable ngx_http_referer_module支持（该模块用来过滤请求，拒绝报头中Referer值不正确的请求）</td>
</tr>
<tr>
<td>–without-http_rewrite_module</td>
<td>禁用ngx_http_rewrite_module支持（该模块允许使用正则表达式改变URI，并且根据变量来转向以及选择配置。如果在server级别设置该选项，那么他们将在 location之前生效。如果在location还有更进一步的重写规则，location部分的规则依然会被执行。如果这个URI重写是因为location部分的规则造成的，那么 location部分会再次被执行作为新的URI。 这个循环会执行10次，然后Nginx会返回一个500错误。）</td>
</tr>
<tr>
<td>–without-http_proxy_module</td>
<td>禁用ngx_http_proxy_module支持（有关代理服务器）</td>
</tr>
<tr>
<td>–without-http_fastcgi_module</td>
<td>禁用ngx_http_fastcgi_module支持（该模块允许Nginx 与FastCGI 进程交互，并通过传递参数来控制FastCGI 进程工作。 ）FastCGI一个常驻型的公共网关接口。</td>
</tr>
<tr>
<td>–without-http_uwsgi_module</td>
<td>禁用ngx_http_uwsgi_module支持（该模块用来医用uwsgi协议，uWSGI服务器相关）</td>
</tr>
<tr>
<td>–without-http_scgi_module</td>
<td>禁用ngx_http_scgi_module支持（该模块用来启用SCGI协议支持，SCGI协议是CGI协议的替代。它是一种应用程序与HTTP服务接口标准。它有些像FastCGI但他的设计 更容易实现。）</td>
</tr>
<tr>
<td>–without-http_memcached_module</td>
<td>禁用ngx_http_memcached_module支持（该模块用来提供简单的缓存，以提高系统效率）</td>
</tr>
<tr>
<td>-without-http_limit_zone_module</td>
<td>禁用ngx_http_limit_zone_module支持（该模块可以针对条件，进行会话的并发连接数控制）</td>
</tr>
<tr>
<td>–without-http_limit_req_module</td>
<td>禁用ngx_http_limit_req_module支持（该模块允许你对于一个地址进行请求数量的限制用一个给定的session或一个特定的事件）</td>
</tr>
<tr>
<td>–without-http_empty_gif_module</td>
<td>禁用ngx_http_empty_gif_module支持（该模块在内存中常驻了一个1*1的透明GIF图像，可以被非常快速的调用）</td>
</tr>
<tr>
<td>–without-http_browser_module</td>
<td>禁用ngx_http_browser_module支持（该模块用来创建依赖于请求报头的值。如果浏览器为modern ，则$modern_browser等于modern_browser_value指令分配的值；如 果浏览器为old，则$ancient_browser等于 ancient_browser_value指令分配的值；如果浏览器为 MSIE中的任意版本，则 $msie等于1）</td>
</tr>
<tr>
<td>–without-http_upstream_ip_hash_module</td>
<td>禁用ngx_http_upstream_ip_hash_module支持（该模块用于简单的负载均衡）</td>
</tr>
<tr>
<td>–with-http_perl_module</td>
<td>启用ngx_http_perl_module支持（该模块使nginx可以直接使用perl或通过ssi调用perl）</td>
</tr>
<tr>
<td>–with-perl_modules_path=</td>
<td>设定perl模块路径</td>
</tr>
<tr>
<td>–with-perl=</td>
<td>设定perl库文件路径</td>
</tr>
<tr>
<td>–http-log-path=</td>
<td>设定access log路径</td>
</tr>
<tr>
<td>–http-client-body-temp-path=</td>
<td>设定http客户端请求临时文件路径</td>
</tr>
<tr>
<td>–http-proxy-temp-path=</td>
<td>设定http代理临时文件路径</td>
</tr>
<tr>
<td>–http-fastcgi-temp-path=</td>
<td>设定http fastcgi临时文件路径</td>
</tr>
<tr>
<td>–http-uwsgi-temp-path=</td>
<td>设定http uwsgi临时文件路径</td>
</tr>
<tr>
<td>–http-scgi-temp-path=</td>
<td>设定http scgi临时文件路径</td>
</tr>
<tr>
<td>-without-http</td>
<td>禁用http server功能</td>
</tr>
<tr>
<td>–without-http-cache</td>
<td>禁用http cache功能</td>
</tr>
<tr>
<td>–with-mail</td>
<td>启用POP3/IMAP4/SMTP代理模块支持</td>
</tr>
<tr>
<td>–with-mail_ssl_module</td>
<td>启用ngx_mail_ssl_module支持</td>
</tr>
<tr>
<td>–without-mail_pop3_module</td>
<td>禁用pop3协议（POP3即邮局协议的第3个版本,它是规定个人计算机如何连接到互联网上的邮件服务器进行收发邮件的协议。是因特网电子邮件的第一个离线协议标 准,POP3协议允许用户从服务器上把邮件存储到本地主机上,同时根据客户端的操作删除或保存在邮件服务器上的邮件。POP3协议是TCP/IP协议族中的一员，主要用于 支持使用客户端远程管理在服务器上的电子邮件）</td>
</tr>
<tr>
<td>–without-mail_imap_module</td>
<td>禁用imap协议（一种邮件获取协议。它的主要作用是邮件客户端可以通过这种协议从邮件服务器上获取邮件的信息，下载邮件等。IMAP协议运行在TCP/IP协议之上， 使用的端口是143。它与POP3协议的主要区别是用户可以不用把所有的邮件全部下载，可以通过客户端直接对服务器上的邮件进行操作。）</td>
</tr>
<tr>
<td>–without-mail_smtp_module</td>
<td>禁用smtp协议（SMTP即简单邮件传输协议,它是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。SMTP协议属于TCP/IP协议族，它帮助每台计算机在发送或中转信件时找到下一个目的地。）</td>
</tr>
<tr>
<td>–with-google_perftools_module</td>
<td>启用ngx_google_perftools_module支持（调试用，剖析程序性能瓶颈）</td>
</tr>
<tr>
<td>–with-cpp_test_module</td>
<td>启用ngx_cpp_test_module支持</td>
</tr>
<tr>
<td>–add-module=</td>
<td>启用外部模块支持</td>
</tr>
<tr>
<td>–with-cc=</td>
<td>指向C编译器路径 –with-cpp= 指向C预处理路径</td>
</tr>
<tr>
<td>–with-cc-opt=</td>
<td>设置C编译器参数（PCRE库，需要指定–with-cc-opt=”-I /usr/local/include”，如果使用select()函数则需要同时增加文件描述符数量，可以通过–with-cc- opt=”-D FD_SETSIZE=2048”指定。）</td>
</tr>
<tr>
<td>–with-ld-opt=</td>
<td>设置连接文件参数。（PCRE库，需要指定–with-ld-opt=”-L /usr/local/lib”。）</td>
</tr>
<tr>
<td>–with-cpu-opt=</td>
<td>指定编译的CPU，可用的值为: pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64 </td>
</tr>
<tr>
<td>–without-pcre</td>
<td>禁用pcre库</td>
</tr>
<tr>
<td>–with-pcre</td>
<td>启用pcre库</td>
</tr>
<tr>
<td>–with-pcre=</td>
<td>指向pcre库文件目录</td>
</tr>
<tr>
<td>–with-pcre-opt=</td>
<td>在编译时为pcre库设置附加参数</td>
</tr>
<tr>
<td>–with-md5=</td>
<td>指向md5库文件目录（消息摘要算法第五版，用以提供消息的完整性保护）</td>
</tr>
<tr>
<td>–with-md5-opt=</td>
<td>在编译时为md5库设置附加参数</td>
</tr>
<tr>
<td>–with-md5-asm</td>
<td>使用md5汇编源</td>
</tr>
<tr>
<td>–with-sha1=</td>
<td>指向sha1库目录（数字签名算法，主要用于数字签名）</td>
</tr>
<tr>
<td>–with-sha1-opt=</td>
<td>在编译时为sha1库设置附加参数</td>
</tr>
<tr>
<td>–with-sha1-asm</td>
<td>使用sha1汇编源</td>
</tr>
<tr>
<td>–with-zlib=</td>
<td>指向zlib库目录</td>
</tr>
<tr>
<td>–with-zlib-opt=</td>
<td>在编译时为zlib设置附加参数</td>
</tr>
<tr>
<td>–with-zlib-asm=</td>
<td>为指定的CPU使用zlib汇编源进行优化，CPU类型为pentium, pentiumpro</td>
</tr>
<tr>
<td>–with-libatomic</td>
<td>为原子内存的更新操作的实现提供一个架构</td>
</tr>
<tr>
<td>–with-libatomic=</td>
<td>指向libatomic_ops安装目录</td>
</tr>
<tr>
<td>–with-openssl=</td>
<td>指向openssl安装目录</td>
</tr>
<tr>
<td>–with-openssl-opt</td>
<td>在编译时为openssl设置附加参数</td>
</tr>
<tr>
<td>–with-debug</td>
<td>启用debug日志</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/04/nginx-compiler-parameters.html" data-id="civlqiuci00fsc15m5gon5n4u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-loadbalance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/04/nginx-loadbalance.html" class="article-date">
  <time datetime="2016-02-04T07:55:26.000Z" itemprop="datePublished">2016-02-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/04/nginx-loadbalance.html">Nginx负载均衡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nginx负载均衡"><a href="#Nginx负载均衡" class="headerlink" title="Nginx负载均衡"></a>Nginx负载均衡</h1><p>nginx不单可以作为强大的 web 服务器，也可以作为一个反向代理服务器，而且nginx还可以按照调度规则实现动态、静态页面的分离，可以按照轮询、 ip 哈希、 URL 哈希、权重等多种方式对后端服务器做负载均衡，同时还支持后端服务器的健康检查。</p>
<p>如果只有一台服务器时,这个服务器挂了,那么对于网站来说是个灾难.因此，这时候的负载均衡就会大显身手了,它会自动剔除挂掉的服务器.</p>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><p>略</p>
<h2 id="Nginx-负载均衡一些基础知识"><a href="#Nginx-负载均衡一些基础知识" class="headerlink" title="Nginx 负载均衡一些基础知识"></a>Nginx 负载均衡一些基础知识</h2><p>nginx 的 upstream 目前支持 4 种方式的分配</p>
<ul>
<li>轮询（默认）  每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</li>
<li>weight  指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</li>
<li>ip_hash  每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。  </li>
<li>fair（第三方） 按后端服务器的响应时间来分配请求，响应时间短的优先分配。  </li>
<li>url_hash（第三方）</li>
</ul>
<h2 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h2><p>在http节点里添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">定义负载均衡设备的 IP及设备状态</div><div class="line">upstream myServer &#123;   </div><div class="line">    server 127.0.0.19090 down;</div><div class="line">    server 127.0.0.18080 weight=2;</div><div class="line">    server 127.0.0.16060;</div><div class="line">    server 127.0.0.17070 backup;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在需要使用负载的 Server节点下添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">proxy_pass httpmyServer;</div></pre></td></tr></table></figure></p>
<p>1 upstream 每个设备的状态<br>2 down 表示单前 的server 暂时不参与负载<br>3 weight  默认为1. weight 越大，负载的权重就越大。<br>4 max_fails ：允许请求失败的次数默认为 1.当超过最大次数时，返回 proxy_next_upstream 模块定义的错误<br>5 fail_timeoutmax_fails 次失败后，暂停的时间。<br>6 backup： 其它所有的非 backup 机器 down 或者忙的时候，请求 backup 机器。所以这台机器压力会最轻。</p>
<p>Nginx 还支持多组的负载均衡,可以配置多个 upstream  来服务于不同的 Server.<br>配置负载均衡比较简单,但是最关键的一个问题是怎么实现多台服务器之间 session 的共享<br>下面有几种方法(以下内容来源于网络,第四种方法没有实践.)</p>
<ul>
<li><p>不使用 session，换作 cookie<br>能把 session改成 cookie，就能避开 session 的一些弊端，在从前看的一本 J2EE 的书上，也指明在集群系统中不能用 session，否则惹出祸端来就不好办。如果系统不复杂，就优先考虑能否将 session 去掉，改动起来非常麻烦的话，再用下面的办法。</p>
</li>
<li><p>应用服务器自行实现共享<br>asp.net 可以用数据库或 memcached 来保存 session，从而在 asp.net 本身建立了一个session 集群，用这样的方式可以令 session 保证稳定，即使某个节点有故障，session也不会丢失，适用于较为严格但请求量不高的场合。但是它的效率是不会很高的，不适用于对效率 要求高的场合。</p>
</li>
</ul>
<p>以上两个办法都跟 nginx 没什么关系，下面来说说用 nginx 该如何处理：</p>
<ul>
<li>ip_hash<br>nginx 中的 ip_hash 技术能够将某个 ip 的请求定向到同一台后端，这样一来这个 ip 下的某个客户端和某个后端就能建立起稳固的 session，ip_hash 是在 upstream配置中定义的<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">upstream backend &#123;</div><div class="line">  server 127.0.0.18080 ;</div><div class="line">  server 127.0.0.19090 ;</div><div class="line">   ip_hash;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>ip_hash 是容易理解的，但是因为仅仅能用 ip 这个因子来分配后端，因此 ip_hash是有缺陷的，不能在一些情况下使用</p>
<p>nginx 不是最前端的服务器。ip_hash 要求 nginx 一定是最前端的服务器，否则 nginx 得不到正确 ip，就不能根据 ip 作 hash。譬如使用的是squid为最前端，那么 nginx 取 i p时只能得到 squid 的服务器 ip 地址，用这个地址来作分流是肯定错乱的。</p>
<p>nginx 的后端还有其它方式的负载均衡。假如 nginx 后端又有其它负载均衡，将请求又通过另外的方式分流了，那么某个客户端的请求肯定不能定位到同一台 session应用服务器上。这么算起来，nginx 后端只能直接指向应用服务器，或者再搭一个 squid，然后指向应用服务器。最好的办法是用location 作一次分流，将需要 session 的部分请求通过 ip_hash 分流，剩下的走其它后端去。</p>
<ul>
<li>upstream_hash<br>为了解决 ip_hash 的一些问题，可以使用 upstream_hash 这个第三方模块，这个模块多数情况下是用作 url_hash 的，但是并不妨碍将它用来做 session 共享：</li>
</ul>
<p>假如前端是 squid，他会将 ip 加入 x_forwarded_for 这个 http_header 里，用upstream_hash 可以用这个头做因子，将请求定向到指定的后端：</p>
<p>可见这篇文档：httpwww.sudone.comnginxnginx_url_hash.html<br>在文档中是使用 $request_uri 做因子，稍微改一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hash   $http_x_forwarded_for;</div></pre></td></tr></table></figure></p>
<p>这样就改成了利用 x_forwarded_for 这个头作因子，在 nginx 新版本中可支持读取 cookie 值，所以也可以改成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hash   $cookie_jsessionid;</div></pre></td></tr></table></figure></p>
<p>假如在php中配置的 session 为无 cookie方式，配合nginx自己的一个 userid_module 模块就可以用nginx自发一个 cookie，可参见 userid模块的英文文档：</p>
<p>httpwiki.nginx.orgNginxHttpUserIdModule</p>
<p>另可用姚伟斌编写的模块 upstream_jvm_route：httpcode.google.compnginx-upstream-jvm-route</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/04/nginx-loadbalance.html" data-id="civlqiud400gfc15m7ennr9oc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/7/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/9/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Database/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/Redis/">Redis</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/">System</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/System/Bash/">Bash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/CentOS/">CentOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Command/">Command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/DNS/">DNS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Debian/">Debian</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Gitlab/">Gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/IPTABLES/">IPTABLES</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/L2TP/">L2TP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Monitor/">Monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Other/">Other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Proxy/">Proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/RRDTOOL/">RRDTOOL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Security/">Security</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/Apache/">Apache</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/Nginx/">Nginx</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化/">虚拟化</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化/KVM/">KVM</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/">运维技术</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/ELK/">ELK</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/GlusterFS/">GlusterFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/MooseFS/">MooseFS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/">运维自动化</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/Ansible/">Ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/Cobbler/">Cobbler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/SaltStack/">SaltStack</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/">Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP状态码/">HTTP状态码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MooseFS/">MooseFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/">bind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cacti/">cacti</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chinese/">chinese</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chromium/">chromium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cobbler/">cobbler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/">curl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debian/">debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/download/">download</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dropbox/">dropbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch-elk/">elasticsearch.elk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elk/">elk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/em1/">em1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/epel/">epel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eth0/">eth0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fishshell/">fishshell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitolite/">gitolite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glances/">glances</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glibc/">glibc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glusterfs/">glusterfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iftop/">iftop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kibana/">kibana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kvm/">kvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/l2tp/">l2tp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrotate/">logrotate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash-forwarder/">logstash-forwarder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/megacli/">megacli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mindmap/">mindmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monitor/">monitor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mycli/">mycli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nfs/">nfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-vim/">nginx.vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ntp/">ntp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openssl/">openssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/parted/">parted</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/passwd/">passwd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php-fpm/">php-fpm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pptp/">pptp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raid/">raid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rrdtool/">rrdtool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saltstack/">saltstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servicewrapper/">servicewrapper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsocks/">shadowsocks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smokeping/">smokeping</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socks5/">socks5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ss5/">ss5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/transmission/">transmission</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virsh/">virsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vncserver/">vncserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xz/">xz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yum/">yum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书写指南/">书写指南</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Blog/" style="font-size: 10px;">Blog</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/HTTP状态码/" style="font-size: 10px;">HTTP状态码</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/MooseFS/" style="font-size: 10px;">MooseFS</a> <a href="/tags/ansible/" style="font-size: 17.5px;">ansible</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/awk/" style="font-size: 11.25px;">awk</a> <a href="/tags/bash/" style="font-size: 18.75px;">bash</a> <a href="/tags/bind/" style="font-size: 11.25px;">bind</a> <a href="/tags/cacti/" style="font-size: 10px;">cacti</a> <a href="/tags/centos/" style="font-size: 12.5px;">centos</a> <a href="/tags/chinese/" style="font-size: 11.25px;">chinese</a> <a href="/tags/chromium/" style="font-size: 10px;">chromium</a> <a href="/tags/cobbler/" style="font-size: 11.25px;">cobbler</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/debian/" style="font-size: 10px;">debian</a> <a href="/tags/docker/" style="font-size: 12.5px;">docker</a> <a href="/tags/download/" style="font-size: 10px;">download</a> <a href="/tags/dropbox/" style="font-size: 10px;">dropbox</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/elasticsearch-elk/" style="font-size: 10px;">elasticsearch.elk</a> <a href="/tags/elk/" style="font-size: 12.5px;">elk</a> <a href="/tags/em1/" style="font-size: 10px;">em1</a> <a href="/tags/epel/" style="font-size: 10px;">epel</a> <a href="/tags/eth0/" style="font-size: 10px;">eth0</a> <a href="/tags/fishshell/" style="font-size: 10px;">fishshell</a> <a href="/tags/git/" style="font-size: 13.75px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/gitolite/" style="font-size: 10px;">gitolite</a> <a href="/tags/glances/" style="font-size: 10px;">glances</a> <a href="/tags/glibc/" style="font-size: 10px;">glibc</a> <a href="/tags/glusterfs/" style="font-size: 12.5px;">glusterfs</a> <a href="/tags/gpt/" style="font-size: 10px;">gpt</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/iftop/" style="font-size: 10px;">iftop</a> <a href="/tags/inotify/" style="font-size: 11.25px;">inotify</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/kibana/" style="font-size: 10px;">kibana</a> <a href="/tags/kvm/" style="font-size: 10px;">kvm</a> <a href="/tags/l2tp/" style="font-size: 10px;">l2tp</a> <a href="/tags/logrotate/" style="font-size: 10px;">logrotate</a> <a href="/tags/logstash/" style="font-size: 11.25px;">logstash</a> <a href="/tags/logstash-forwarder/" style="font-size: 10px;">logstash-forwarder</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/megacli/" style="font-size: 11.25px;">megacli</a> <a href="/tags/mindmap/" style="font-size: 11.25px;">mindmap</a> <a href="/tags/monitor/" style="font-size: 15px;">monitor</a> <a href="/tags/mycli/" style="font-size: 10px;">mycli</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nfs/" style="font-size: 10px;">nfs</a> <a href="/tags/nginx/" style="font-size: 20px;">nginx</a> <a href="/tags/nginx-vim/" style="font-size: 10px;">nginx.vim</a> <a href="/tags/ntp/" style="font-size: 10px;">ntp</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/parted/" style="font-size: 10px;">parted</a> <a href="/tags/passwd/" style="font-size: 10px;">passwd</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/php-fpm/" style="font-size: 10px;">php-fpm</a> <a href="/tags/pptp/" style="font-size: 11.25px;">pptp</a> <a href="/tags/proxy/" style="font-size: 15px;">proxy</a> <a href="/tags/python/" style="font-size: 12.5px;">python</a> <a href="/tags/raid/" style="font-size: 10px;">raid</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/rrdtool/" style="font-size: 10px;">rrdtool</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/saltstack/" style="font-size: 16.25px;">saltstack</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/servicewrapper/" style="font-size: 10px;">servicewrapper</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/smokeping/" style="font-size: 13.75px;">smokeping</a> <a href="/tags/socks5/" style="font-size: 11.25px;">socks5</a> <a href="/tags/ss5/" style="font-size: 10px;">ss5</a> <a href="/tags/transmission/" style="font-size: 10px;">transmission</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/virsh/" style="font-size: 10px;">virsh</a> <a href="/tags/vncserver/" style="font-size: 10px;">vncserver</a> <a href="/tags/xz/" style="font-size: 10px;">xz</a> <a href="/tags/yum/" style="font-size: 10px;">yum</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a> <a href="/tags/书写指南/" style="font-size: 10px;">书写指南</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/17/Git-basic.html">Git基础</a>
          </li>
        
          <li>
            <a href="/2016/10/26/ansible-managment-windows.html">使用ansible管理windows主机</a>
          </li>
        
          <li>
            <a href="/2016/10/20/git-different-sshkey.html">配置不同ssh-key访问不同git仓库</a>
          </li>
        
          <li>
            <a href="/2016/10/20/l2tp-vpn.html">IPsec和L2TP搭建VPN</a>
          </li>
        
          <li>
            <a href="/2016/10/20/ansible-dynamic-create-vhost.html">通过jinja2生成虚拟主机配置</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 C.c<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>