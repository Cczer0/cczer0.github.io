<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Linux, Python" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="Love Linux ♥ Love Python. 猴赛雷">
<meta property="og:type" content="website">
<meta property="og:title" content="Czero's Blog">
<meta property="og:url" content="http://czero000.github.io/page/5/index.html">
<meta property="og:site_name" content="Czero's Blog">
<meta property="og:description" content="Love Linux ♥ Love Python. 猴赛雷">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Czero's Blog">
<meta name="twitter:description" content="Love Linux ♥ Love Python. 猴赛雷">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '主编大人'
    }
  };
</script>




  <link rel="canonical" href="http://czero000.github.io/page/5/"/>


  <title> Czero's Blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8598c7081881fc1631368a001586d2c8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Czero's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">点滴分享 多彩生活</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/04/install-nginx-php-fpm.html" itemprop="url">
                  Nginx+PHP-FPM取代Apache
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-04T16:01:39+08:00" content="2016-02-04">
              2016-02-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Nginx/" itemprop="url" rel="index">
                    <span itemprop="name">Nginx</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/04/install-nginx-php-fpm.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/04/install-nginx-php-fpm.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/02/04/install-nginx-php-fpm.html" class="leancloud_visitors" data-flag-title="Nginx+PHP-FPM取代Apache">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="Nginx-PHP-FPM-FastCGI-Process-Manager"><a href="#Nginx-PHP-FPM-FastCGI-Process-Manager" class="headerlink" title="Nginx + PHP-FPM(FastCGI Process Manager)"></a>Nginx + PHP-FPM(FastCGI Process Manager)</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Apache的效率和承载能力受到大多人的诟病，nginx藉由Nob-blocking与epool这些特性，大幅提高了并发数和处理速度，愈发收到人们的喜爱，但由于Nginx本身只是单纯的HTTP Server，如果执行php，需要配合CGI来完成，nginx把请求转发给fastcig管理进程，处理之后在将结果返回给Nginx。</p>
<h3 id="什么是PHP-FPM"><a href="#什么是PHP-FPM" class="headerlink" title="什么是PHP-FPM"></a>什么是PHP-FPM</h3><p>相对于Spawn-FCGI，PHP-FPM在内存和CPU方面的控制更胜一筹，PHP-FPM提供了更好的PHP进程管理方式。PHP-FPM对于PHP5.3之前来说就是一个补丁，将FastCGI进程管理整合到PHP中，在PHP 5.4之后，PHP-FPM已经集成到PHP的软件包中，在编译PHP过程中，增加<code>--enable-fpm</code>参数即可开启PHP-FPM</p>
<h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><h3 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h3><p>本文的安装环境采用：<code>CentOS Linux release 7.1.1503 (Core)</code></p>
<h3 id="软件获取"><a href="#软件获取" class="headerlink" title="软件获取"></a>软件获取</h3><ul>
<li>Nginx</li>
</ul>
<p>官方网站：<a href="http://nginx.org" target="_blank" rel="external">http://nginx.org</a><br>最新稳定版本：<a href="http://nginx.org/download/nginx-1.8.1.tar.gz" target="_blank" rel="external">nginx-1.8.1.tar.gz</a><br>帮助文档：<a href="http://nginx.org/en/docs" target="_blank" rel="external">http://nginx.org/en/docs</a><br>编译参数说明：<a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="external">http://nginx.org/en/docs/configure.html</a></p>
<ul>
<li>PHP</li>
</ul>
<p>官方网站：<a href="http://www.php.net" target="_blank" rel="external">http://www.php.net</a><br>稳定版：<a href="http://cn2.php.net/distributions/php-5.6.17.tar.gz" target="_blank" rel="external">php-5.6.17.tar.gz</a></p>
<ul>
<li>软件仓库</li>
</ul>
<p>yum仓库包含centos官方和epel两个安装源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://mirrors.yun-idc.com/epel/7/x86_64/e/epel-release-7-5.noarch.rpm</div></pre></td></tr></table></figure></p>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><h3 id="安装模块依赖包"><a href="#安装模块依赖包" class="headerlink" title="安装模块依赖包"></a>安装模块依赖包</h3><p>Nginx的gzip、rewrite、ssl模块分别需要zlib、pcre、openssl的支持，可以通过源码或yum工具来安装</p>
<ul>
<li>安装zlib</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 使用gzip压缩</div><div class="line">yum install zlib zlib-devel -y</div></pre></td></tr></table></figure>
<ul>
<li>安装pcre</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 使用rewrite功能</div><div class="line">yum install pcre pcre-devel</div></pre></td></tr></table></figure>
<ul>
<li>安装openssl</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 如果需要ssl支持,不需要可以不安装</div><div class="line">yum install openssl openssl-devel</div></pre></td></tr></table></figure>
<h3 id="安装Nginx-1"><a href="#安装Nginx-1" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget http://nginx.org/download/nginx-1.8.1.tar.gz</div><div class="line">tar zxf nginx-1.8.1.tar.gz</div><div class="line">./configure --prefix=/usr/local/nginx --with-http_ssl_module  --with-http_stub_status_module --with-pcre</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h3 id="启动Nginx，测试安装"><a href="#启动Nginx，测试安装" class="headerlink" title="启动Nginx，测试安装"></a>启动Nginx，测试安装</h3><p>nginx的默认端口是80，启动之前要确保80端口没有被占用，如果想保留80端口，只需要在nginx配置文件中，<code>listen 80；</code>中80换成其他端口。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//启动nginx</div><div class="line">/usr/local/nginx/sbin/nginx</div><div class="line"></div><div class="line">// 检查80端口是否启动</div><div class="line">netstat -ntpl</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </div><div class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      28608/nginx: master </div><div class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      917/sshd            </div><div class="line">tcp6       0      0 :::22                   :::*                    LISTEN      917/sshd</div></pre></td></tr></table></figure></p>
<p>通过浏览器访问Nginx Server 会出现欢迎页面，说明nginx安装正常</p>
<h2 id="安装PHP及PHP-FPM"><a href="#安装PHP及PHP-FPM" class="headerlink" title="安装PHP及PHP-FPM"></a>安装PHP及PHP-FPM</h2><ul>
<li>安装依赖软件包</li>
</ul>
<p>确保安装之前有安装gd、png、curl、xml等lib开发库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install gd-devel libjpeg-devel libpng-devel libxml2-devel bzip2-devel libcurl-devel -y</div></pre></td></tr></table></figure></p>
<ul>
<li>下载软件包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://cn2.php.net/distributions/php-5.6.17.tar.gz</div><div class="line">tar zxf php-5.6.17.tar.gz </div><div class="line">cd php-5.6.17/</div></pre></td></tr></table></figure>
<ul>
<li>编译安装php5.6</li>
</ul>
<p>以下参数支持，ftp、图片函数、pdo等，因为使用了php自带的mysqlnd，所以不需要额外安装mysql的lib库，如果是64位系统，参数后面需要添加–wtih-libdir=lib64<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-bz2 --with-curl --enable-ftp --enable-sockets --disable-ipv6 --with-gd --with-jpeg-dir=/usr/local --with-png-dir=/usr/local --with-freetype-dir=/usr/local --enable-gd-native-ttf --with-iconv-dir=/usr/local --enable-mbstring --enable-calendar --with-gettext --with-libxml-dir=/usr/local --with-zlib --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd --with-mysql=mysqlnd --enable-dom --enable-xml --enable-fpm --with-libdir=lib64</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure></p>
<p>注： 编译参数可以根据实际需求，增加或者删减</p>
<ul>
<li>配置php-fpm</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp php.ini-production /usr/local/php/etc/php.ini</div><div class="line">cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</div></pre></td></tr></table></figure>
<ul>
<li>启动PHP-FPM</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">systemctl start php-fpm</div><div class="line"></div><div class="line">// init方式</div><div class="line">cp /usr/local/src/php-5.6.17/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</div><div class="line">chmod +x /etc/init.d/php-fpm</div><div class="line">/etc/init.d/php-fpm start</div><div class="line"></div><div class="line">//执行没有报错，说明启动成功，还可以通过端口检查服务是否启动,9000端口是fpm的服务端口</div><div class="line">netstat -ntpl</div><div class="line">Active Internet connections (only servers)</div><div class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </div><div class="line">tcp        0      0 127.0.0.1:9000              0.0.0.0:*                   LISTEN      23723/php-fpm       </div><div class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      1423/sshd           </div><div class="line">tcp        0      0 :::22                       :::*                        LISTEN      1423/sshd</div></pre></td></tr></table></figure>
<h2 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h2><h3 id="nginx主配置文件"><a href="#nginx主配置文件" class="headerlink" title="nginx主配置文件"></a>nginx主配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">cat nginx.conf</div><div class="line">user  nobody;</div><div class="line">worker_processes  8;  </div><div class="line">worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 1000000;</div><div class="line">worker_rlimit_nofile 65535;</div><div class="line"></div><div class="line">error_log  logs/error.log  notice;</div><div class="line">#error_log  logs/error.log  info;</div><div class="line"></div><div class="line">pid        logs/nginx.pid;</div><div class="line"></div><div class="line">events &#123;</div><div class="line">    use epoll;</div><div class="line">    worker_connections  10240;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    server_names_hash_bucket_size 128;</div><div class="line">    client_header_buffer_size 32k;</div><div class="line">    client_body_buffer_size 32k;</div><div class="line">    client_max_body_size 8m; </div><div class="line">    large_client_header_buffers 4 32k;</div><div class="line">    </div><div class="line">    log_format access  &apos;$http_host $remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot;&apos;;</div><div class="line"></div><div class="line">    index index.php index.html;</div><div class="line">    autoindex off;</div><div class="line">    fastcgi_intercept_errors on;</div><div class="line">    #access_log  logs/access.log  main;</div><div class="line"></div><div class="line">    sendfile        on;</div><div class="line">    tcp_nopush     on;</div><div class="line">    tcp_nodelay    off;</div><div class="line"></div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    fastcgi_connect_timeout 300;</div><div class="line">    fastcgi_send_timeout 300;</div><div class="line">    fastcgi_read_timeout 300;</div><div class="line">    fastcgi_buffer_size 64k;</div><div class="line">    fastcgi_buffers 4 64k;</div><div class="line">    fastcgi_busy_buffers_size 128k;</div><div class="line">    fastcgi_temp_file_write_size 128k;</div><div class="line"></div><div class="line">    gzip  on;</div><div class="line">    gzip_min_length 1k;</div><div class="line">    gzip_http_version 1.0;</div><div class="line">    gzip_comp_level 2;</div><div class="line">    gzip_buffers  4 16k;</div><div class="line">    gzip_proxied any;</div><div class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;</div><div class="line">    gzip_types  text/plain text/css application/x-javascript application/xml application/xml+rss text/javascript;</div><div class="line">    gzip_vary on;</div><div class="line">    server_name_in_redirect off;</div><div class="line">    include /usr/local/nginx/conf/vhost/*.conf;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="虚拟主机配置文件"><a href="#虚拟主机配置文件" class="headerlink" title="虚拟主机配置文件"></a>虚拟主机配置文件</h3><p>增加测试站点www.zerounix.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 80;</div><div class="line">    server_name www.zerounix.com;</div><div class="line">    root /data/website/www.zerounix.com;</div><div class="line">    charset utf-8;</div><div class="line">    index index.php index.html index.htm ;</div><div class="line">    access_log  logs/www.zerounix.com_access.log access;</div><div class="line">    error_log   logs/www.zerounix.com_error.log;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ /index.php$is_args$args;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ .*\.(php|php5)$ &#123;</div><div class="line">        fastcgi_pass 127.0.0.1:9000;</div><div class="line">        include        fastcgi.conf;</div><div class="line">        try_files $uri =404;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Nginx将会连接回环地址9000端口执行php文件，需要使用tcp/ip协议，速度较慢，建议设置为socket方式连接。将<code>fastcgi_pass 127.0.0.1:9000</code>变更为<code>fastcgi_pass unix:/dev/shm/php-fpm.socket</code>; 同时变更php-fpm配置文件，在<code>listen = 127.0.0.1:9000</code>添加<code>listen = /dev/shm/php5-fpm.socket</code>;分别重启<code>nginx</code>和<code>php-fpm</code> 服务</p>
<h3 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx</div></pre></td></tr></table></figure>
<h3 id="创建PHP测试文件"><a href="#创建PHP测试文件" class="headerlink" title="创建PHP测试文件"></a>创建PHP测试文件</h3><p>在<code>/data/website/www.zerounix.com/phpinfo.php</code> 添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">var_export($_SERVER)</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p>
<h3 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">curl -x 172.16.11.210:80 www.zerounix.com/phpinfo.php</div><div class="line">array (</div><div class="line">  &apos;USER&apos; =&gt; &apos;nobody&apos;,</div><div class="line">  &apos;HOME&apos; =&gt; &apos;/&apos;,</div><div class="line">  &apos;FCGI_ROLE&apos; =&gt; &apos;RESPONDER&apos;,</div><div class="line">  &apos;SCRIPT_FILENAME&apos; =&gt; &apos;/data/website/www.zerounix.com/phpinfo.php&apos;,</div><div class="line">  &apos;QUERY_STRING&apos; =&gt; &apos;&apos;,</div><div class="line">  &apos;REQUEST_METHOD&apos; =&gt; &apos;GET&apos;,</div><div class="line">  &apos;CONTENT_TYPE&apos; =&gt; &apos;&apos;,</div><div class="line">  &apos;CONTENT_LENGTH&apos; =&gt; &apos;&apos;,</div><div class="line">  &apos;SCRIPT_NAME&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;REQUEST_URI&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;DOCUMENT_URI&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;DOCUMENT_ROOT&apos; =&gt; &apos;/data/website/www.zerounix.com&apos;,</div><div class="line">  &apos;SERVER_PROTOCOL&apos; =&gt; &apos;HTTP/1.1&apos;,</div><div class="line">  &apos;GATEWAY_INTERFACE&apos; =&gt; &apos;CGI/1.1&apos;,</div><div class="line">  &apos;SERVER_SOFTWARE&apos; =&gt; &apos;nginx/1.8.1&apos;,</div><div class="line">  &apos;REMOTE_ADDR&apos; =&gt; &apos;172.16.11.210&apos;,</div><div class="line">  &apos;REMOTE_PORT&apos; =&gt; &apos;55060&apos;,</div><div class="line">  &apos;SERVER_ADDR&apos; =&gt; &apos;172.16.11.210&apos;,</div><div class="line">  &apos;SERVER_PORT&apos; =&gt; &apos;80&apos;,</div><div class="line">  &apos;SERVER_NAME&apos; =&gt; &apos;www.zerounix.com&apos;,</div><div class="line">  &apos;REDIRECT_STATUS&apos; =&gt; &apos;200&apos;,</div><div class="line">  &apos;HTTP_USER_AGENT&apos; =&gt; &apos;curl/7.29.0&apos;,</div><div class="line">  &apos;HTTP_HOST&apos; =&gt; &apos;www.zerounix.com&apos;,</div><div class="line">  &apos;HTTP_ACCEPT&apos; =&gt; &apos;*/*&apos;,</div><div class="line">  &apos;HTTP_PROXY_CONNECTION&apos; =&gt; &apos;Keep-Alive&apos;,</div><div class="line">  &apos;PHP_SELF&apos; =&gt; &apos;/phpinfo.php&apos;,</div><div class="line">  &apos;REQUEST_TIME_FLOAT&apos; =&gt; 1454568561.60866,</div><div class="line">  &apos;REQUEST_TIME&apos; =&gt; 1454568561,</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>说明php解析正常</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Nginx安装配置相对容易，但是要调优就是另外一件事了，如果设定的不恰当，在高并发的时候，经常会出现502 Bad Gateway。之后会研究下调优的为问题。</p>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/04/nginx-configfile-detail.html" itemprop="url">
                  Nginx--配置文件详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-04T15:59:49+08:00" content="2016-02-04">
              2016-02-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/04/nginx-configfile-detail.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/04/nginx-configfile-detail.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/02/04/nginx-configfile-detail.html" class="leancloud_visitors" data-flag-title="Nginx--配置文件详解">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="nginx-主配置文件详解"><a href="#nginx-主配置文件详解" class="headerlink" title="nginx 主配置文件详解"></a>nginx 主配置文件详解</h2><p>安装nginx后，会在安装目录下生成conf目录，目录中<code>nginx.conf</code>便是nginx的主配置文件，nginx是基于模块化的构建方式，在ningx配置文件中也有体现，可以分为核心模块、事件模块、邮件模块、HTTP模块。</p>
<h3 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">user  nobody;                                // 指定nginx运行的用户和组，默认为nobody</div><div class="line">worker_processes  8;                         // 开启nginx的进程数，与cpu核数一致</div><div class="line">worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 1000000; // 将每个nginx进程绑定到一个CPU上</div><div class="line">worker_rlimit_nofile 65535;                  // 指定nginx进程打开的最多文件描述符数量，受系统的最大文件打开数限制</div><div class="line"></div><div class="line">error_log  logs/error.log;  notice;          // 设定全局错误日志文件，以什么级别显示，有[debug、info、warn、error、crit]模式可选，按照实际情况设定</div><div class="line">#error_log  logs/error.log  info;            </div><div class="line"></div><div class="line">pid        logs/nginx.pid;                   // 指定进程id的存储文件位置</div></pre></td></tr></table></figure>
<h3 id="事件模块"><a href="#事件模块" class="headerlink" title="事件模块"></a>事件模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">events &#123;</div><div class="line">    use epoll;	                             // 工作模式设定为epoll，还有select、poll、kqueue、rtsig和/dev/poll模式可选</div><div class="line">    worker_connections  65535;                // 定义每个进程的最大连接数，受系统的最大文件打开数限制</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="http模块"><a href="#http模块" class="headerlink" title="http模块"></a>http模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">    include       mime.types;                             // 文件拓展名与文件类型映射表 </div><div class="line">    default_type  application/octet-stream;               // 默认文件类型 </div><div class="line">    charset utf-8;                                        // 默认编码</div><div class="line">   #autoindex on ;                                        // 关闭目录别表访问，默认关闭</div><div class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;    // 设置日志格式</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line">  </div><div class="line">    access_log  logs/access.log  main;                                 </div><div class="line">   </div><div class="line">    sendfile        on;                                   //开启高效文件传输模式，如果进行下载等磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</div><div class="line">    #tcp_nopush     on;                                   // 开启防止网络阻塞</div><div class="line"></div><div class="line">    #keepalive_timeout  0;</div><div class="line">    keepalive_timeout  65;                                // 设置客户端连接报错活动的超时时间</div><div class="line">    tcp_nodelay         on;</div><div class="line">    </div><div class="line">    </div><div class="line">    // 反向代理设置</div><div class="line">    proxy_connect_timeout 30;                           </div><div class="line">    proxy_send_timeout 30;</div><div class="line">    proxy_read_timeout 30;</div><div class="line">    proxy_buffer_size 32k;</div><div class="line">    proxy_buffers 4 64k;</div><div class="line">    proxy_busy_buffers_size 128k;</div><div class="line">    proxy_temp_file_write_size 128k;</div><div class="line">    proxy_ignore_client_abort on;</div><div class="line">    proxy_headers_hash_max_size 51200;</div><div class="line">    proxy_headers_hash_bucket_size 6400;</div><div class="line">    proxy_set_header  Host              $host;</div><div class="line">    proxy_set_header  X-Real-IP         $remote_addr;     </div><div class="line">    proxy_set_header  x-forwarded-for   $proxy_add_x_forwarded_for; //后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</div><div class="line"></div><div class="line">    server_names_hash_bucket_size 128;                  // 服务器名字的hash表大小</div><div class="line">    client_header_buffer_size 32k;                      // 指定client请求头的hearder buffers大小</div><div class="line">    large_client_header_buffers 4 32k;                  // 大请求缓冲区数量和大小</div><div class="line">    client_max_body_size 8m;                            // 设置client请求的最大单个文件字节数</div><div class="line">    client_body_temp_path /dev/shm/client_body_temp;    // 指定连接请求试图写入缓存文件的目录路径</div><div class="line"> </div><div class="line"> </div><div class="line"> // FastCGI相关参数设定</div><div class="line">    fastcgi_connect_timeout 300;</div><div class="line">    fastcgi_send_timeout 300;</div><div class="line">    fastcgi_read_timeout 300;</div><div class="line">    fastcgi_buffer_size 64k;</div><div class="line">    fastcgi_buffers 4 64k;</div><div class="line">    fastcgi_busy_buffers_size 128k;</div><div class="line">    fastcgi_temp_file_write_size 128k;</div><div class="line">    </div><div class="line">// Gzip相关参数设定    </div><div class="line">    gzip  on;                                             // 开启gzip压缩</div><div class="line">    gzip_min_length 1k;                                   // 设置允许压缩的页面最小字节</div><div class="line">    gzip_http_version 1.0;                                // 设置识别http协议的版本，默认是1.1</div><div class="line">    gzip_comp_level 2;                                    // 设置压缩比，1-9</div><div class="line">    gzip_buffers  4 16k;                                  // 设置4个单位16k的内存作为压缩结果流缓存 </div><div class="line">    gzip_proxied any;                                     // nginx 做前端代理时启用该选项，表示无论后端服务器的headers头返回什么信息，都无条件启用压缩</div><div class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;                          // 禁用IE1-6的gzip压缩</div><div class="line">    gzip_types  text/plain text/css application/x-javascript application/xml application/xml+rss text/javascript;  // 什么类型的页面或文档启用压缩</div><div class="line">    gzip_vary on;</div><div class="line">    server_name_in_redirect off;                          // nginx 在处理自己内部重定向时不默认使用  server_name 设置中的第一个域名</div><div class="line">    </div><div class="line">    include vhost/*.conf;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="虚拟主机文件"><a href="#虚拟主机文件" class="headerlink" title="虚拟主机文件"></a>虚拟主机文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen 80;                                              // 监听端口</div><div class="line">        server_name  www.zerounix.com                           // 域名，可以多个，用空格分隔</div><div class="line">        root /data/htdocs/www.zerounix.com;                  // 虚拟主机根目录</div><div class="line">        charset uft-8;                                         // 访问编码</div><div class="line">        access_log  logs/www.zerounix.com_access.log access;   //设置虚拟主机访问日志的存放路径和格式main</div><div class="line">        error_log   logs/www.zerounix.com_error.log;            // 错误日志</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">          index index.php index.htm                          // 甚至首页索引文件类型</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        error_page  404              /404.html;              // 定义404页面</div><div class="line"></div><div class="line">        error_page   500 502 503 504  /50x.html;             // 定义50x页面</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        </div><div class="line">        </div><div class="line">        // php请求转发到本地9000，交给fastcig处理</div><div class="line">        location ~.*\.(php|php5)?$ &#123;</div><div class="line">          fastcgi_pass   127.0.0.1:9000;</div><div class="line">          fastcgi_index  index.php;</div><div class="line">          fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">          include        fastcgi_params;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // 设置nginx status页面</div><div class="line">        location /status &#123;                                     </div><div class="line">           stub_status on; </div><div class="line">           access_log logs/www.zerounix.com_status.log;</div><div class="line">           auth_basic &quot;NginxStatus&quot;</div><div class="line">           auth_baaic_user_file conf/htpasswd;                // apache提供的htpasswd工具</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // 图片缓存时间</div><div class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|sfw)$ &#123;             </div><div class="line">          expires 10d;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        // JS和CSS缓存时间</div><div class="line">        location ~ .*\.&#123;js|css&#125;$ &#123;</div><div class="line">          expires 1h;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        //所有静态文件由nginx直接读取不经过tomcat或resin</div><div class="line">        location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ &#123; </div><div class="line">          expires 15d; </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">       </div><div class="line">        // 本地动静分离反向代理配置，所有jsp的页面均交由tomcat或resin处理</div><div class="line">        location ~ .(jsp|jspx|do)?$ &#123;</div><div class="line">          proxy_set_header Host $host;</div><div class="line">          proxy_set_header X-Real-IP $remote_addr;</div><div class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">          proxy_pass http://127.0.0.1:8080;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        #对 &quot;/&quot; 启用反向代理</div><div class="line">     	location / &#123;</div><div class="line">  proxy_pass	http://18.26.154.72:8090;</div><div class="line">          proxy_redirect off;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/04/nginx-compiler-parameters.html" itemprop="url">
                  Nginx编译参数详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-04T15:55:26+08:00" content="2016-02-04">
              2016-02-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/04/nginx-compiler-parameters.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/04/nginx-compiler-parameters.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/02/04/nginx-compiler-parameters.html" class="leancloud_visitors" data-flag-title="Nginx编译参数详解">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<table>
<thead>
<tr>
<th>编译参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>–prefix=</td>
<td>指向安装目录</td>
</tr>
<tr>
<td>–sbin-path</td>
<td>指向（执行）程序文件（nginx）</td>
</tr>
<tr>
<td>–conf-path=</td>
<td>指向配置文件（nginx.conf）</td>
</tr>
<tr>
<td>–error-log-path=</td>
<td>指向错误日志目录</td>
</tr>
<tr>
<td>–pid-path=</td>
<td>指向pid文件（nginx.pid）</td>
</tr>
<tr>
<td>–lock-path=</td>
<td>指向lock文件（nginx.lock）（安装文件锁定，防止安装文件被别人利用，或自己误操作）</td>
</tr>
<tr>
<td>–user=</td>
<td>指定程序运行时的非特权用户</td>
</tr>
<tr>
<td>–group=</td>
<td>指定程序运行时的非特权用户组</td>
</tr>
<tr>
<td>–builddir=</td>
<td>指向编译目录</td>
</tr>
<tr>
<td>–with-rtsig_module</td>
<td>启用rtsig模块支持（实时信号）</td>
</tr>
<tr>
<td>–with-select_module</td>
<td>启用select模块支持（一种轮询模式,不推荐在高载环境下使用）禁用：–without-select_module</td>
</tr>
<tr>
<td>–with-poll_module</td>
<td>启用poll模块支持（功能与select相同，与select特性相同，为一种轮询模式,不推荐在高载环境下使用）</td>
</tr>
<tr>
<td>–with-file-aio</td>
<td>启用file aio支持（一种APL文件传输格式）</td>
</tr>
<tr>
<td>–with-ipv6</td>
<td>启用ipv6支持</td>
</tr>
<tr>
<td>–with-http_ssl_module</td>
<td>启用ngx_http_ssl_module支持（使支持https请求，需已安装openssl）</td>
</tr>
<tr>
<td>–with-http_realip_module</td>
<td>启用ngx_http_realip_module支持（这个模块允许从请求标头更改客户端的IP地址值，默认为关）</td>
</tr>
<tr>
<td>–with-http_addition_module</td>
<td>启用ngx_http_addition_module支持（作为一个输出过滤器，支持不完全缓冲，分部分响应请求）</td>
</tr>
<tr>
<td>–with-http_xslt_module</td>
<td>启用ngx_http_xslt_module支持（过滤转换XML请求）</td>
</tr>
<tr>
<td>–with-http_image_filter_module</td>
<td>启用ngx_http_image_filter_module支持（传输JPEG/GIF/PNG 图片的一个过滤器）（默认为不启用。gd库要用到）</td>
</tr>
<tr>
<td>–with-http_geoip_module</td>
<td>启用ngx_http_geoip_module支持（该模块创建基于与MaxMind GeoIP二进制文件相配的客户端IP地址的ngx_http_geoip_module变量）</td>
</tr>
<tr>
<td>–with-http_sub_module</td>
<td>启用ngx_http_sub_module支持（允许用一些其他文本替换nginx响应中的一些文本）</td>
</tr>
<tr>
<td>–with-http_dav_module</td>
<td>启用ngx_http_dav_module支持（增加PUT,DELETE,MKCOL：创建集合,COPY和MOVE方法）默认情况下为关闭，需编译开启</td>
</tr>
<tr>
<td>–with-http_flv_module</td>
<td>启用ngx_http_flv_module支持（提供寻求内存使用基于时间的偏移量文件）</td>
</tr>
<tr>
<td>–with-http_gzip_static_module</td>
<td>启用ngx_http_gzip_static_module支持（在线实时压缩输出数据流）</td>
</tr>
<tr>
<td>–with-http_random_index_module</td>
<td>启用ngx_http_random_index_module支持（从目录中随机挑选一个目录索引）</td>
</tr>
<tr>
<td>–with-http_secure_link_module</td>
<td>启用ngx_http_secure_link_module支持（计算和检查要求所需的安全链接网址）</td>
</tr>
<tr>
<td>–with-http_degradation_module</td>
<td>启用ngx_http_degradation_module支持（允许在内存不足的情况下返回204或444码）</td>
</tr>
<tr>
<td>–with-http_stub_status_module</td>
<td>启用ngx_http_stub_status_module支持（获取nginx自上次启动以来的工作状态） –without-http_charset_module 禁用ngx_http_charset_module支持（重新编码web页面，但只能是一个方向–服务器端到客户端，并且只有一个字节的编码可以被重新编码）</td>
</tr>
<tr>
<td>–without-http_gzip_module</td>
<td>禁用ngx_http_gzip_module支持（该模块同-with-http_gzip_static_module功能一样）</td>
</tr>
<tr>
<td>–without-http_ssi_module</td>
<td>禁用ngx_http_ssi_module支持（该模块提供了一个在输入端处理处理服务器包含文件（SSI）的过滤器，目前支持SSI命令的列表是不完整的）</td>
</tr>
<tr>
<td>–without-http_userid_module</td>
<td>禁用ngx_http_userid_module支持（该模块用来处理用来确定客户端后续请求的cookies）</td>
</tr>
<tr>
<td>–without-http_access_module</td>
<td>禁用ngx_http_access_module支持（该模块提供了一个简单的基于主机的访问控制。允许/拒绝基于ip地址）</td>
</tr>
<tr>
<td>–without-http_auth_basic_module</td>
<td>禁用ngx_http_auth_basic_module（该模块是可以使用用户名和密码基于http基本认证方法来保护你的站点或其部分内容）</td>
</tr>
<tr>
<td>–without-http_autoindex_module</td>
<td>禁用disable ngx_http_autoindex_module支持（该模块用于自动生成目录列表，只在ngx_http_index_module模块未找到索引文件时发出请求。）</td>
</tr>
<tr>
<td>–without-http_geo_module</td>
<td>禁用ngx_http_geo_module支持（创建一些变量，其值依赖于客户端的IP地址）</td>
</tr>
<tr>
<td>–without-http_map_module</td>
<td>禁用ngx_http_map_module支持（使用任意的键/值对设置配置变量）</td>
</tr>
<tr>
<td>–without-http_split_clients_module</td>
<td>禁用ngx_http_split_clients_module支持（该模块用来基于某些条件划分用户。条件如：ip地址、报头、cookies等等）</td>
</tr>
<tr>
<td>–without-http_referer_module</td>
<td>禁用disable ngx_http_referer_module支持（该模块用来过滤请求，拒绝报头中Referer值不正确的请求）</td>
</tr>
<tr>
<td>–without-http_rewrite_module</td>
<td>禁用ngx_http_rewrite_module支持（该模块允许使用正则表达式改变URI，并且根据变量来转向以及选择配置。如果在server级别设置该选项，那么他们将在 location之前生效。如果在location还有更进一步的重写规则，location部分的规则依然会被执行。如果这个URI重写是因为location部分的规则造成的，那么 location部分会再次被执行作为新的URI。 这个循环会执行10次，然后Nginx会返回一个500错误。）</td>
</tr>
<tr>
<td>–without-http_proxy_module</td>
<td>禁用ngx_http_proxy_module支持（有关代理服务器）</td>
</tr>
<tr>
<td>–without-http_fastcgi_module</td>
<td>禁用ngx_http_fastcgi_module支持（该模块允许Nginx 与FastCGI 进程交互，并通过传递参数来控制FastCGI 进程工作。 ）FastCGI一个常驻型的公共网关接口。</td>
</tr>
<tr>
<td>–without-http_uwsgi_module</td>
<td>禁用ngx_http_uwsgi_module支持（该模块用来医用uwsgi协议，uWSGI服务器相关）</td>
</tr>
<tr>
<td>–without-http_scgi_module</td>
<td>禁用ngx_http_scgi_module支持（该模块用来启用SCGI协议支持，SCGI协议是CGI协议的替代。它是一种应用程序与HTTP服务接口标准。它有些像FastCGI但他的设计 更容易实现。）</td>
</tr>
<tr>
<td>–without-http_memcached_module</td>
<td>禁用ngx_http_memcached_module支持（该模块用来提供简单的缓存，以提高系统效率）</td>
</tr>
<tr>
<td>-without-http_limit_zone_module</td>
<td>禁用ngx_http_limit_zone_module支持（该模块可以针对条件，进行会话的并发连接数控制）</td>
</tr>
<tr>
<td>–without-http_limit_req_module</td>
<td>禁用ngx_http_limit_req_module支持（该模块允许你对于一个地址进行请求数量的限制用一个给定的session或一个特定的事件）</td>
</tr>
<tr>
<td>–without-http_empty_gif_module</td>
<td>禁用ngx_http_empty_gif_module支持（该模块在内存中常驻了一个1*1的透明GIF图像，可以被非常快速的调用）</td>
</tr>
<tr>
<td>–without-http_browser_module</td>
<td>禁用ngx_http_browser_module支持（该模块用来创建依赖于请求报头的值。如果浏览器为modern ，则$modern_browser等于modern_browser_value指令分配的值；如 果浏览器为old，则$ancient_browser等于 ancient_browser_value指令分配的值；如果浏览器为 MSIE中的任意版本，则 $msie等于1）</td>
</tr>
<tr>
<td>–without-http_upstream_ip_hash_module</td>
<td>禁用ngx_http_upstream_ip_hash_module支持（该模块用于简单的负载均衡）</td>
</tr>
<tr>
<td>–with-http_perl_module</td>
<td>启用ngx_http_perl_module支持（该模块使nginx可以直接使用perl或通过ssi调用perl）</td>
</tr>
<tr>
<td>–with-perl_modules_path=</td>
<td>设定perl模块路径</td>
</tr>
<tr>
<td>–with-perl=</td>
<td>设定perl库文件路径</td>
</tr>
<tr>
<td>–http-log-path=</td>
<td>设定access log路径</td>
</tr>
<tr>
<td>–http-client-body-temp-path=</td>
<td>设定http客户端请求临时文件路径</td>
</tr>
<tr>
<td>–http-proxy-temp-path=</td>
<td>设定http代理临时文件路径</td>
</tr>
<tr>
<td>–http-fastcgi-temp-path=</td>
<td>设定http fastcgi临时文件路径</td>
</tr>
<tr>
<td>–http-uwsgi-temp-path=</td>
<td>设定http uwsgi临时文件路径</td>
</tr>
<tr>
<td>–http-scgi-temp-path=</td>
<td>设定http scgi临时文件路径</td>
</tr>
<tr>
<td>-without-http</td>
<td>禁用http server功能</td>
</tr>
<tr>
<td>–without-http-cache</td>
<td>禁用http cache功能</td>
</tr>
<tr>
<td>–with-mail</td>
<td>启用POP3/IMAP4/SMTP代理模块支持</td>
</tr>
<tr>
<td>–with-mail_ssl_module</td>
<td>启用ngx_mail_ssl_module支持</td>
</tr>
<tr>
<td>–without-mail_pop3_module</td>
<td>禁用pop3协议（POP3即邮局协议的第3个版本,它是规定个人计算机如何连接到互联网上的邮件服务器进行收发邮件的协议。是因特网电子邮件的第一个离线协议标 准,POP3协议允许用户从服务器上把邮件存储到本地主机上,同时根据客户端的操作删除或保存在邮件服务器上的邮件。POP3协议是TCP/IP协议族中的一员，主要用于 支持使用客户端远程管理在服务器上的电子邮件）</td>
</tr>
<tr>
<td>–without-mail_imap_module</td>
<td>禁用imap协议（一种邮件获取协议。它的主要作用是邮件客户端可以通过这种协议从邮件服务器上获取邮件的信息，下载邮件等。IMAP协议运行在TCP/IP协议之上， 使用的端口是143。它与POP3协议的主要区别是用户可以不用把所有的邮件全部下载，可以通过客户端直接对服务器上的邮件进行操作。）</td>
</tr>
<tr>
<td>–without-mail_smtp_module</td>
<td>禁用smtp协议（SMTP即简单邮件传输协议,它是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。SMTP协议属于TCP/IP协议族，它帮助每台计算机在发送或中转信件时找到下一个目的地。）</td>
</tr>
<tr>
<td>–with-google_perftools_module</td>
<td>启用ngx_google_perftools_module支持（调试用，剖析程序性能瓶颈）</td>
</tr>
<tr>
<td>–with-cpp_test_module</td>
<td>启用ngx_cpp_test_module支持</td>
</tr>
<tr>
<td>–add-module=</td>
<td>启用外部模块支持</td>
</tr>
<tr>
<td>–with-cc=</td>
<td>指向C编译器路径 –with-cpp= 指向C预处理路径</td>
</tr>
<tr>
<td>–with-cc-opt=</td>
<td>设置C编译器参数（PCRE库，需要指定–with-cc-opt=”-I /usr/local/include”，如果使用select()函数则需要同时增加文件描述符数量，可以通过–with-cc- opt=”-D FD_SETSIZE=2048”指定。）</td>
</tr>
<tr>
<td>–with-ld-opt=</td>
<td>设置连接文件参数。（PCRE库，需要指定–with-ld-opt=”-L /usr/local/lib”。）</td>
</tr>
<tr>
<td>–with-cpu-opt=</td>
<td>指定编译的CPU，可用的值为: pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64 </td>
</tr>
<tr>
<td>–without-pcre</td>
<td>禁用pcre库</td>
</tr>
<tr>
<td>–with-pcre</td>
<td>启用pcre库</td>
</tr>
<tr>
<td>–with-pcre=</td>
<td>指向pcre库文件目录</td>
</tr>
<tr>
<td>–with-pcre-opt=</td>
<td>在编译时为pcre库设置附加参数</td>
</tr>
<tr>
<td>–with-md5=</td>
<td>指向md5库文件目录（消息摘要算法第五版，用以提供消息的完整性保护）</td>
</tr>
<tr>
<td>–with-md5-opt=</td>
<td>在编译时为md5库设置附加参数</td>
</tr>
<tr>
<td>–with-md5-asm</td>
<td>使用md5汇编源</td>
</tr>
<tr>
<td>–with-sha1=</td>
<td>指向sha1库目录（数字签名算法，主要用于数字签名）</td>
</tr>
<tr>
<td>–with-sha1-opt=</td>
<td>在编译时为sha1库设置附加参数</td>
</tr>
<tr>
<td>–with-sha1-asm</td>
<td>使用sha1汇编源</td>
</tr>
<tr>
<td>–with-zlib=</td>
<td>指向zlib库目录</td>
</tr>
<tr>
<td>–with-zlib-opt=</td>
<td>在编译时为zlib设置附加参数</td>
</tr>
<tr>
<td>–with-zlib-asm=</td>
<td>为指定的CPU使用zlib汇编源进行优化，CPU类型为pentium, pentiumpro</td>
</tr>
<tr>
<td>–with-libatomic</td>
<td>为原子内存的更新操作的实现提供一个架构</td>
</tr>
<tr>
<td>–with-libatomic=</td>
<td>指向libatomic_ops安装目录</td>
</tr>
<tr>
<td>–with-openssl=</td>
<td>指向openssl安装目录</td>
</tr>
<tr>
<td>–with-openssl-opt</td>
<td>在编译时为openssl设置附加参数</td>
</tr>
<tr>
<td>–with-debug</td>
<td>启用debug日志</td>
</tr>
</tbody>
</table>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/27/Web/Nginx/Nginx--源码安装.html" itemprop="url">
                  Nginx--源码安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-27T11:39:34+08:00" content="2016-01-27">
              2016-01-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/27/Web/Nginx/Nginx--源码安装.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/27/Web/Nginx/Nginx--源码安装.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/27/Web/Nginx/Nginx--源码安装.html" class="leancloud_visitors" data-flag-title="Nginx--源码安装">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h2><h3 id="系统版本"><a href="#系统版本" class="headerlink" title="系统版本"></a>系统版本</h3><p>系统环境默认采用<code>CentOS Linux release 7.1.1503 (Core)</code>，</p>
<h3 id="软件获取"><a href="#软件获取" class="headerlink" title="软件获取"></a>软件获取</h3><p>官方网站：<a href="http://nginx.org" target="_blank" rel="external">http://nginx.org</a><br>最新稳定版本：<a href="http://nginx.org/download/nginx-1.8.1.tar.gz" target="_blank" rel="external">nginx-1.8.1.tar.gz</a><br>帮助文档：<a href="http://nginx.org/en/docs" target="_blank" rel="external">http://nginx.org/en/docs</a><br>编译参数说明：<a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="external">http://nginx.org/en/docs/configure.html</a></p>
<h3 id="软件仓库"><a href="#软件仓库" class="headerlink" title="软件仓库"></a>软件仓库</h3><p>yum仓库包含<code>centos</code>官方和<code>epel</code>两个安装源<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://mirrors.yun-idc.com/epel/7/x86_64/e/epel-release-7-5.noarch.rpm</div></pre></td></tr></table></figure></p>
<h2 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h2><h3 id="安装依赖软件"><a href="#安装依赖软件" class="headerlink" title="安装依赖软件"></a>安装依赖软件</h3><ul>
<li><p>安装pcre</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 使用rewrite功能</div><div class="line">yum install pcre pcre-devel</div></pre></td></tr></table></figure>
</li>
<li><p>安装openssl</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\ 如果需要ssl支持,不需要可以不安装</div><div class="line">yum install openssl openssl-devel</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tar -zxf nginx-1.8.1.tar.gz </div><div class="line">cd nginx-1.8.1/</div><div class="line">./configure --prefix=/usr/local/nginx --with-http_ssl_module  --with-http_stub_status_module --with-pcre</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure>
<ul>
<li>–with-http_ssl_module            —支持https</li>
<li>–with-http_stub_status_module    —支持nginx状态查询</li>
<li>–with-pcre                       —支持rewrite</li>
</ul>
<h2 id="nginx启动、停止、重启"><a href="#nginx启动、停止、重启" class="headerlink" title="nginx启动、停止、重启"></a>nginx启动、停止、重启</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>现在nginx就可以启动，不需要更改任何配置文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">\\-c参数指定了配置文件的路径，如果不加-c，nginx就会默认加载其安装目录下面的conf目录下面的nginx.conf文件</div><div class="line">/usr/local/nginx/sbin/nginx</div></pre></td></tr></table></figure></p>
<h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx -s stop[quit,reopen,reload]</div></pre></td></tr></table></figure>
<p>Nginx的停止命令有很多，一般都是通过发送系统信号给nginx的主进程来停止nginx,例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">\\停止nginx</div><div class="line">kill –QUIT `主进程号`</div><div class="line">kill -QUIT `cat /usr/local/nginx/logs/nginx.pid`</div><div class="line"> </div><div class="line">\\快速停止nginx</div><div class="line">kill –TERM `主进程号`</div><div class="line">kill –TERM `cat /usr/local/nginx/logs/nginx.pid`</div><div class="line"></div><div class="line">kill –INT `主进程号`</div><div class="line">kill –INT`cat /usr/local/nginx/logs/nginx.pid`</div><div class="line"></div><div class="line">\\强制停止nginx</div><div class="line">Kill -9 nginx</div></pre></td></tr></table></figure></p>
<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/nginx/sbin/nginx -s reload[stop,quit,reopen]</div></pre></td></tr></table></figure>
<p>同样可以通过信号来重启nginx<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Kill –HUB `主进程号`</div><div class="line">kill –HUB `cat /usr/local/nginx/logs/nginx.pid`</div></pre></td></tr></table></figure></p>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/22/regex_fast_reference.html" itemprop="url">
                  常用正则速查
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-22T10:45:08+08:00" content="2016-01-22">
              2016-01-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/22/regex_fast_reference.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/22/regex_fast_reference.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/22/regex_fast_reference.html" class="leancloud_visitors" data-flag-title="常用正则速查">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="常用正则匹配"><a href="#常用正则匹配" class="headerlink" title="常用正则匹配"></a>常用正则匹配</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">&quot;^\d+$&quot;　　</div><div class="line">// 非负整数（正整数 + 0）</div><div class="line"></div><div class="line">&quot;^[0-9]*[1-9][0-9]*$&quot;　　</div><div class="line">// 正整数</div><div class="line"></div><div class="line">&quot;^((-\d+)|(0+))$&quot;　　</div><div class="line">// 非正整数（负整数 + 0）</div><div class="line"></div><div class="line">&quot;^-[0-9]*[1-9][0-9]*$&quot;　　</div><div class="line">// 负整数</div><div class="line"></div><div class="line">&quot;^-?\d+$&quot;</div><div class="line">// 整数</div><div class="line">&quot;^\d+(\.\d+)?$&quot;　　</div><div class="line">//非负浮点数（正浮点数 + 0）</div><div class="line"></div><div class="line">&quot;^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$&quot;　　</div><div class="line">//正浮点数</div><div class="line"></div><div class="line">&quot;^((-\d+(\.\d+)?)|(0+(\.0+)?))$&quot;　　</div><div class="line">//非正浮点数（负浮点数 + 0）</div><div class="line"></div><div class="line">&quot;^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$&quot;</div><div class="line">//负浮点数</div><div class="line"></div><div class="line">&quot;^(-?\d+)(\.\d+)?$&quot;　　</div><div class="line">//浮点数</div><div class="line"></div><div class="line">&quot;^[A-Za-z]+$&quot;　　</div><div class="line">//英文字母字符串</div><div class="line"></div><div class="line">&quot;^[A-Z]+$&quot;　　</div><div class="line">//英文大写字符串</div><div class="line"></div><div class="line">&quot;^[a-z]+$&quot;　　</div><div class="line">//英文小写字符串</div><div class="line"></div><div class="line">&quot;^[A-Za-z0-9]+$&quot;　　</div><div class="line">//数字和26个英文字符串</div><div class="line"></div><div class="line">&quot;^\w+$&quot;　</div><div class="line">//数字、英文或者下划线字符串</div><div class="line"></div><div class="line">&quot;^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$&quot;　　　　</div><div class="line">//email地址</div><div class="line"></div><div class="line">&quot;^[a-zA-z]+://(\w+(-\w+)*)(\.(\w+(-\w+)*))*(\?\S*)?$&quot;　　</div><div class="line">//url</div><div class="line"></div><div class="line">/^(d&#123;2&#125;|d&#123;4&#125;)-((0([1-9]&#123;1&#125;))|(1[1|2]))-(([0-2]([1-9]&#123;1&#125;))|(3[0|1]))$/ </div><div class="line">// 年-月-日</div><div class="line"></div><div class="line">/^((0([1-9]&#123;1&#125;))|(1[1|2]))/(([0-2]([1-9]&#123;1&#125;))|(3[0|1]))/(d&#123;2&#125;|d&#123;4&#125;)$/ </div><div class="line">// 月/日/年</div><div class="line"></div><div class="line">&quot;^([w-.]+)@(([[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.)|(([w-]+.)+))([a-zA-Z]&#123;2,4&#125;|[0-9]&#123;1,3&#125;)(]?)$&quot; </div><div class="line">// Emil</div><div class="line"></div><div class="line">/^((\+?[0-9]&#123;2,4&#125;\-[0-9]&#123;3,4&#125;\-)|([0-9]&#123;3,4&#125;\-))?([0-9]&#123;7,8&#125;)(\-[0-9]+)?$/ </div><div class="line">// 电话号码</div><div class="line"></div><div class="line">&quot;^(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5]).(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5]).(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5]).(d&#123;1,2&#125;|1dd|2[0-4]d|25[0-5])$&quot; </div><div class="line">// IP地址</div><div class="line"></div><div class="line">匹配中文字符的正则表达式：[\u4e00-\u9fa5]</div><div class="line">匹配双字节字符(包括汉字在内)：[^\x00-\xff]</div><div class="line">匹配空行的正则表达式：\n[\s| ]*\r</div><div class="line">匹配HTML标记的正则表达式：/&lt;(.*)&gt;.*&lt;\/\1&gt;|&lt;(.*) \/&gt;/</div><div class="line">匹配首尾空格的正则表达式：(^\s*)|(\s*$)</div><div class="line">匹配Email地址的正则表达式：\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</div><div class="line"></div><div class="line">匹配网址URL的正则表达式：^[a-zA-z]+://(\\w+(-\\w+)*)(\\.(\\w+(-\\w+)*))*(\\?\\S*)?$</div><div class="line">匹配帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$</div><div class="line">匹配国内电话号码：(\d&#123;3&#125;-|\d&#123;4&#125;-)?(\d&#123;8&#125;|\d&#123;7&#125;)?</div><div class="line">匹配腾讯QQ号：^[1-9]*[1-9][0-9]*$</div></pre></td></tr></table></figure>
<h3 id="元字符及其在正则表达式上下文中的行为"><a href="#元字符及其在正则表达式上下文中的行为" class="headerlink" title="元字符及其在正则表达式上下文中的行为"></a>元字符及其在正则表达式上下文中的行为</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">\ 将下一个字符标记为一个特殊字符、或一个原义字符、或一个后向引用、或一个八进制转义符。</div><div class="line">^ 匹配输入字符串的开始位置。如果设置了 RegExp 对象的Multiline 属性，^ 也匹配 ’\n’ 或 ’\r’ 之后的位置。</div><div class="line">$ 匹配输入字符串的结束位置。如果设置了 RegExp 对象的Multiline 属性，$ 也匹配 ’\n’ 或 ’\r’ 之前的位置。</div><div class="line">* 匹配前面的子表达式零次或多次。</div><div class="line">+ 匹配前面的子表达式一次或多次。+ 等价于 &#123;1,&#125;。</div><div class="line">? 匹配前面的子表达式零次或一次。? 等价于 &#123;0,1&#125;。</div><div class="line">&#123;n&#125; n 是一个非负整数，匹配确定的n 次。</div><div class="line">&#123;n,&#125; n 是一个非负整数，至少匹配n 次。</div><div class="line">&#123;n,m&#125; m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。在逗号和两个数之间不能有空格。</div><div class="line">? 当该字符紧跟在任何一个其他限制符 (*, +, ?, &#123;n&#125;, &#123;n,&#125;, &#123;n,m&#125;) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。</div><div class="line">. 匹配除 “\n” 之外的任何单个字符。要匹配包括 ’\n’ 在内的任何字符，请使用象 ’[.\n]’ 的模式。</div><div class="line">(pattern) 匹配pattern 并获取这一匹配。</div><div class="line">(?:pattern) 匹配pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。</div><div class="line">(?=pattern) 正向预查，在任何匹配 pattern 的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。</div><div class="line">(?!pattern) 负向预查，与(?=pattern)作用相反</div><div class="line">x|y 匹配 x 或 y。</div><div class="line">[xyz] 字符集合。</div><div class="line">[^xyz] 负值字符集合。</div><div class="line">[a-z] 字符范围，匹配指定范围内的任意字符。</div><div class="line">[^a-z] 负值字符范围，匹配任何不在指定范围内的任意字符。</div><div class="line">\b 匹配一个单词边界，也就是指单词和空格间的位置。</div><div class="line">\B 匹配非单词边界。</div><div class="line">\cx 匹配由x指明的控制字符。</div><div class="line">\d 匹配一个数字字符。等价于 [0-9]。</div><div class="line">\D 匹配一个非数字字符。等价于 [^0-9]。</div><div class="line">\f 匹配一个换页符。等价于 \x0c 和 \cL。</div><div class="line">\n 匹配一个换行符。等价于 \x0a 和 \cJ。</div><div class="line">\r 匹配一个回车符。等价于 \x0d 和 \cM。</div><div class="line">\s 匹配任何空白字符，包括空格、制表符、换页符等等。等价于[ \f\n\r\t\v]。</div><div class="line">\S 匹配任何非空白字符。等价于 [^ \f\n\r\t\v]。</div><div class="line">\t 匹配一个制表符。等价于 \x09 和 \cI。</div><div class="line">\v 匹配一个垂直制表符。等价于 \x0b 和 \cK。</div><div class="line">\w 匹配包括下划线的任何单词字符。等价于’[A-Za-z0-9_]’。</div><div class="line">\W 匹配任何非单词字符。等价于 ’[^A-Za-z0-9_]’。</div><div class="line">\xn 匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。</div><div class="line">\num 匹配 num，其中num是一个正整数。对所获取的匹配的引用。</div><div class="line">\n 标识一个八进制转义值或一个后向引用。如果 \n 之前至少 n 个获取的子表达式，则 n 为后向引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。</div><div class="line">\nm 标识一个八进制转义值或一个后向引用。如果 \nm 之前至少有is preceded by at least nm 个获取得子表达式，则 nm 为后向引用。如果 \nm 之前至少有 n 个获取，则 n 为一个后跟文字 m 的后向引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 \nm 将匹配八进制转义值 nm。</div><div class="line">\nml 如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。</div><div class="line">\un 匹配 n，其中 n 是一个用四个十六进制数字表示的Unicode字符。</div><div class="line">匹配中文字符的正则表达式：[u4e00-u9fa5]</div><div class="line">匹配双字节字符(包括汉字在内)：[^x00-xff]</div><div class="line">匹配空行的正则表达式：n[s| ]*r</div><div class="line">匹配HTML标记的正则表达式：/&lt;(.*)&gt;.*&lt;/1&gt;|&lt;(.*) /&gt;/</div><div class="line">匹配首尾空格的正则表达式：(^s*)|(s*$)</div><div class="line">匹配Email地址的正则表达式：w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*</div><div class="line">匹配网址URL的正则表达式：http://([w-]+.)+[w-]+(/[w- ./?%&amp;=]*)?</div><div class="line">利用正则表达式限制网页表单里的文本框输入内容：</div><div class="line">用 正则表达式限制只能输入中文：onkeyup=”value=value.replace(/[^u4E00-u9FA5]/g,”)” onbeforepaste=”clipboardData.setData(‘text’,clipboardData.getData(‘text’).replace(/[^u4E00-u9FA5]/g,”))”</div><div class="line">用 正则表达式限制只能输入全角字符： onkeyup=”value=value.replace(/[^uFF00-uFFFF]/g,”)” onbeforepaste=”clipboardData.setData(‘text’,clipboardData.getData(‘text’).replace(/[^uFF00-uFFFF]/g,”))”</div><div class="line">用 正则表达式限制只能输入数字：onkeyup=”value=value.replace(/[^d]/g,”) “onbeforepaste=”clipboardData.setData(‘text’,clipboardData.getData(‘text’).replace(/[^d]/g,”))”</div><div class="line">用 正则表达式限制只能输入数字和英文：onkeyup=”value=value.replace(/[W]/g,”) “onbeforepaste=”clipboardData.setData(‘text’,clipboardData.getData(‘text’).replace(/[^d]/g,”))”</div></pre></td></tr></table></figure>
<h3 id="常用正则式"><a href="#常用正则式" class="headerlink" title="常用正则式"></a>常用正则式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">匹配中文字符的正则表达式：[\u4e00-\u9fa5]</div><div class="line">匹配双字节字符(包括汉字在内)：[^\x00-\xff]</div><div class="line">匹配空行的正则表达式：\n[\s| ]*\r</div><div class="line">匹配HTML标记的正则表达式：/&lt;(.*)&gt;.*&lt;\/\1&gt;|&lt;(.*) \/&gt;/</div><div class="line">匹配首尾空格的正则表达式：(^\s*)|(\s*$)</div><div class="line">匹配IP地址的正则表达式：/(\d+)\.(\d+)\.(\d+)\.(\d+)/g //</div><div class="line">匹配Email地址的正则表达式：\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</div><div class="line">匹配网址URL的正则表达式：http://(/[\w-]+\.)+[\w-]+(/[\w- ./?%&amp;=]*)?</div><div class="line">sql语句：^(select|drop|delete|create|update|insert).*$</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">1、非负整数：^\d+$</div><div class="line">2、正整数：^[0-9]*[1-9][0-9]*$</div><div class="line">3、非正整数：^((-\d+)|(0+))$</div><div class="line">4、负整数：^-[0-9]*[1-9][0-9]*$</div><div class="line">5、整数：^-?\d+$</div><div class="line">6、非负浮点数：^\d+(\.\d+)?$</div><div class="line">7、正浮点数：^((0-9)+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</div><div class="line">8、非正浮点数：^((-\d+\.\d+)?)|(0+(\.0+)?))$</div><div class="line">9、负浮点数：^(-((正浮点数正则式)))$</div><div class="line">10、英文字符串：^[A-Za-z]+$</div><div class="line">11、英文大写串：^[A-Z]+$</div><div class="line">12、英文小写串：^[a-z]+$</div><div class="line">13、英文字符数字串：^[A-Za-z0-9]+$</div><div class="line">14、英数字加下划线串：^\w+$</div><div class="line">15、E-mail地址：^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$</div><div class="line">16、URL：^[a-zA-Z]+://(\w+(-\w+)*)(\.(\w+(-\w+)*))*(\?\s*)?$</div><div class="line">17、邮政编码：^[1-9]\d&#123;5&#125;$</div><div class="line">18、中文：^[\u0391-\uFFE5]+$</div><div class="line">19、电话号码：^((\(\d&#123;2,3&#125;\))|(\d&#123;3&#125;\-))?(\(0\d&#123;2,3&#125;\)|0\d&#123;2,3&#125;-)?[1-9]\d&#123;6,7&#125;(\-\d&#123;1,4&#125;)?$</div><div class="line">20、手机号码：^((\(\d&#123;2,3&#125;\))|(\d&#123;3&#125;\-))?13\d&#123;9&#125;$</div><div class="line">21、双字节字符(包括汉字在内)：^\x00-\xff</div><div class="line">22、匹配首尾空格：(^\s*)|(\s*$)（像vbscript那样的trim函数）</div><div class="line">23、匹配HTML标记：&lt;(.*)&gt;.*&lt;\/\1&gt;|&lt;(.*) \/&gt;</div><div class="line">24、匹配空行：\n[\s| ]*\r</div><div class="line">25、提取信息中的网络链接：(h|H)(r|R)(e|E)(f|F) *= *(‘|”)?(\w|\\|\/|\.)+(‘|”| *|&gt;)?</div><div class="line">26、提取信息中的邮件地址：\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</div><div class="line">27、提取信息中的图片链接：(s|S)(r|R)(c|C) *= *(‘|”)?(\w|\\|\/|\.)+(‘|”| *|&gt;)?</div><div class="line">28、提取信息中的IP地址：(\d+)\.(\d+)\.(\d+)\.(\d+)</div><div class="line">29、提取信息中的中国手机号码：(86)*0*13\d&#123;9&#125;</div><div class="line">30、提取信息中的中国固定电话号码：(\(\d&#123;3,4&#125;\)|\d&#123;3,4&#125;-|\s)?\d&#123;8&#125;</div><div class="line">31、提取信息中的中国电话号码（包括移动和固定电话）：(\(\d&#123;3,4&#125;\)|\d&#123;3,4&#125;-|\s)?\d&#123;7,14&#125;</div><div class="line">32、提取信息中的中国邮政编码：[1-9]&#123;1&#125;(\d+)&#123;5&#125;</div><div class="line">33、提取信息中的浮点数（即小数）：(-?\d*)\.?\d+</div><div class="line">34、提取信息中的任何数字：(-?\d*)(\.\d+)?</div><div class="line">35、IP：(\d+)\.(\d+)\.(\d+)\.(\d+)</div><div class="line">36、电话区号：/^0\d&#123;2,3&#125;$/</div><div class="line">37、腾讯QQ号：^[1-9]*[1-9][0-9]*$</div><div class="line">38、帐号(字母开头，允许5-16字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$</div><div class="line">39、中文、英文、数字及下划线：^[\u4e00-\u9fa5_a-zA-Z0-9]+$</div></pre></td></tr></table></figure>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/21/http-status-code.html" itemprop="url">
                  Http状态码详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-21T16:05:14+08:00" content="2016-01-21">
              2016-01-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/21/http-status-code.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/21/http-status-code.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/21/http-status-code.html" class="leancloud_visitors" data-flag-title="Http状态码详解">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="什么是HTTP状态码"><a href="#什么是HTTP状态码" class="headerlink" title="什么是HTTP状态码"></a>什么是HTTP状态码</h2><p>HTTP状态码（HTTP Status Code）是用以表示网页服务器HTTP响应状态的3位数字代码。它由 RFC 2616 规范定义的，并得到RFC 2518、RFC 2817、RFC 2295、RFC 2774、RFC 4918等规范扩展。所有状态码的第一个数字代表了响应的五种状态之一。</p>
<h2 id="状态码具体含义"><a href="#状态码具体含义" class="headerlink" title="状态码具体含义"></a>状态码具体含义</h2><h3 id="消息-1xx"><a href="#消息-1xx" class="headerlink" title="消息(1xx)"></a>消息(1xx)</h3><p>这一类型的状态码，代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束。由于 HTTP/1.0 协议中没有定义任何 1xx 状态码，所以除非在某些试验条件下，服务器禁止向此类客户端发送 1xx 响应。</p>
<ul>
<li><p>100<br>客户端应当继续发送请求。这个临时响应是用来通知客户端它的部分请求已经被服务器接收，且仍未被拒绝。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。服务器必须在请求完成后向客户端发送一个最终响应。</p>
</li>
<li><p>101<br>服务器已经理解了客户端的请求，并将通过Upgrade 消息头通知客户端采用不同的协议来完成这个请求。在发送完这个响应最后的空行后，服务器将会切换到在Upgrade 消息头中定义的那些协议。 只有在切换新的协议更有好处的时候才应该采取类似措施。例如，切换到新的HTTP 版本比旧版本更有优势，或者切换到一个实时且同步的协议以传送利用此类特性的资源。</p>
</li>
<li><p>102<br>由WebDAV（RFC 2518）扩展的状态码，代表处理将被继续执行。</p>
</li>
</ul>
<h3 id="成功-2xx"><a href="#成功-2xx" class="headerlink" title="成功(2xx)"></a>成功(2xx)</h3><p>这一类型的状态码，代表请求已成功被服务器接收、理解、并接受。</p>
<ul>
<li>200</li>
</ul>
<p>请求已成功，请求所希望的响应头或数据体将随此响应返回。</p>
<ul>
<li>201</li>
</ul>
<p>请求已经被实现，而且有一个新的资源已经依据请求的需要而建立，且其 URI 已经随Location 头信息返回。假如需要的资源无法及时建立的话，应当返回 ‘202 Accepted’。</p>
<ul>
<li>202</li>
</ul>
<p>服务器已接受请求，但尚未处理。正如它可能被拒绝一样，最终该请求可能会也可能不会被执行。在异步操作的场合下，没有比发送这个状态码更方便的做法了。 返回202状态码的响应的目的是允许服务器接受其他过程的请求（例如某个每天只执行一次的基于批处理的操作），而不必让客户端一直保持与服务器的连接直到批处理操作全部完成。在接受请求处理并返回202状态码的响应应当在返回的实体中包含一些指示处理当前状态的信息，以及指向处理状态监视器或状态预测的指针，以便用户能够估计操作是否已经完成。</p>
<ul>
<li>203</li>
</ul>
<p>服务器已成功处理了请求，但返回的实体头部元信息不是在原始服务器上有效的确定集合，而是来自本地或者第三方的拷贝。当前的信息可能是原始版本的子集或者超集。例如，包含资源的元数据可能导致原始服务器知道元信息的超级。使用此状态码不是必须的，而且只有在响应不使用此状态码便会返回200 OK的情况下才是合适的。</p>
<ul>
<li>204</li>
</ul>
<p>服务器成功处理了请求，但不需要返回任何实体内容，并且希望返回更新了的元信息。响应可能通过实体头部的形式，返回新的或更新后的元信息。如果存在这些头部信息，则应当与所请求的变量相呼应。 如果客户端是浏览器的话，那么用户浏览器应保留发送了该请求的页面，而不产生任何文档视图上的变化，即使按照规范新的或更新后的元信息应当被应用到用户浏览器活动视图中的文档。 由于204响应被禁止包含任何消息体，因此它始终以消息头后的第一个空行结尾。</p>
<ul>
<li>205</li>
</ul>
<p>服务器成功处理了请求，且没有返回任何内容。但是与204响应不同，返回此状态码的响应要求请求者重置文档视图。该响应主要是被用于接受用户输入后，立即重置表单，以便用户能够轻松地开始另一次输入。 与204响应一样，该响应也被禁止包含任何消息体，且以消息头后的第一个空行结束。</p>
<ul>
<li>206</li>
</ul>
<p>服务器已经成功处理了部分 GET 请求。类似于 FlashGet 或者迅雷这类的 HTTP 下载工具都是使用此类响应实现断点续传或者将一个大文档分解为多个下载段同时下载。 该请求必须包含 Range 头信息来指示客户端希望得到的内容范围，并且可能包含 If-Range 来作为请求条件。 响应必须包含如下的头部域： Content-Range 用以指示本次响应中返回的内容的范围；如果是 Content-Type 为 multipart/byteranges 的多段下载，则每一 multipart 段中都应包含 Content-Range 域用以指示本段的内容范围。假如响应中包含 Content-Length，那么它的数值必须匹配它返回的内容范围的真实字节数。 Date ETag 和/或 Content-Location，假如同样的请求本应该返回200响应。 Expires, Cache-Control，和/或 Vary，假如其值可能与之前相同变量的其他响应对应的值不同的话。 假如本响应请求使用了 If-Range 强缓存验证，那么本次响应不应该包含其他实体头；假如本响应的请求使用了 If-Range 弱缓存验证，那么本次响应禁止包含其他实体头；这避免了缓存的实体内容和更新了的实体头信息之间的不一致。否则，本响应就应当包含所有本应该返回200响应中应当返回的所有实体头部域。 假如 ETag 或 Last-Modified 头部不能精确匹配的话，则客户端缓存应禁止将206响应返回的内容与之前任何缓存过的内容组合在一起。 任何不支持 Range 以及 Content-Range 头的缓存都禁止缓存206响应返回的内容。</p>
<ul>
<li>207</li>
</ul>
<p>由WebDAV(RFC 2518)扩展的状态码，代表之后的消息体将是一个XML消息，并且可能依照之前子请求数量的不同，包含一系列独立的响应代码。</p>
<h3 id="重定向-3xx"><a href="#重定向-3xx" class="headerlink" title="重定向(3xx)"></a>重定向(3xx)</h3><p>这类状态码代表需要客户端采取进一步的操作才能完成请求。通常，这些状态码用来重定向，后续的请求地址（重定向目标）在本次响应的 Location 域中指明。 当且仅当后续的请求所使用的方法是 GET 或者 HEAD 时，用户浏览器才可以在没有用户介入的情况下自动提交所需要的后续请求。客户端应当自动监测无限循环重定向（例如：A-&gt;A，或者A-&gt;B-&gt;C-&gt;A），因为这会导致服务器和客户端大量不必要的资源消耗。按照 HTTP/1.0 版规范的建议，浏览器不应自动访问超过5次的重定向。</p>
<ul>
<li>300</li>
</ul>
<p>被请求的资源有一系列可供选择的回馈信息，每个都有自己特定的地址和浏览器驱动的商议信息。用户或浏览器能够自行选择一个首选的地址进行重定向。 除非这是一个 HEAD 请求，否则该响应应当包括一个资源特性及地址的列表的实体，以便用户或浏览器从中选择最合适的重定向地址。这个实体的格式由 Content-Type 定义的格式所决定。浏览器可能根据响应的格式以及浏览器自身能力，自动作出最合适的选择。当然，RFC 2616规范并没有规定这样的自动选择该如何进行。 如果服务器本身已经有了首选的回馈选择，那么在 Location 中应当指明这个回馈的 URI；浏览器可能会将这个 Location 值作为自动重定向的地址。此外，除非额外指定，否则这个响应也是可缓存的。</p>
<ul>
<li>301</li>
</ul>
<p>被请求的资源已永久移动到新位置，并且将来任何对此资源的引用都应该使用本响应返回的若干个 URI 之一。如果可能，拥有链接编辑功能的客户端应当自动把请求的地址修改为从服务器反馈回来的地址。除非额外指定，否则这个响应也是可缓存的。 新的永久性的 URI 应当在响应的 Location 域中返回。除非这是一个 HEAD 请求，否则响应的实体中应当包含指向新的 URI 的超链接及简短说明。 如果这不是一个 GET 或者 HEAD 请求，因此浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。 注意：对于某些使用 HTTP/1.0 协议的浏览器，当它们发送的 POST 请求得到了一个301响应的话，接下来的重定向请求将会变成 GET 方式。</p>
<ul>
<li>302</li>
</ul>
<p>请求的资源现在临时从不同的 URI 响应请求。由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求。只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的。 新的临时性的 URI 应当在响应的 Location 域中返回。除非这是一个 HEAD 请求，否则响应的实体中应当包含指向新的 URI 的超链接及简短说明。 如果这不是一个 GET 或者 HEAD 请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。 注意：虽然RFC 1945和RFC 2068规范不允许客户端在重定向时改变请求的方法，但是很多现存的浏览器将302响应视作为303响应，并且使用 GET 方式访问在 Location 中规定的 URI，而无视原先请求的方法。状态码303和307被添加了进来，用以明确服务器期待客户端进行何种反应。</p>
<ul>
<li>303</li>
</ul>
<p>对应当前请求的响应可以在另一个 URI 上被找到，而且客户端应当采用 GET 的方式访问那个资源。这个方法的存在主要是为了允许由脚本激活的POST请求输出重定向到一个新的资源。这个新的 URI 不是原始资源的替代引用。同时，303响应禁止被缓存。当然，第二个请求（重定向）可能被缓存。 新的 URI 应当在响应的 Location 域中返回。除非这是一个 HEAD 请求，否则响应的实体中应当包含指向新的 URI 的超链接及简短说明。 注意：许多 HTTP/1.1 版以前的 浏览器不能正确理解303状态。如果需要考虑与这些浏览器之间的互动，302状态码应该可以胜任，因为大多数的浏览器处理302响应时的方式恰恰就是上述规范要求客户端处理303响应时应当做的。</p>
<ul>
<li>304</li>
</ul>
<p>如果客户端发送了一个带条件的 GET 请求且该请求已被允许，而文档的内容（自上次访问以来或者根据请求的条件）并没有改变，则服务器应当返回这个状态码。304响应禁止包含消息体，因此始终以消息头后的第一个空行结尾。 该响应必须包含以下的头信息： Date，除非这个服务器没有时钟。假如没有时钟的服务器也遵守这些规则，那么代理服务器以及客户端可以自行将 Date 字段添加到接收到的响应头中去（正如RFC 2068中规定的一样），缓存机制将会正常工作。 ETag 和/或 Content-Location，假如同样的请求本应返回200响应。 Expires, Cache-Control，和/或Vary，假如其值可能与之前相同变量的其他响应对应的值不同的话。 假如本响应请求使用了强缓存验证，那么本次响应不应该包含其他实体头；否则（例如，某个带条件的 GET 请求使用了弱缓存验证），本次响应禁止包含其他实体头；这避免了缓存了的实体内容和更新了的实体头信息之间的不一致。 假如某个304响应指明了当前某个实体没有缓存，那么缓存系统必须忽视这个响应，并且重复发送不包含限制条件的请求。 假如接收到一个要求更新某个缓存条目的304响应，那么缓存系统必须更新整个条目以反映所有在响应中被更新的字段的值。</p>
<ul>
<li>305</li>
</ul>
<p>被请求的资源必须通过指定的代理才能被访问。Location 域中将给出指定的代理所在的 URI 信息，接收者需要重复发送一个单独的请求，通过这个代理才能访问相应资源。只有原始服务器才能建立305响应。 注意：RFC 2068中没有明确305响应是为了重定向一个单独的请求，而且只能被原始服务器建立。忽视这些限制可能导致严重的安全后果。</p>
<ul>
<li>306</li>
</ul>
<p>在最新版的规范中，306状态码已经不再被使用。</p>
<ul>
<li>307</li>
</ul>
<p>请求的资源现在临时从不同的URI 响应请求。由于这样的重定向是临时的，客户端应当继续向原有地址发送以后的请求。只有在Cache-Control或Expires中进行了指定的情况下，这个响应才是可缓存的。 新的临时性的URI 应当在响应的 Location 域中返回。除非这是一个HEAD 请求，否则响应的实体中应当包含指向新的URI 的超链接及简短说明。因为部分浏览器不能识别307响应，因此需要添加上述必要信息以便用户能够理解并向新的 URI 发出访问请求。 如果这不是一个GET 或者 HEAD 请求，那么浏览器禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。</p>
<h3 id="请求错误-4xx"><a href="#请求错误-4xx" class="headerlink" title="请求错误(4xx)"></a>请求错误(4xx)</h3><p>这类的状态码代表了客户端看起来可能发生了错误，妨碍了服务器的处理。除非响应的是一个 HEAD 请求，否则服务器就应该返回一个解释当前错误状况的实体，以及这是临时的还是永久性的状况。这些状态码适用于任何请求方法。浏览器应当向用户显示任何包含在此类错误响应中的实体内容。 如果错误发生时客户端正在传送数据，那么使用TCP的服务器实现应当仔细确保在关闭客户端与服务器之间的连接之前，客户端已经收到了包含错误信息的数据包。如果客户端在收到错误信息后继续向服务器发送数据，服务器的TCP栈将向客户端发送一个重置数据包，以清除该客户端所有还未识别的输入缓冲，以免这些数据被服务器上的应用程序读取并干扰后者。</p>
<ul>
<li>400</li>
</ul>
<p>1、语义有误，当前请求无法被服务器理解。除非进行修改，否则客户端不应该重复提交这个请求。<br>2、请求参数有误。</p>
<ul>
<li>401</li>
</ul>
<p>当前请求需要用户验证。该响应必须包含一个适用于被请求资源的 WWW-Authenticate 信息头用以询问用户信息。客户端可以重复提交一个包含恰当的 Authorization 头信息的请求。如果当前请求已经包含了 Authorization 证书，那么401响应代表着服务器验证已经拒绝了那些证书。如果401响应包含了与前一个响应相同的身份验证询问，且浏览器已经至少尝试了一次验证，那么浏览器应当向用户展示响应中包含的实体信息，因为这个实体信息中可能包含了相关诊断信息。参见RFC 2617。</p>
<ul>
<li>402</li>
</ul>
<p>该状态码是为了将来可能的需求而预留的。</p>
<ul>
<li>403</li>
</ul>
<p>服务器已经理解请求，但是拒绝执行它。与401响应不同的是，身份验证并不能提供任何帮助，而且这个请求也不应该被重复提交。如果这不是一个 HEAD 请求，而且服务器希望能够讲清楚为何请求不能被执行，那么就应该在实体内描述拒绝的原因。当然服务器也可以返回一个404响应，假如它不希望让客户端获得任何信息。</p>
<ul>
<li>404</li>
</ul>
<p>请求失败，请求所希望得到的资源未被在服务器上发现。没有信息能够告诉用户这个状况到底是暂时的还是永久的。假如服务器知道情况的话，应当使用410状态码来告知旧资源因为某些内部的配置机制问题，已经永久的不可用，而且没有任何可以跳转的地址。404这个状态码被广泛应用于当服务器不想揭示到底为何请求被拒绝或者没有其他适合的响应可用的情况下。</p>
<ul>
<li>405</li>
</ul>
<p>请求行中指定的请求方法不能被用于请求相应的资源。该响应必须返回一个Allow 头信息用以表示出当前资源能够接受的请求方法的列表。 鉴于 PUT，DELETE 方法会对服务器上的资源进行写操作，因而绝大部分的网页服务器都不支持或者在默认配置下不允许上述请求方法，对于此类请求均会返回405错误。</p>
<ul>
<li>406</li>
</ul>
<p>请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体。 除非这是一个 HEAD 请求，否则该响应就应当返回一个包含可以让用户或者浏览器从中选择最合适的实体特性以及地址列表的实体。实体的格式由 Content-Type 头中定义的媒体类型决定。浏览器可以根据格式及自身能力自行作出最佳选择。但是，规范中并没有定义任何作出此类自动选择的标准。</p>
<ul>
<li>407</li>
</ul>
<p>与401响应类似，只不过客户端必须在代理服务器上进行身份验证。代理服务器必须返回一个 Proxy-Authenticate 用以进行身份询问。客户端可以返回一个 Proxy-Authorization 信息头用以验证。参见RFC 2617。</p>
<ul>
<li>408</li>
</ul>
<p>请求超时。客户端没有在服务器预备等待的时间内完成一个请求的发送。客户端可以随时再次提交这一请求而无需进行任何更改。</p>
<ul>
<li>409</li>
</ul>
<p>由于和被请求的资源的当前状态之间存在冲突，请求无法完成。这个代码只允许用在这样的情况下才能被使用：用户被认为能够解决冲突，并且会重新提交新的请求。该响应应当包含足够的信息以便用户发现冲突的源头。 冲突通常发生于对 PUT 请求的处理中。例如，在采用版本检查的环境下，某次 PUT 提交的对特定资源的修改请求所附带的版本信息与之前的某个（第三方）请求向冲突，那么此时服务器就应该返回一个409错误，告知用户请求无法完成。此时，响应实体中很可能会包含两个冲突版本之间的差异比较，以便用户重新提交归并以后的新版本。</p>
<ul>
<li>410</li>
</ul>
<p>被请求的资源在服务器上已经不再可用，而且没有任何已知的转发地址。这样的状况应当被认为是永久性的。如果可能，拥有链接编辑功能的客户端应当在获得用户许可后删除所有指向这个地址的引用。如果服务器不知道或者无法确定这个状况是否是永久的，那么就应该使用404状态码。除非额外说明，否则这个响应是可缓存的。 410响应的目的主要是帮助网站管理员维护网站，通知用户该资源已经不再可用，并且服务器拥有者希望所有指向这个资源的远端连接也被删除。这类事件在限时、增值服务中很普遍。同样，410响应也被用于通知客户端在当前服务器站点上，原本属于某个个人的资源已经不再可用。当然，是否需要把所有永久不可用的资源标记为’410 Gone’，以及是否需要保持此标记多长时间，完全取决于服务器拥有者。</p>
<ul>
<li>411</li>
</ul>
<p>服务器拒绝在没有定义 Content-Length 头的情况下接受请求。在添加了表明请求消息体长度的有效 Content-Length 头之后，客户端可以再次提交该请求。</p>
<ul>
<li>412</li>
</ul>
<p>服务器在验证在请求的头字段中给出先决条件时，没能满足其中的一个或多个。这个状态码允许客户端在获取资源时在请求的元信息（请求头字段数据）中设置先决条件，以此避免该请求方法被应用到其希望的内容以外的资源上。</p>
<ul>
<li>413</li>
</ul>
<p>服务器拒绝处理当前请求，因为该请求提交的实体数据大小超过了服务器愿意或者能够处理的范围。此种情况下，服务器可以关闭连接以免客户端继续发送此请求。 如果这个状况是临时的，服务器应当返回一个 Retry-After 的响应头，以告知客户端可以在多少时间以后重新尝试。</p>
<ul>
<li>414</li>
</ul>
<p>请求的URI 长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。这比较少见，通常的情况包括： 本应使用POST方法的表单提交变成了GET方法，导致查询字符串（Query String）过长。 重定向URI “黑洞”，例如每次重定向把旧的 URI 作为新的 URI 的一部分，导致在若干次重定向后 URI 超长。 客户端正在尝试利用某些服务器中存在的安全漏洞攻击服务器。这类服务器使用固定长度的缓冲读取或操作请求的 URI，当 GET 后的参数超过某个数值后，可能会产生缓冲区溢出，导致任意代码被执行[1]。没有此类漏洞的服务器，应当返回414状态码。</p>
<ul>
<li>415</li>
</ul>
<p>对于当前请求的方法和所请求的资源，请求中提交的实体并不是服务器中所支持的格式，因此请求被拒绝。</p>
<ul>
<li>416</li>
</ul>
<p>如果请求中包含了 Range 请求头，并且 Range 中指定的任何数据范围都与当前资源的可用范围不重合，同时请求中又没有定义 If-Range 请求头，那么服务器就应当返回416状态码。 假如 Range 使用的是字节范围，那么这种情况就是指请求指定的所有数据范围的首字节位置都超过了当前资源的长度。服务器也应当在返回416状态码的同时，包含一个 Content-Range 实体头，用以指明当前资源的长度。这个响应也被禁止使用 multipart/byteranges 作为其 Content-Type。</p>
<ul>
<li>417</li>
</ul>
<p>在请求头 Expect 中指定的预期内容无法被服务器满足，或者这个服务器是一个代理服务器，它有明显的证据证明在当前路由的下一个节点上，Expect 的内容无法被满足。</p>
<ul>
<li>421</li>
</ul>
<p>从当前客户端所在的IP地址到服务器的连接数超过了服务器许可的最大范围。通常，这里的IP地址指的是从服务器上看到的客户端地址（比如用户的网关或者代理服务器地址）。在这种情况下，连接数的计算可能涉及到不止一个终端用户。</p>
<ul>
<li>422</li>
</ul>
<p>请求格式正确，但是由于含有语义错误，无法响应。（RFC 4918 WebDAV）423 Locked 当前资源被锁定。（RFC 4918 WebDAV）</p>
<ul>
<li>424</li>
</ul>
<p>由于之前的某个请求发生的错误，导致当前请求失败，例如 PROPPATCH。（RFC 4918 WebDAV）</p>
<ul>
<li>425</li>
</ul>
<p>在WebDav Advanced Collections 草案中定义，但是未出现在《WebDAV 顺序集协议》（RFC 3658）中。</p>
<ul>
<li>426</li>
</ul>
<p>客户端应当切换到TLS/1.0。（RFC 2817）</p>
<ul>
<li>449</li>
</ul>
<p>由微软扩展，代表请求应当在执行完适当的操作后进行重试。</p>
<h3 id="服务器错误-5xx"><a href="#服务器错误-5xx" class="headerlink" title="服务器错误(5xx)"></a>服务器错误(5xx)</h3><p>这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生，也有可能是服务器意识到以当前的软硬件资源无法完成对请求的处理。除非这是一个HEAD 请求，否则服务器应当包含一个解释当前错误状态以及这个状况是临时的还是永久的解释信息实体。浏览器应当向用户展示任何在当前响应中被包含的实体。 这些状态码适用于任何响应方法。</p>
<ul>
<li>500</li>
</ul>
<p>服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器的程序码出错时出现。</p>
<ul>
<li>501</li>
</ul>
<p>服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。</p>
<ul>
<li>502</li>
</ul>
<p>作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。</p>
<ul>
<li>503</li>
</ul>
<p>由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。如果能够预计延迟时间，那么响应中可以包含一个 Retry-After 头用以标明这个延迟时间。如果没有给出这个 Retry-After 信息，那么客户端应当以处理500响应的方式处理它。 注意：503状态码的存在并不意味着服务器在过载的时候必须使用它。某些服务器只不过是希望拒绝客户端的连接。</p>
<ul>
<li>504</li>
</ul>
<p>作为网关或者代理工作的服务器尝试执行请求时，未能及时从上游服务器（URI标识出的服务器，例如HTTP、FTP、LDAP）或者辅助服务器（例如DNS）收到响应。 注意：某些代理服务器在DNS查询超时时会返回400或者500错误</p>
<ul>
<li>505</li>
</ul>
<p>服务器不支持，或者拒绝支持在请求中使用的 HTTP 版本。这暗示着服务器不能或不愿使用与客户端相同的版本。响应中应当包含一个描述了为何版本不被支持以及服务器支持哪些协议的实体。</p>
<ul>
<li>506</li>
</ul>
<p>由《透明内容协商协议》（RFC 2295）扩展，代表服务器存在内部配置错误：被请求的协商变元资源被配置为在透明内容协商中使用自己，因此在一个协商处理中不是一个合适的重点。</p>
<ul>
<li>507</li>
</ul>
<p>服务器无法存储完成请求所必须的内容。这个状况被认为是临时的。WebDAV (RFC 4918)</p>
<ul>
<li>509</li>
</ul>
<p>服务器达到带宽限制。这不是一个官方的状态码，但是仍被广泛使用。</p>
<ul>
<li>510</li>
</ul>
<p>获取资源所需要的策略并没有没满足。（RFC 2774）</p>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/19/glances-monitor-system.html" itemprop="url">
                  使用glances监控系统
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-19T10:16:05+08:00" content="2016-01-19">
              2016-01-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/19/glances-monitor-system.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/19/glances-monitor-system.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/19/glances-monitor-system.html" class="leancloud_visitors" data-flag-title="使用glances监控系统">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用Glances监控系统"><a href="#使用Glances监控系统" class="headerlink" title="使用Glances监控系统"></a>使用Glances监控系统</h2><p><img src="http://www.zerounix.com/images/system/command/glances/glances_monitor.jpg" alt="glances_monitor"><br>Glances 是一个用于监控系统的跨平台、基于文本模式的命令行工具。它是用 Python 编写的，使用 psutil 库从系统获取信息。你可以用它来监控 CPU、平均负载、内存、网络接口、磁盘 I/O，文件系统空间利用率、挂载的设备、所有活动进程以及消耗资源最多的进程。Glances 有很多有趣的选项。它的主要特性之一是可以在配置文件中设置阀值(careful小心、warning警告、critical致命)，然后它会用不同颜色显示信息以表明系统的瓶颈。</p>
<h3 id="Glances的功能"><a href="#Glances的功能" class="headerlink" title="Glances的功能"></a>Glances的功能</h3><ul>
<li>CPU 平均负载</li>
<li>不同状态(如活动、休眠)进程的数量</li>
<li>所有内存信息，如物理内存、交换空间、空闲内存</li>
<li>CPU 信息</li>
<li>网络连接的上行/下行速度</li>
<li>磁盘 I/O 读/写速度详细信息</li>
<li>当前挂载设备的磁盘使用情况</li>
<li>消耗资源最多的进程和他们的 CPU/内存使用情况</li>
</ul>
<h3 id="安装-Glances"><a href="#安装-Glances" class="headerlink" title="安装 Glances"></a>安装 Glances</h3><p>Glances 在 Ubuntu 的软件仓库中，所以安装很简单。执行下面的命令安装 Glances<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install glances </div><div class="line"></div><div class="line">//若安装后无法正常使用，可考虑使用 pip 安装/升级 glances：</div><div class="line">sudo pip install --upgrade glances</div></pre></td></tr></table></figure></p>
<h3 id="Glances-使用方法"><a href="#Glances-使用方法" class="headerlink" title="Glances 使用方法"></a>Glances 使用方法</h3><p>安装完成后，可以执行下面的命令启动 Glances：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">glances</div></pre></td></tr></table></figure></p>
<p>你将看到类似下图的输出：<br><img src="http://www.zerounix.com/images/system/command/glances/glances_output.jpg" alt="glances_output" title="glances monitor system output"></p>
<p>要退出<code>Glances</code>终端，按 <code>ESC 键或 Ctrl + C</code>。</p>
<p>默认情况下，时间间隔(显示数据刷新的时间间隔)是 1 秒，不过你可以在从终端启动 Glances 时自定义时间间隔。</p>
<p>要把时间间隔设为 5 秒，执行下面的命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">glances -t 5</div></pre></td></tr></table></figure></p>
<p>Glances 中不同颜色含义</p>
<ul>
<li>绿色：正常(OK)</li>
<li>蓝色：小心(careful)</li>
<li>紫色：警告(warning)</li>
<li>红色：致命(critical)</li>
</ul>
<p>默认设置下，<code>Glances</code>的阀值设置是：<code>careful=50，warning=70，critical=90</code>。你可以通过 “<code>/etc/glances/</code>” 目录下的默认配置文件 glances.conf 来自定义这些阀值。</p>
<h3 id="Glances-的选项"><a href="#Glances-的选项" class="headerlink" title="Glances 的选项"></a>Glances 的选项</h3><p>Glances 提供了很多快捷键，可以在它运行时，用来查找输出信息。</p>
<p>下面是一些常用的热键列表：</p>
<ul>
<li>m：按内存占用排序进程</li>
<li>p：按进程名称排序进程</li>
<li>c：按 CPU 占用率排序进程</li>
<li>i：按 I/O 频率排序进程</li>
<li>a：自动排序进程</li>
<li>d：显示/隐藏磁盘 I/O 统计信息</li>
<li>f：显示/隐藏文件系统统计信息</li>
<li>s：显示/隐藏传感器统计信息</li>
<li>y：显示/隐藏硬盘温度统计信息</li>
<li>l：显示/隐藏日志</li>
<li>n：显示/隐藏网络统计信息</li>
<li>x：删除警告和严重日志</li>
<li>h：显示/隐藏帮助界面</li>
<li>q：退出</li>
<li>w：删除警告记录</li>
</ul>
<h3 id="使用-Glances-监控远程系统"><a href="#使用-Glances-监控远程系统" class="headerlink" title="使用 Glances 监控远程系统"></a>使用 Glances 监控远程系统</h3><p>你也可以使用 Glances 监控远程系统。要在远程系统上使用它，使用下面的命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">glances -s</div></pre></td></tr></table></figure></p>
<p>你会看到类似下面的输出：<br><img src="http://www.zerounix.com/images/system/command/glances/glances_remote_output.jpg" alt="glances_remote_output" title="glances monitor system remote output"></p>
<p>如你所见，Glances 运行在 61209 端口。</p>
<p>现在，到远程机器上执行下面的命令以连接到指定 IP 地址的 Glances 服务器上。假设 192.168.1.10 是你的 Glances 服务器 IP 地址。</p>
<p>glances -c 192.168.1.10<br>结论</p>
<p>对于每个 Linux 系统管理员来说，Glances 都是一个非常有用的工具。使用它，你可以轻松、高效地监控 Linux 系统。如果你有什么问题，自由地评论吧！</p>
<hr>
<p><strong> <a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a> </strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/06/kvm-pool-manage.html" itemprop="url">
                  CentOS6.5安装kvm
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-06T17:51:27+08:00" content="2016-01-06">
              2016-01-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/虚拟化/" itemprop="url" rel="index">
                    <span itemprop="name">虚拟化</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/06/kvm-pool-manage.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/06/kvm-pool-manage.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/06/kvm-pool-manage.html" class="leancloud_visitors" data-flag-title="CentOS6.5安装kvm">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h3 id="什么是KVM"><a href="#什么是KVM" class="headerlink" title="什么是KVM"></a>什么是KVM</h3><p>  KVM 是指基于 Linux 内核的虚拟机（Kernel-based Virtual Machine）。 2006 年 10 月，由以色列的Qumranet 组织开发的一种新的“虚拟机”实现方案。 2007 年 2 月发布的 Linux 2.6.20 内核第一次包含了 KVM 。增加 KVM 到 Linux 内核是 Linux 发展的一个重要里程碑，这也是第一个整合到 Linux 主线内核的虚拟化技术。</p>
<p>  KVM 在标准的 Linux 内核中增加了虚拟技术，从而我们可以通过优化的内核来使用虚拟技术。在 KVM 模型中，每一个虚拟机都是一个由 Linux 调度程序管理的标准进程，你可以在用户空间启动客户机操作系统。一个普通的 Linux 进程有两种运行模式：内核和用户。 KVM 增加了第三种模式：客户模式（有自己的内核和用户模式）。</p>
<p>一个典型的 KVM 安装包括以下部件：</p>
<blockquote>
<ul>
<li>一个管理虚拟硬件的设备驱动，这个驱动通过一个字符设备 /dev/kvm 导出它的功能。通过 /dev/kvm每一个客户机拥有其自身的地址空间，这个地址空间与内核的地址空间相分离或与任何一个正运行着的客户机相分离。</li>
<li>一个模拟硬件的用户空间部件，它是一个稍微改动过的 QEMU 进程。从客户机操作系统执行 I/O 会拥有QEMU。QEMU 是一个平台虚拟化方案，它允许整个 PC 环境（包括磁盘、显示卡（图形卡）、网络设备）的虚拟化。任何客户机操作系统所发出的 I/O 请求都被拦截，并被路由到用户模式用以被 QEMU 过程模拟仿真。</li>
</ul>
</blockquote>
<h3 id="安装KVM"><a href="#安装KVM" class="headerlink" title="安装KVM"></a>安装KVM</h3><h4 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h4><p>KVM 需要有CPU的支持(Intel VT 或 AMD SVM)，在安装 KVM 之前检查一下 CPU 是否提供了虚拟技术的支持</p>
<ul>
<li>基于<code>Intel</code>处理器的系统，运行<code>grep vmx /proc/cpuinfo</code>查找 CPU flags 是否包括<code>vmx</code>关键词</li>
<li>基于<code>AMD</code>处理器的系统，运行<code>grep svm /proc/cpuinfo</code>查找 CPU flags 是否包括<code>svm</code>关键词</li>
<li>检查BIOS，确保BIOS里开启<code>VT</code>选项</li>
</ul>
<p><strong>注:</strong></p>
<ul>
<li>一些厂商禁止了机器 BIOS 中的 VT 选项 , 这种方式下 VT 不能被重新打开</li>
<li>/proc/cpuinfo 仅从 Linux 2.6.15(Intel) 和 Linux 2.6.16(AMD) 开始显示虚拟化方面的信息。请使用 uname -r 命令查询您的内核版本。如有疑问，请联系硬件厂商</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">egrep &quot;(vmx|svm)&quot; /proc/cpuinfo</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div><div class="line">flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good xtopology nonstop_tsc aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 sse4_2 popcnt lahf_lm dts tpr_shadow vnmi flexpriority ept vpid</div></pre></td></tr></table></figure>
<h4 id="安装kvm软件"><a href="#安装kvm软件" class="headerlink" title="安装kvm软件"></a>安装kvm软件</h4><p>安装KVM模块、管理工具和libvirt (一个创建虚拟机的工具)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install -y qemu-kvm libvirt virt-install virt-manager bridge-utils</div><div class="line">/etc/init.d/libvirtd start</div><div class="line">chkconfig libvirtd on</div></pre></td></tr></table></figure></p>
<h4 id="确保正确加载kvm模块"><a href="#确保正确加载kvm模块" class="headerlink" title="确保正确加载kvm模块"></a>确保正确加载kvm模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">lsmod  | grep kvm</div><div class="line">kvm_intel              54285  0 </div><div class="line">kvm                   333172  1 kvm_intel</div></pre></td></tr></table></figure>
<h4 id="检查kvm是否正确安装"><a href="#检查kvm是否正确安装" class="headerlink" title="检查kvm是否正确安装"></a>检查kvm是否正确安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">virsh -c qemu:///system list</div><div class="line"> Id    Name                           State</div><div class="line">----------------------------------------------------</div></pre></td></tr></table></figure>
<p>如果这里是错误信息，说明安装出现问题</p>
<h3 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h3><p>kvm上网有两种配置，一种是default，它支持主机和虚拟机的互访，同时也支持虚拟机访问互联网，但不支持外界访问虚拟机，另外一种是bridge方式，可以使虚拟机成为网络中具有独立Ip的主机。</p>
<h4 id="默认网络virbro"><a href="#默认网络virbro" class="headerlink" title="默认网络virbro"></a>默认网络virbro</h4><p>默认的网络连接是virbr0，它的配置文件在/var/lib/libvirt/network目录下，默认配置为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cat /var/lib/libvirt/network/default.xml </div><div class="line"></div><div class="line">  default</div><div class="line">  77094b31-b7eb-46ca-930e-e0be9715a5ce</div></pre></td></tr></table></figure></p>
<h4 id="桥接网络"><a href="#桥接网络" class="headerlink" title="桥接网络"></a>桥接网络</h4><p>配置桥接网卡，配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">more /etc/sysconfig/network-scripts/ifcfg-\*</div><div class="line">::::::::::::::</div><div class="line">/etc/sysconfig/network-scripts/ifcfg-br0</div><div class="line">::::::::::::::</div><div class="line">DEVICE=br0</div><div class="line">ONBOOT=yes</div><div class="line">TYPE=Bridge</div><div class="line">BOOTPROTO=static</div><div class="line">IPADDR=192.168.39.20</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.39.1</div><div class="line">DNS1=8.8.8.8</div><div class="line">::::::::::::::</div><div class="line">/etc/sysconfig/network-scripts/ifcfg-br1</div><div class="line">::::::::::::::</div><div class="line">DEVICE=br1</div><div class="line">ONBOOT=yes</div><div class="line">TYPE=Bridge</div><div class="line">BOOTPROTO=static</div><div class="line">IPADDR=10.10.39.8</div><div class="line">NETMASK=255.255.255.0</div><div class="line">::::::::::::::</div><div class="line">/etc/sysconfig/network-scripts/ifcfg-em1</div><div class="line">::::::::::::::</div><div class="line">DEVICE=em1</div><div class="line">TYPE=Ethernet</div><div class="line">ONBOOT=yes</div><div class="line">BOOTPROTO=static</div><div class="line">BRIDGE=br0</div><div class="line">::::::::::::::</div><div class="line">/etc/sysconfig/network-scripts/ifcfg-em2</div><div class="line">::::::::::::::</div><div class="line">DEVICE=em2</div><div class="line">TYPE=Ethernet</div><div class="line">ONBOOT=yes</div><div class="line">BOOTPROTO=static</div><div class="line">BRIDGE=br1</div></pre></td></tr></table></figure>
<h3 id="使用virt-manager安装建立虚拟机"><a href="#使用virt-manager安装建立虚拟机" class="headerlink" title="使用virt-manager安装建立虚拟机"></a>使用virt-manager安装建立虚拟机</h3><p>virt-manager 是基于 libvirt 的图像化虚拟机管理软件，操作类似vmware，不做详细介绍。</p>
<hr>
<h2 id="DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10-免费玩2个月"><a href="#DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10-免费玩2个月" class="headerlink" title="DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月"></a><a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a></h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/04/glusterfs-administrator-Guide.html" itemprop="url">
                  gulsterfs系统管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-01-04T12:42:12+08:00" content="2016-01-04">
              2016-01-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/分布式文件系统/" itemprop="url" rel="index">
                    <span itemprop="name">分布式文件系统</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/04/glusterfs-administrator-Guide.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/04/glusterfs-administrator-Guide.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/01/04/glusterfs-administrator-Guide.html" class="leancloud_visitors" data-flag-title="gulsterfs系统管理">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="glusterfs系统部署"><a href="#glusterfs系统部署" class="headerlink" title="glusterfs系统部署"></a>glusterfs系统部署</h2><h3 id="系统环境介绍"><a href="#系统环境介绍" class="headerlink" title="系统环境介绍"></a>系统环境介绍</h3><ul>
<li>OS版本：CentOS 6.5 x86_64</li>
<li>软件版本： 3.7.3</li>
<li>系统节点 </li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:right">ip地址</th>
<th style="text-align:left">挂载路径</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">172.161.8.241</td>
<td style="text-align:left">/export/brick1/gv0</td>
</tr>
<tr>
<td style="text-align:right">172.161.8.242</td>
<td style="text-align:left">/export/brick1/gv0</td>
</tr>
<tr>
<td style="text-align:right">172.161.8.243</td>
<td style="text-align:left">/export/brick1/gv0</td>
</tr>
<tr>
<td style="text-align:right">172.161.8.244</td>
<td style="text-align:left">/export/brick1/gv0</td>
</tr>
</tbody>
</table>
<h3 id="gluster安装部署"><a href="#gluster安装部署" class="headerlink" title="gluster安装部署"></a>gluster安装部署</h3><h4 id="安装GlusterFS软件包"><a href="#安装GlusterFS软件包" class="headerlink" title="安装GlusterFS软件包"></a>安装GlusterFS软件包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 安装软件包</div><div class="line">yum install -y glusterfs glusterfs-fuse glusterfs-server xfsprogs</div><div class="line">// 启动服务，添加自启动</div><div class="line">/etc/init.d/glusterd start </div><div class="line">chkconfig glusterfsd on</div></pre></td></tr></table></figure>
<h4 id="添加节点到GlusterFS集群"><a href="#添加节点到GlusterFS集群" class="headerlink" title="添加节点到GlusterFS集群"></a>添加节点到GlusterFS集群</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//添加节点到存储池，在其中一个节点上操作</div><div class="line"> gluster peer probe 172.16.18.241</div><div class="line">peer probe: success: on localhost not needed</div><div class="line"></div><div class="line"> gluster peer probe 172.16.18.242</div><div class="line">peer probe: success</div><div class="line"></div><div class="line">gluster peer probe 172.16.18.243</div><div class="line">peer probe: success</div><div class="line"></div><div class="line"> gluster peer probe 172.16.18.244</div><div class="line">peer probe: success</div><div class="line"></div><div class="line">//查看各个节点状态</div><div class="line">gluster peer status</div><div class="line">Number of Peers: 3</div><div class="line">Hostname: 172.16.18.242</div><div class="line">Uuid: beb0aae7-a939-45ec-a273-0c21c2f59546</div><div class="line">State: Peer in Cluster (Connected)</div><div class="line">Hostname: 172.16.18.243</div><div class="line">Uuid: eab486b3-d1a1-4851-b9ec-45aab1ef9a66</div><div class="line">State: Peer in Cluster (Connected)</div><div class="line">Hostname: 172.16.18.244</div><div class="line">Uuid: 3108764d-d6b3-4356-810d-88872d56ceb6</div><div class="line">State: Peer in Cluster (Connected)</div></pre></td></tr></table></figure>
<h4 id="创建数据存放目录"><a href="#创建数据存放目录" class="headerlink" title="创建数据存放目录"></a>创建数据存放目录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">parted  /dev/sdb rm 1</div><div class="line">mkfs.xfs -i size=512 /dev/sdb -f</div><div class="line">mkdir -p /export/brick1</div><div class="line">/bin/mount -t xfs /dev/sdb /export/brick1</div><div class="line">mkdir /export/brick1/gv0</div><div class="line">echo &quot;/dev/sdb        /export/brick1  xfs     defaults        1       2&quot; &gt;&gt; /etc/fstab</div></pre></td></tr></table></figure>
<h4 id="创建GlusterFS磁盘"><a href="#创建GlusterFS磁盘" class="headerlink" title="创建GlusterFS磁盘"></a>创建GlusterFS磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">// 创建系统卷gv0（副本卷）</div><div class="line">gluster volume create gv0 replica 2 172.16.18.241:/export/brick1/gv0 172.16.18.242:/export/brick1/gv0 172.16.18.243:/</div><div class="line">export/brick1/gv0 172.16.18.244:/export/brick1/gv0 force</div><div class="line"></div><div class="line">//启动系统卷gv0</div><div class="line"> gluster volume start gv0</div><div class="line">volume create: gv0: success: please start the volume to access data</div><div class="line"></div><div class="line">//查看系统卷信息</div><div class="line">gluster volume info</div><div class="line"> </div><div class="line">Volume Name: gv0</div><div class="line">Type: Distributed-Replicate</div><div class="line">Volume ID: e64cb61c-0f18-41b5-bf4d-c45ee085ca3b</div><div class="line">Status: Started</div><div class="line">Number of Bricks: 2 x 2 = 4</div><div class="line">Transport-type: tcp</div><div class="line">Bricks:</div><div class="line">Brick1: 172.16.18.241:/export/brick1/gv0</div><div class="line">Brick2: 172.16.18.242:/export/brick1/gv0</div><div class="line">Brick3: 172.16.18.243:/export/brick1/gv0</div><div class="line">Brick4: 172.16.18.244:/export/brick1/gv0</div><div class="line">Options Reconfigured:</div><div class="line">performance.readdir-ahead: on</div></pre></td></tr></table></figure>
<h4 id="安装客户端并mount-GlusterFS文件系统"><a href="#安装客户端并mount-GlusterFS文件系统" class="headerlink" title="安装客户端并mount GlusterFS文件系统"></a>安装客户端并mount GlusterFS文件系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 下载仓库文件</div><div class="line">wget -P /etc/yum.repos.d  http://download.gluster.org/pub/gluster/glusterfs/LATEST/CentOS/glusterfs-epel.repo</div><div class="line"></div><div class="line">//安装软件</div><div class="line">yum install glusterfs glusterfs-fuse glusterfs-server</div><div class="line"></div><div class="line">//创建挂载点</div><div class="line">mkdir -p /opt/vmx/gv0</div><div class="line"></div><div class="line">//client挂载</div><div class="line">/bin/mount -t glusterfs 172.16.18.241:/gv0 /opt/vmx/gv0</div></pre></td></tr></table></figure>
<h2 id="基本系统管理"><a href="#基本系统管理" class="headerlink" title="基本系统管理"></a>基本系统管理</h2><h3 id="节点管理"><a href="#节点管理" class="headerlink" title="节点管理"></a>节点管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gluster peer command</div></pre></td></tr></table></figure>
<h4 id="节点状态"><a href="#节点状态" class="headerlink" title="节点状态"></a>节点状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// 在任意节点操作，可以看到其他节点与本节点的连接状态</div><div class="line">gluster peer status</div><div class="line">Number of Peers: 3</div><div class="line">Hostname: 172.16.18.242</div><div class="line">Uuid: beb0aae7-a939-45ec-a273-0c21c2f59546</div><div class="line">State: Peer in Cluster (Connected)</div><div class="line">Hostname: 172.16.18.243</div><div class="line">Uuid: eab486b3-d1a1-4851-b9ec-45aab1ef9a66</div><div class="line">State: Peer in Cluster (Connected)</div><div class="line">Hostname: 172.16.18.244</div><div class="line">Uuid: 3108764d-d6b3-4356-810d-88872d56ceb6</div><div class="line">State: Peer in Cluster (Connected)</div></pre></td></tr></table></figure>
<h4 id="添加节点"><a href="#添加节点" class="headerlink" title="添加节点"></a>添加节点</h4><p><strong>命令：<code>gluster peer HostName</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 将节点server添加到存储池中</div><div class="line">gluster peer prober server</div></pre></td></tr></table></figure>
<h4 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h4><p><strong>命令： <code>gluster peer detach HostName</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 将节点server从存储池中移除，移除节点时要保证节点上没有brick，需要提前移除brick</div><div class="line">gluster peer detch server</div></pre></td></tr></table></figure>
<h3 id="卷管理"><a href="#卷管理" class="headerlink" title="卷管理"></a>卷管理</h3><h4 id="创建卷"><a href="#创建卷" class="headerlink" title="创建卷"></a>创建卷</h4><p><strong>命令：gluster volume create NEW-VOLNAME [transport[tcp|rdma|tcp,rdma]] NEW_BRICK…</strong></p>
<ul>
<li>创建分布式卷(DHT)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// DHT卷将数据以哈希计算方式分布到各个brick上，数据是以文件为单位存取，基本达到分布均衡，提供的容量为各个brick的容量总和</div><div class="line">gluster volume create dht_vol 172.16.18.&#123;241,242,243,244&#125;:/export/brick1/gv0</div></pre></td></tr></table></figure>
<ul>
<li>创建副本卷(AFR)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// AFR提供数据副本，副本数为replica，即每个文件存储replica份数，文件不分割，以文件为存储单位：副本数需要等于brick数；当brick数是副本的倍数时，则自动变化为Replicated-Distributed卷</div><div class="line">gluster volume create afr_vol replica 2 172.16.18.&#123;241,242,243,244&#125;:/export/brick/gv0</div></pre></td></tr></table></figure>
<p><strong>每两个brick组成一组，每组两个副本，文件又以DHT分布在三个组上，这样是副本卷和分布式卷的组合</strong></p>
<ul>
<li>创建条带卷</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//stripe卷类似raid0，将数据条带化，分布在不同的brick，该方式将文件分块，将文件分成stripe块，分别进行存储，在大文件读取是有优势。stripe需要等于brick数；当brick数等于stripe数的倍数时，则自动变化为stripe-distributed卷。</div><div class="line">gluster volume create str_vol stripe 2 172.16.18.&#123;241,242,243,244&#125;:/export/brick1/gv0</div></pre></td></tr></table></figure>
<p><strong>每2个brick组成一组，每组2个brick，文件以DHT分布在两个组中，每个组中将文件条带成2块</strong></p>
<ul>
<li>创建Replicated-Stripe-Distributed卷</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//使用8个brick创建一个组合卷，即brick数是stripe*replica的倍数，则创建三种基本卷的组合卷，若刚好等于stripe*replica则为stript-Distrubted卷</div><div class="line">gluster volume create str_afr_dht_vol stripe 2 replica 2 172.16.18.&#123;241,242,243,244&#125;:/export/brick1/gv0  172.16.18.&#123;241,242,243,244&#125;:/export/brick1/gv1</div></pre></td></tr></table></figure>
<h4 id="卷信息"><a href="#卷信息" class="headerlink" title="卷信息"></a>卷信息</h4><p><strong>命令：gluster volume info</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 该命令能够查看存储池中当前卷的信息，包括卷方式、包含的brick、卷的当期状态、卷名及UUID等</div><div class="line">gluster volume info</div><div class="line"> </div><div class="line">Volume Name: gv0</div><div class="line">Type: Distributed-Replicate</div><div class="line">Volume ID: e64cb61c-0f18-41b5-bf4d-c45ee085ca3b</div><div class="line">Status: Started</div><div class="line">Number of Bricks: 2 x 2 = 4</div><div class="line">Transport-type: tcp</div><div class="line">Bricks:</div><div class="line">Brick1: 172.16.18.241:/export/brick1/gv0</div><div class="line">Brick2: 172.16.18.242:/export/brick1/gv0</div><div class="line">Brick3: 172.16.18.243:/export/brick1/gv0</div><div class="line">Brick4: 172.16.18.244:/export/brick1/gv0</div><div class="line">Options Reconfigured:</div><div class="line">performance.readdir-ahead: on</div></pre></td></tr></table></figure></p>
<h4 id="卷状态"><a href="#卷状态" class="headerlink" title="卷状态"></a>卷状态</h4><p><strong>命令： gluster volume status</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">// 该命令能够查看当前卷的状态，包括其中各个brick的状态、NFS的服务状态及当前task执行情况和一些系统设置状态等</div><div class="line">gluster volume status</div><div class="line">Status of volume: gv0</div><div class="line">Gluster process                             TCP Port  RDMA Port  Online  Pid</div><div class="line">------------------------------------------------------------------------------</div><div class="line">Brick 172.16.18.241:/export/brick1/gv0      49152     0          Y       1970 </div><div class="line">Brick 172.16.18.242:/export/brick1/gv0      49152     0          Y       9547 </div><div class="line">Brick 172.16.18.243:/export/brick1/gv0      49152     0          Y       1800 </div><div class="line">Brick 172.16.18.244:/export/brick1/gv0      49152     0          Y       9741 </div><div class="line">NFS Server on localhost                     N/A       N/A        N       N/A  </div><div class="line">Self-heal Daemon on localhost               N/A       N/A        Y       2605 </div><div class="line">NFS Server on 172.16.18.244                 N/A       N/A        N       N/A  </div><div class="line">Self-heal Daemon on 172.16.18.244           N/A       N/A        Y       15386</div><div class="line">NFS Server on 172.16.18.243                 N/A       N/A        N       N/A  </div><div class="line">Self-heal Daemon on 172.16.18.243           N/A       N/A        Y       1794 </div><div class="line">NFS Server on 172.16.18.242                 N/A       N/A        N       N/A  </div><div class="line">Self-heal Daemon on 172.16.18.242           N/A       N/A        Y       1966 </div><div class="line"> </div><div class="line">Task Status of Volume gv0</div><div class="line">------------------------------------------------------------------------------</div><div class="line">Task                 : Rebalance           </div><div class="line">ID                   : fad4f770-87dd-4248-b41e-733641c8bcca</div><div class="line">Status               : completed</div></pre></td></tr></table></figure></p>
<h4 id="启动、停止卷"><a href="#启动、停止卷" class="headerlink" title="启动、停止卷"></a>启动、停止卷</h4><p><strong>命令： gluster volume start/stop VOLNAME</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 将创建的卷启动，才能进行客户端挂载；stop能够将系统将停止；此外gluster并未提供restart的重启命令</div><div class="line">gluster volume start gv0</div><div class="line">volume create: gv0: success: please start the volume to access data</div></pre></td></tr></table></figure></p>
<h4 id="删除卷"><a href="#删除卷" class="headerlink" title="删除卷"></a>删除卷</h4><p><strong>命令：gluster volume delete VOLNAME</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 删除卷的操作能够将整个卷删除，操作前需要将卷先停止</div><div class="line">gluster volume stop gv0</div><div class="line">gluster volume delete gv0</div></pre></td></tr></table></figure>
<h3 id="Brick管理"><a href="#Brick管理" class="headerlink" title="Brick管理"></a>Brick管理</h3><h4 id="添加brick"><a href="#添加brick" class="headerlink" title="添加brick"></a>添加brick</h4><p><strong>命令：gluster volume add-brick VOLNAME NEW-BRICK</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//添加两个brick到存储gv0，副本卷则要一次添加的bricks数是replica的整数倍；stripe同样要求</div><div class="line">gluster peer probe 172.16.18.245</div><div class="line">gluster peer probe 172.16.18.246</div><div class="line">gluster volume add-brick gv0 172.16.18.245:/export/brick1/gv0  172.16.18.246:/export/brick1/gv0</div></pre></td></tr></table></figure></p>
<h4 id="移除brick"><a href="#移除brick" class="headerlink" title="移除brick"></a>移除brick</h4><p><strong>命令： gluster volume remove-brick VOLNAME BRICK start/status/commit</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 若是副本卷，则要移除的Brick是replica的整数倍，stripe具有同样的要求，副本卷要移除一对Brick，在执行移除操作时，数据会移到其他节点。</div><div class="line">gluster volume remove-brick gv0 172.16.18.245:/export/brick1/gv0  172.16.18.246:/export/brick1/gv0 start</div><div class="line"></div><div class="line">// 在执行移除操作后，可以使用status命令进行task状态查看</div><div class="line">gluster volume remove-brick gv0 172.16.18.245:/export/brick1/gv0  172.16.18.246:/export/brick1/gv0 status</div><div class="line"></div><div class="line">// 使用commit命令执行brick移除，则不会进行数据迁移而直接删除brick，符合不需要数据迁移的用户需求</div><div class="line">gluster volume remove-brick gv0 172.16.18.245:/export/brick1/gv0  172.16.18.246:/export/brick1/gv0 commit</div></pre></td></tr></table></figure></p>
<p><strong>ps：系统的扩容及缩减可以通过如上的节点、brick管理组合达到目的</strong><br><strong>1. 扩容时，可以下增加系统节点，然后添加新增节点上的brick即可</strong><br><strong>2. 缩减时，可以先移除brick，然后在进行节点删除达到缩减的目的，并保证不丢失数据</strong></p>
<h4 id="替换brick"><a href="#替换brick" class="headerlink" title="替换brick"></a>替换brick</h4><p><strong> 命令：gluster volume replace-brick VOLNAME BRICKNEW-BRICK start/pause/sbort/status/commit </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 将172.16.18.244：/export/brick1/gv0替换为172.16.18.245:/export/brick1/gv0。在执行replcase-brick，使用start启动命令之后，开始将原始brick的数据迁移到即将需要替换的brick上</div><div class="line">gluster volume replace-brick gv0 172.16.18.244:/export/brick1/gv0  172.16.18.245:/export/brick1/gv0  start force</div><div class="line"></div><div class="line">//在数据迁移过程中，可以查看替换状态</div><div class="line">gluster volume replace-brick gv0 172.16.18.244:/export/brick1/gv0  172.16.18.245:/export/brick1/gv0  status</div><div class="line"></div><div class="line">// 在数据迁移的过程中，可以执行abort命令终止brick替换</div><div class="line">gluster volume replace-brick gv0 172.16.18.244:/export/brick1/gv0  172.16.18.245:/export/brick1/gv0 abort</div><div class="line"></div><div class="line">//当数据迁移结束之后，执行commit命令结束任务，则进行brick替换。使用volume info命令可以查看到brick已经被替换</div><div class="line">gluster volume replace-brick gv0 172.16.18.244:/export/brick1/gv0  172.16.18.245:/export/brick1/gv0  start</div></pre></td></tr></table></figure>
<h2 id="系统拓展"><a href="#系统拓展" class="headerlink" title="系统拓展"></a>系统拓展</h2><h3 id="系统配额"><a href="#系统配额" class="headerlink" title="系统配额"></a>系统配额</h3><h4 id="开启、关闭系统配额"><a href="#开启、关闭系统配额" class="headerlink" title="开启、关闭系统配额"></a>开启、关闭系统配额</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//在使用系统配额功能时，需要使用enable将其开启；disable为关闭命令</div><div class="line">gluster volume quota VOLNAME enable/disable</div></pre></td></tr></table></figure>
<h4 id="设置目录配额"><a href="#设置目录配额" class="headerlink" title="设置目录配额"></a>设置目录配额</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gluster volume quota VOLNAME limit-usage /directory limit-value</div><div class="line"></div><div class="line">//设置gv0卷下quota子目录目录限额为10GB，这个目录是以系统挂载目录为根目录，所以/quota即客户端挂载目录下的子目录</div><div class="line">gluster volume quota gv0 limit-usage /quota 10GB</div></pre></td></tr></table></figure>
<h4 id="配额查看"><a href="#配额查看" class="headerlink" title="配额查看"></a>配额查看</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gluster volume quota VOLNAME list</div><div class="line">gluster volume quota VOLNAME list /directory_name</div><div class="line">//可以使用上面命令查看卷的配额，第一个查看全部配额设置，第二个可以根据目录查看，显示配额大小及当前使用容量，如无使用容量则说明设置的目录有误(不存在)</div><div class="line">gluster volume quota gv0 list</div></pre></td></tr></table></figure>
<h4 id="地域复制-geo-replication"><a href="#地域复制-geo-replication" class="headerlink" title="地域复制(geo-replication)"></a>地域复制(geo-replication)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">gluster volume geo-replication MASTER SLAVE start/status/stop</div><div class="line"></div><div class="line">//地域复制是系统提供的灾备功能，能够将系统的全部数据进行异步的增量备份到另外的磁盘中</div><div class="line">gluster volume geo-replication gv0 172.16.18.250:/export/brick/gv0 start</div><div class="line"></div><div class="line">//当开始执行gv0卷的所有内容备份到18.250下的/export/brick/gv0中的task，值得注意的是，这个备份目标不能是系统中的brick</div></pre></td></tr></table></figure>
<h4 id="I-O信息查看"><a href="#I-O信息查看" class="headerlink" title="I/O信息查看"></a>I/O信息查看</h4><p><code>profile command</code>提供了一个接口查看每个卷中的每个brick的io信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 启动profiling，之后便可以进行io查看</div><div class="line">gluster volume profile VOLNAME start</div><div class="line"></div><div class="line">// 查看io信息，可以查看到每个brick的io信息</div><div class="line">gluster volume profile VOLNAME info</div><div class="line"></div><div class="line">// 管理profilinig功能</div><div class="line">gluster volume profile VOLNAME stop</div></pre></td></tr></table></figure></p>
<h4 id="top监控"><a href="#top监控" class="headerlink" title="top监控"></a>top监控</h4><p><code>top command</code>允许你查看bricks的性能，read、write、file open calls、file read caclls、file write calls、directory open calls、directory read calls。所有的查看都可以设置top数，默认是1000<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// 查看打开的fd</div><div class="line">gluster volume top VOLNAME open [brick BRICK-NAME] [list-cnt cnt]</div><div class="line"></div><div class="line">// 查看调用次数最多的读调用</div><div class="line">gluster volume top VOLNAME read [brick BRICK-NAME] [list-cnt cnt]</div><div class="line"></div><div class="line">// 查看调用次数最多的写调用</div><div class="line">gluster volume top VOLNAME write [brick BRICK-NAME] [list-cnt cnt]</div><div class="line"></div><div class="line">// 查看次数最多的目录调用</div><div class="line">gluster volume top opendir [brick BRICK-NAME] [list-cnt cnt]</div><div class="line">gluster volume top readdir [brick BRICK-NAME] [list-cnt cnt]</div><div class="line"></div><div class="line">//查看每个brick的读性能</div><div class="line">gluster volume top VOLNAME read-perf [bs blk-size count count] [brick BRICK-NAME] [list-cnt cnt]</div><div class="line"></div><div class="line">//查看每个brick的写性能</div><div class="line">gluster volume top VOLNAME write-perf [bs blk-size count count] [brick BRICK-NAME] [list-cnt cnt]</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10-免费玩2个月"><a href="#DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10-免费玩2个月" class="headerlink" title="DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月"></a><a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a></h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/29/apache-add-moudle-cgi.html" itemprop="url">
                  Apache添加cgi模块
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-29T14:07:33+08:00" content="2015-12-29">
              2015-12-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/12/29/apache-add-moudle-cgi.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/12/29/apache-add-moudle-cgi.html" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2015/12/29/apache-add-moudle-cgi.html" class="leancloud_visitors" data-flag-title="Apache添加cgi模块">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>
<h2 id="apache添加cgi模块"><a href="#apache添加cgi模块" class="headerlink" title="apache添加cgi模块"></a>apache添加cgi模块</h2><p>Apache需要运行cgi程序的，却发现先前编译安装Apache的时候，没有安装Apache的cgi模块。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/src/httpd-2.2.25/modules/generators</div><div class="line">/usr/local/apache/bin/apxs -i -a -c mod_cgi.c</div></pre></td></tr></table></figure></p>
<p>省略部分内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod 755 /usr/local/apache/modules/mod_cgi.so</div><div class="line">[activating module `cgi&apos; in /usr/local/apache/conf/httpd.conf]ap</div></pre></td></tr></table></figure></p>
<p>apxs参数介绍：</p>
<ul>
<li>-i：表示要执行安装操作</li>
<li>-a：自动添加一个LoadModule行到httpd.conf文件中，使模块激活</li>
</ul>
<hr>
<h2 id="DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10-免费玩2个月"><a href="#DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10-免费玩2个月" class="headerlink" title="DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月"></a><a href="https://www.digitalocean.com/?refcode=9e4ab85e22ec" target="_blank" rel="external">DigitalOcean的VPS，稳定、便宜，用于搭建自己的站点和梯子，现在注册即得10$,免费玩2个月</a></h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://czero000.github.io/images/blog/avatar.jpg"
               alt="C.c" />
          <p class="site-author-name" itemprop="name">C.c</p>
          <p class="site-description motion-element" itemprop="description">Love Linux ♥ Love Python. 猴赛雷</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">104</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">76</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">C.c</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"czero000"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("Rl3Nh6z96ldNfoGXOaUqBT47-gzGzoHsz", "NmOEHbcsySJxEnVKuV23xr49");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>



</body>
</html>
