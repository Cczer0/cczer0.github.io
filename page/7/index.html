<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Zero&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Love Linux ♥ Love Python. 猴赛雷">
<meta property="og:type" content="website">
<meta property="og:title" content="Zero's Blog">
<meta property="og:url" content="http://czero000.github.io/page/7/index.html">
<meta property="og:site_name" content="Zero's Blog">
<meta property="og:description" content="Love Linux ♥ Love Python. 猴赛雷">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zero's Blog">
<meta name="twitter:description" content="Love Linux ♥ Love Python. 猴赛雷">
  
    <link rel="alternate" href="/atom.xml" title="Zero&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Zero&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">点滴分享 多彩生活</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://czero000.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-saltstack-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/31/saltstack-install.html" class="article-date">
  <time datetime="2016-03-31T03:21:59.000Z" itemprop="datePublished">2016-03-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/运维自动化/">运维自动化</a>►<a class="article-category-link" href="/categories/运维自动化/SaltStack/">SaltStack</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/31/saltstack-install.html">SaltStack安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="初识-SaltStack"><a href="#初识-SaltStack" class="headerlink" title="初识 SaltStack"></a>初识 SaltStack</h2><h3 id="什么是-SaltStack"><a href="#什么是-SaltStack" class="headerlink" title="什么是 SaltStack"></a>什么是 SaltStack</h3><p>SaltStack 是继 Puppet、Chef 之后新出现的配置管理及远程执行工具。SaltStack 是基于 Python 开发的一套 C/S 架构配置关机工具，底层使用 ZeroMQ 消息队列 pub/sub 方式通信，使用 SSL 证书剪发的方式进行认证管理。与 Puppet 相比，SaltStack 没有那么笨重，较为轻量，不想 Puppet 有一套自己的 DSL 用来编写配置。SaltStack 使用 YAML 作为配置文件格式，这样写起来既简单有容易，同时也便于动态生成；此外 SaltStack 在远程执行命令时的速度也非常快，并包含丰富的模块，SaltStack 很好的包含了状态管理的优点，大大提好运维人员的工作效率。简单总结有两大用处：</p>
<ul>
<li><strong>配置管理系统，能够维护预定义状态的远程节点（比如，确保指定的软件包被安装和特定的服务在运行）</strong></li>
<li><strong>一个分布式远程执行系统，用来在远程节点上执行命令和查询数据，可以单个节点，也可以是选定规则</strong></li>
</ul>
<p><img src="http://ofc9x1ccn.bkt.clouddn.com/saltstack/salt_functions.png" alt="salt_functions"></p>
<p><strong>SaltStack 特点</strong></p>
<p><strong>简单：</strong></p>
<pre><code>兼顾大规模部署和小规模系统环境，Salt 非常简单配置和维护，不管是本地网络系统，还是跨数据中心。salt 采用 C/S 架构，需要的功能内建到一组 daemon 中，只需要简单的配置就可以工作，也可以调整来满足自己特定需求。
</code></pre><p><strong>并行执行：</strong></p>
<ul>
<li>通过并行方式让远程节点执行命令</li>
<li>采用安全的加密协议</li>
<li>最小、最快使用网络和负责</li>
<li>提供简单的编程接口</li>
<li>提供更细粒度的控制，使系统不止按照主机名，还允许按照系统属性来分类</li>
</ul>
<p><strong>成熟技术之上构建：</strong></p>
<ul>
<li>网络层采用优秀的 ZeroM Q库，salt的守护进程包含可行和透明的AMQ代理</li>
<li>使用公钥和 Master 端通信，使用更快的AES加密协议，集成认证和加密在Salt中</li>
<li>使用 msgpack 通讯，所以更快速和更轻量网络交换</li>
</ul>
<p><strong>Python 客户端接口：</strong></p>
<ul>
<li>允许简单的拓展，Salt 程序可以写成 Python 模块，Client 收集数据发送回 Master 或者其他程序</li>
<li>可以从简单的 Python API 调用或者从命令行调用，因此可以执行一次命令或者大型应用程序的一部分</li>
</ul>
<p><strong>快速、灵活、可扩展：</strong></p>
<ul>
<li>高速在一台或者一组服务器执行命令</li>
<li>速度快、配置简单、扩展性好，提供远程执行架构，可以管理任意数量的多样化需求的服务器</li>
<li>集成最好的远程执行工具，增强处理能力、拓展使用范围，可以使用多样化复杂的网络</li>
</ul>
<p><strong>开源：</strong></p>
<p>Salt 是在 Apache 2.0 Licence 下开发，可以用在开源或者私有项目</p>
<p> <img src="http://ofc9x1ccn.bkt.clouddn.com/saltstack/salt-module.png" alt="salt-module"></p>
<hr>
<h3 id="支持的系统"><a href="#支持的系统" class="headerlink" title="支持的系统"></a><strong>支持的系统</strong></h3><p>常见的发行版都已被支持：</p>
<ul>
<li>Arch Linux</li>
<li>Debian</li>
<li>Fedora</li>
<li>FreeBSD</li>
<li>Gentoo</li>
<li>OS X</li>
<li>RHEL / CentOS / Scientific Linux / Amazon Linux / Oracle Linux（EPEL5、EPEL6、EPEL7）</li>
<li>Sloaris</li>
<li>Ubuntu</li>
<li>Windows</li>
<li>SUSE</li>
</ul>
<h2 id="安装-SaltStack"><a href="#安装-SaltStack" class="headerlink" title="安装 SaltStack"></a>安装 SaltStack</h2><h3 id="SaltStack-软件依赖"><a href="#SaltStack-软件依赖" class="headerlink" title="SaltStack 软件依赖"></a>SaltStack 软件依赖</h3><p>由于 SaltStack 是基于 Python 开发，对 Python 版本和 python 模块有一定要求。</p>
<ul>
<li>Python：版本大于2.6、小于3.0</li>
<li>msgpack-python ：高性能消息交换格式</li>
<li>YAML：SaltStack 配置解析定义语法</li>
<li>Jinja2：SaltStac k配置模版</li>
<li>MarkupSafe：Python unicode 转换库</li>
<li>apache-libcloud：SaltStack 对云架构编排库</li>
<li>Requests：HTTP Python 库</li>
<li>ZeroMQ：SaltStack 消息系统<ul>
<li>pyzmq：ZeroMQ Python 库</li>
<li>PyCrypto：Python 密码库</li>
<li>M2Crypto：Openssl Python 包装库</li>
</ul>
</li>
</ul>
<h3 id="安装-SaltStack-1"><a href="#安装-SaltStack-1" class="headerlink" title="安装 SaltStack"></a>安装 SaltStack</h3><p>SaltStack提供了四种安装方式（yum、pip、源码、salt-bootstrap），部署环境为 <code>CentOS Linux release 7.1.1503 (Core)</code></p>
<ul>
<li>Master（172.16.11.210）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://mirrors.yun-idc.com/epel/7/x86_64/e/epel-release-7-5.noarch.rpm</div><div class="line">yum install salt-master -y</div><div class="line">systemctl start salt-master</div></pre></td></tr></table></figure>
<ul>
<li>Minion（172.16.11.211）<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://mirrors.yun-idc.com/epel/7/x86_64/e/epel-release-7-5.noarch.rpm</div><div class="line">yum install salt-minion -y</div><div class="line">sed -i &apos;s/#master: salt/master: 172.16.11.210/g&apos; /etc/salt/minion   // 这里为 Master 的 ip 地址</div><div class="line">echo &quot;172.16.11.211&quot; &gt; /etc/salt/minion_id                          // 在 Master 认证是显示的 minion id</div><div class="line">systemctl start salt-minion</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="SaltStack-证书管理"><a href="#SaltStack-证书管理" class="headerlink" title="SaltStack 证书管理"></a>SaltStack 证书管理</h2><p>Salt 在 master 和 minion 通信使用AES加密，保证发给 minion 的指令安全，Master和minion之间认证采用信任接受的 Key，在发送命令到 minion 之前，minon 的 key 需要先被 master 所接受，运行 salt-key 可以列出当前 key 状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">salt-key -L                                // 查看当前证书情况</div><div class="line"> Accepted Keys:</div><div class="line"> Denied Keys:</div><div class="line"> Unaccepted Keys:</div><div class="line"> 172.16.11.211</div><div class="line"> Rejected Keys:</div><div class="line"></div><div class="line">salt-key -A -y                              // 同意签证所有没接受的请求                                 </div><div class="line"> The following keys are going to be accepted:</div><div class="line"> Unaccepted Keys:</div><div class="line"> 172.16.11.211</div><div class="line"> Key for minion 172.16.11.211 accepted.</div><div class="line"></div><div class="line">salt-key -L                               </div><div class="line"> Accepted Keys:</div><div class="line"> 172.16.11.211</div><div class="line"> Denied Keys:</div><div class="line"> Unaccepted Keys:</div><div class="line"> Rejected Keys:</div></pre></td></tr></table></figure>
<p>更多的证书管理通过<code>salt-key  -h</code>查看。</p>
<hr>
<h2 id="配置SaltStack"><a href="#配置SaltStack" class="headerlink" title="配置SaltStack"></a>配置SaltStack</h2><h3 id="Master端"><a href="#Master端" class="headerlink" title="Master端"></a>Master端</h3><p>master端的配置文件是<code>/etc/salt/master</code>，其中的配置选项较多，在日常使用中，需要经常修改Master的配置文件。SaltStack的大部分配置都可以保持默认，只需根据自己的实际需求更改配置即可。其中下面几个在平时使用过程中，会经常能改。</p>
<ul>
<li>max_open_files ：     根据Master将Minin数量进行适当的调整</li>
<li>timeout  ： 可以根据Master 和Minion的网络状况调整</li>
<li>auto_accept和autosign_file： 在大规模部署Minion的时候可以设置为自动签证</li>
<li>master_tops和所有以external开头的参数： 这些参数是SaltStack与外部系统进行整合的相关配置参数</li>
</ul>
<p>详细配置信息可以参考：<a href="http://arlen.blog.51cto.com/7175583/1423997" target="_blank" rel="external">http://arlen.blog.51cto.com/7175583/1423997</a></p>
<h3 id="Minion"><a href="#Minion" class="headerlink" title="Minion"></a>Minion</h3><p>master端的配置文件是<code>/etc/salt/minion</code>，大部分情况保持默认即可<br>详细配置信息可以参考：<a href="http://arlen.blog.51cto.com/7175583/1424008" target="_blank" rel="external">http://arlen.blog.51cto.com/7175583/1424008</a></p>
<hr>
<h2 id="SaltStack常用命令操作"><a href="#SaltStack常用命令操作" class="headerlink" title="SaltStack常用命令操作"></a>SaltStack常用命令操作</h2><h4 id="Master端-1"><a href="#Master端-1" class="headerlink" title="Master端"></a>Master端</h4><ul>
<li>salt              // salt master核心操作命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt [options] &apos;&lt;target&gt;&apos; &lt;function&gt; [arguments]</div><div class="line">salt &apos;*&apos; test.ping</div></pre></td></tr></table></figure>
<ul>
<li>salt-cp         // 文件传输命令 ，不支持目录分发</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt-cp [options] &apos;&lt;target&gt;&apos; SOURCE DEST</div><div class="line">salt-cp &apos;*&apos; test.txt /root/</div></pre></td></tr></table></figure>
<ul>
<li>salt-key       // 证书管理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt-key [options]</div><div class="line">salt-key -L</div></pre></td></tr></table></figure>
<ul>
<li>salt-master  // 服务命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt-master [options]</div><div class="line">salt-master -d         //后台运行master</div></pre></td></tr></table></figure>
<ul>
<li>salt-run       // 执行 runner</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt-run [options] [runner.func]</div><div class="line">salt-run manage.status</div></pre></td></tr></table></figure>
<ul>
<li>salt-unity</li>
</ul>
<h3 id="Minion端"><a href="#Minion端" class="headerlink" title="Minion端"></a>Minion端</h3><ul>
<li>salt-call   //  拉取命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt-call [options] &lt;function&gt; [arguments]</div><div class="line">salt-call test.ping           //自己执行test.ping命令</div></pre></td></tr></table></figure>
<ul>
<li>salt-minion  // 服务命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt-minion [options]</div><div class="line">salt-minion -d         //后台运行</div></pre></td></tr></table></figure>
<hr>
<h2 id="SaltStack常用模块"><a href="#SaltStack常用模块" class="headerlink" title="SaltStack常用模块"></a>SaltStack常用模块</h2><p>Saltstack通过模块来实现管理，具备丰富的模块功能，命令形式也较为自由。</p>
<ul>
<li>sys.doc：类似Linux的man命令，可以显示minion支持的模块的详细操作说明</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">salt &apos;*&apos; sys.doc status.all_status        //查询status.all_status模块函数的使用方法                                                                     </div><div class="line">&apos;status.all_status:&apos;</div><div class="line">    Return a composite of all status data and info for this minion.</div><div class="line">    Warning: There is a LOT here!</div><div class="line">    CLI Example:</div><div class="line">        salt &apos;*&apos; status.all_status</div></pre></td></tr></table></figure>
<ul>
<li>status ：status模块是系统状态的常用信息模块，可以利用status模块查看系统信息</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">salt &apos;172.16.11.211&apos; status.loadavg   // 查询负载信息，还有status.[cpuinfo,diskstats,meminfo,w]</div><div class="line">172.16.11.211:</div><div class="line">    ----------</div><div class="line">    1-min:</div><div class="line">        0.05</div><div class="line">    15-min:</div><div class="line">        0.05</div><div class="line">    5-min:</div><div class="line">        0.07</div></pre></td></tr></table></figure>
<ul>
<li>test：  更多使用方法使用访问官方网站或者<code>salt &#39;*&#39; sys.doc test</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">salt &apos;172.16.11.211&apos;  test.ping</div><div class="line">172.16.11.211:</div><div class="line">    True</div></pre></td></tr></table></figure>
<ul>
<li>state：是salt state的管理模块，可以通过state模块简单的对minin操作sls状态</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">salt &apos;172.16.11.211&apos; state.highstate //更新指定minons的所有sls状态</div><div class="line"></div><div class="line">salt &apos;172.16.11.211&apos; state.running //查看当前运行的sls状态</div><div class="line"></div><div class="line">salt &apos;172.16.11.211&apos; state.single pkg.installed name=vim //动态指定一个sls状态</div></pre></td></tr></table></figure>
<ul>
<li>saltutil ： SaltStack的一些辅助操作命令模块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">salt &apos;*&apos; saltutil.is_running state.highstate     //判断一个函数是否正在使用</div><div class="line">salt &apos;*&apos; saltutil.kill_job &lt;job id&gt;              // 强制关闭一个job进程</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/03/31/saltstack-install.html" data-id="civlqiu460015c15m6gm5zafg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/saltstack/">saltstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-learn-python-mindmap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/30/learn-python-mindmap.html" class="article-date">
  <time datetime="2016-03-30T08:56:47.000Z" itemprop="datePublished">2016-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/30/learn-python-mindmap.html">Python学习--思维导图</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<p>思维导图转自<a href="http://www.pythoner.com/" target="_blank" rel="external">pythoner</a></p>
<h2 id="第一部分-Python语言"><a href="#第一部分-Python语言" class="headerlink" title="第一部分 Python语言"></a>第一部分 Python语言</h2><h3 id="第一章-基本环境"><a href="#第一章-基本环境" class="headerlink" title="第一章 基本环境"></a>第一章 基本环境</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/基本环境.png" alt="基本环境" title="基本环境"> </p>
<hr>
<h3 id="第二章-内置类型"><a href="#第二章-内置类型" class="headerlink" title="第二章 内置类型"></a>第二章 内置类型</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/内置类型.png" alt="内置类型" title="内置类型"> </p>
<hr>
<h3 id="第三章-表达式"><a href="#第三章-表达式" class="headerlink" title="第三章 表达式"></a>第三章 表达式</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/表达式.png" alt="表达式" title="表达式"> </p>
<hr>
<h3 id="第四章-函数"><a href="#第四章-函数" class="headerlink" title="第四章 函数"></a>第四章 函数</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/函数.png" alt="函数" title="函数"> </p>
<hr>
<h3 id="第五章-迭代器"><a href="#第五章-迭代器" class="headerlink" title="第五章 迭代器"></a>第五章 迭代器</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/迭代器.png" alt="迭代器" title="迭代器"> </p>
<hr>
<h3 id="第六章-模块"><a href="#第六章-模块" class="headerlink" title="第六章 模块"></a>第六章 模块</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/模块.png" alt="模块" title="模块"> </p>
<hr>
<h3 id="第七章-类"><a href="#第七章-类" class="headerlink" title="第七章 类"></a>第七章 类</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/类.png" alt="类" title="类"> </p>
<hr>
<h3 id="第八章-异常"><a href="#第八章-异常" class="headerlink" title="第八章 异常"></a>第八章 异常</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/异常.png" alt="异常" title="异常"> </p>
<hr>
<h3 id="第九章-装饰器"><a href="#第九章-装饰器" class="headerlink" title="第九章 装饰器"></a>第九章 装饰器</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/装饰器.png" alt="装饰器" title="装饰器"> </p>
<hr>
<h3 id="第十章-描述符"><a href="#第十章-描述符" class="headerlink" title="第十章 描述符"></a>第十章 描述符</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/描述符.png" alt="描述符" title="描述符"> </p>
<hr>
<h3 id="第十一章-元类"><a href="#第十一章-元类" class="headerlink" title="第十一章 元类"></a>第十一章 元类</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/元类.png" alt="元类" title="元类"> </p>
<hr>
<h2 id="第二部分-标准库"><a href="#第二部分-标准库" class="headerlink" title="第二部分 标准库"></a>第二部分 标准库</h2><h3 id="标准库"><a href="#标准库" class="headerlink" title="标准库"></a>标准库</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/标准库.png" alt="标准库" title="标准库"> </p>
<hr>
<h2 id="第三部分-扩展库"><a href="#第三部分-扩展库" class="headerlink" title="第三部分 扩展库"></a>第三部分 扩展库</h2><h3 id="扩展库"><a href="#扩展库" class="headerlink" title="扩展库"></a>扩展库</h3><p><img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/扩展库.png" alt="扩展库" title="扩展库"> </p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p> <img src="http://ofc9x1ccn.bkt.clouddn.com/python/mindmap/附录.png" alt="附录" title="附录"> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/03/30/learn-python-mindmap.html" data-id="civlqiu4d001bc15mz5s3i89v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-glibc-getaddrinfo-repair" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/18/glibc-getaddrinfo-repair.html" class="article-date">
  <time datetime="2016-02-18T10:20:23.000Z" itemprop="datePublished">2016-02-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/System/">System</a>►<a class="article-category-link" href="/categories/System/Security/">Security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/18/glibc-getaddrinfo-repair.html">glibc再爆漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<h2 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h2><p>近日，Google和Red Hat的安全人员发现GNU C Library (glibc)中存在严重的安全漏洞，可导致Linux软件被攻击者劫持，进而在Linux平台上执行任意代码，获取密码，监视用户，甚至控制计算机。CVE编号为<a href="http://access.redhat.com/security/cve/CVE-2015-7547" target="_blank" rel="external">CVE-2015-7547</a>。<br><img src="http://ofc9x1ccn.bkt.clouddn.com/security/glibc_bug.jpg" alt="glibc_bug"></p>
<p>glibc是GNU发布的libc库，即c运行库。它是Linux系统中最底层的API，几乎其它运行库都会依赖于glibc。glibc应用于众多Linux发行版本中，所以此类漏洞影响范围十分广泛。</p>
<h3 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h3><p>glibc的DNS客户端解析器中存在基于栈的缓冲区溢出漏洞。当软件用到getaddrinfo库函数(处理名字到地址以及服务到端口的转换)时，攻击者便可借助特制的域名、DNS服务器或中间人攻击利用该漏洞，控制软件，并试图控制整个系统。</p>
<p>攻击者使用恶意的DNS域名服务器创建类似于evildomain.com的域名，然后向目标用户发送带有指向该域名的链接的邮件，一旦用户点击该链接，客户端或浏览器将会开始查找ildomain.com，并最终得到恶意服务器的buffer-busting响应。该域名被嵌入服务器日志中，一旦解析就会触发远程代码执行，SH客户端也会因此被控制。或者，位于目标用户网络中的中间人攻击者可以篡改DNS响应，向恶意代码中动态注入负载。</p>
<p>据目前的调查情况，此漏洞影响自2.9之后的所有版本，其他旧版本也可能受到影响。<br><img src="http://ofc9x1ccn.bkt.clouddn.com/security/glibc_system_version.png" alt="glibc_system_version" title="收到影响的RHEL系统版本"></p>
<p>其他系统还包括<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">CentOS6 所有版本</div><div class="line">CentOS7所有版本</div><div class="line">SUSE Linux Enterprise Server 11 SP3</div><div class="line">SUSE Linux Enterprise Server 12</div><div class="line">Ubuntu Server 14.04.1 LTS 32位</div><div class="line">Ubuntu Server 14.04.1 LTS 64位</div><div class="line">Ubuntu Server 12.04 LTS 64位</div><div class="line">Ubuntu Server 12.04 LTS 64位（Docker）</div><div class="line">Debian8.2 32位</div><div class="line">Debian8.2 64位</div><div class="line">Debian7.8 32位</div><div class="line">Debian7.8 64位</div><div class="line">Debian7.4 64位</div><div class="line">CoreOS717.3.0 64位</div></pre></td></tr></table></figure></p>
<h3 id="技术细节"><a href="#技术细节" class="headerlink" title="技术细节"></a>技术细节</h3><p>glibc通过alloca()函数在栈中为<code>_nss_dns_gethostbyname4_r</code>函数2048字节的空间，用于托管DNS响应。若响应大于2048字节，程序会从堆中重新分配一个缓冲区，并更新所有信息(缓冲区指针，缓冲区大小和响应大小)。</p>
<p>在一定条件下，会出现栈缓冲区和新分配的堆内存的错误匹配，导致超过栈缓冲区大小的响应仍然存储在栈中，进而发生缓冲区溢出。触发该漏洞的利用向量十分普遍，并且ssh、sudo和curl等工具中。</p>
<h3 id="缓解"><a href="#缓解" class="headerlink" title="缓解"></a>缓解</h3><p>该漏洞存在于resolv/res_send.c文件中，当getaddrinfo()函数被调用时会触发该漏洞。技术人员可以通过将TCP DNS响应的大小限制为1024字节，并丢弃所有超过512字节的UDPDNS数据包来缓解该问题。值得庆幸的是，许多嵌入式Linux设备，例如家庭路由器，更倾向于使用uclibc库，因此可以免受该漏洞的影响。</p>
<h3 id="漏洞的成因及POC使用测试"><a href="#漏洞的成因及POC使用测试" class="headerlink" title="漏洞的成因及POC使用测试"></a>漏洞的成因及POC使用测试</h3><p>据悉，漏洞的成因在于DNS Server Response返回过量的(2048 ) 字节, 导致接下来的response 触发栈溢出。目前，Google已提供了POC，据其博客中所述，该漏洞应该是可以绕过内存防护技术，从而形成代码执行漏洞。<br>具体POC 地址如下：github.com/fjserna/CVE-2015-7547<br>  对此，乌云白帽子路人甲在自己的本地lubuntu 上进行了测试，libc 版本为 2.19。lubuntu系列也属于Debian 的一个发行版，故理论上满足漏洞条件。测试过程如下：<br>根据漏洞描述，我们可以做一个假的DNS Server 作为中间人，来验证该漏洞。更改DNS 解析为 127.0.0.1，刷新DNS 缓存 sudo /etc/init.d/nscd restart 执行 CVE-2015-7547-poc.py , 注意无需更改 ip_addr 。编译 CVE-2015-7547-client.c , 执行CVE-2015-7547-client<br>若含有漏洞，会造成Segmentation Fault。<br><img src="http://ofc9x1ccn.bkt.clouddn.com/security/glibc_bug_info.png" alt="glibc_bug_info"></p>
<p>文件下载链接：<br><a href="http://ofc9x1ccn.bkt.clouddn.com/upload/securioty/CVE-2015-7547-master.zip" target="_blank" rel="external">CVE-2015-7547-master.zip</a></p>
<h2 id="修复过程"><a href="#修复过程" class="headerlink" title="修复过程"></a>修复过程</h2><ol>
<li><p>更新glibc版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//rhel¢os</div><div class="line">yum -y update glibc* nscd</div><div class="line"></div><div class="line"></div><div class="line">//debian&amp;ubuntu</div><div class="line">apt-get update</div><div class="line">apt-get install libc6; apt-get install libc-bin</div></pre></td></tr></table></figure>
</li>
<li><p>重启服务<br>由于本次漏洞为glibc的漏洞，涉及多种应用程序，最安全并且推荐的修复方法是重启系统生效。<br>如果你的系统无法重启，请执行如下命令查询仍然在使用老版本glibc的程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsof +c0 -d DEL | awk &apos;NR==1 || /libc-/ &#123;print $2,$1,$4,$NF&#125;&apos; | column -t</div></pre></td></tr></table></figure>
</li>
</ol>
<p>根据查询的结果, 识别哪些是对外提供服务的程序，重启对应的服务。</p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>公司大部分服务器都是centos 6.x和7.x ，CentOS 社区也在2016年2月17日 更新了最新的glibc版本，那么升级起来就很方便了，写了个升级脚本，内容如下，先让脚本跑一会。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">cat repair_glibc.sh </div><div class="line">#!/bin/bash</div><div class="line">######################################################</div><div class="line">## Title:  Repair glibc getaddrinfo() Bug 18665     ##</div><div class="line">## Version: 1.0                                     ##</div><div class="line">## Date: 2016-02-18                                 ##</div><div class="line">## Author: Charlie.Cui                              ##</div><div class="line">## License: General Public License (GPL)            ##</div><div class="line">## Copyright© 2015, Charlie.Cui All Rights Reserved ##</div><div class="line">######################################################</div><div class="line"></div><div class="line">system=`cat /etc/redhat-release| awk &apos;&#123;print $1&#125;&apos;`</div><div class="line">release=`rpm -qa | grep ^kernel-[0-9] |head -n 1 | awk -F&apos;.&apos; &apos;&#123;print $4&#125;&apos;`</div><div class="line">glibc_version=`rpm -qa glibc`</div><div class="line">FRed=&quot;\E[31;40m&quot;; FGreen=&quot;\E[32;40m&quot;; FBlue=&quot;\E[34;40m&quot;; St0=&quot;\033[1m&quot;; St1=&quot;\033[5m&quot;; Ed=&quot;\033[0m&quot; </div><div class="line"></div><div class="line"># el6 Update glibc</div><div class="line">el6() &#123;</div><div class="line">wget http://172.16.6.18/resource/files/CentOS6.x/local_mirror.repo -O /etc/yum.repos.d/local_mirror.repo</div><div class="line">wget http://172.16.6.18/resource/files/CentOS6.x/epel.repo -O /etc/yum.repos.d/epel.repo</div><div class="line">yum clean all;yum makecache</div><div class="line">yum update glibc -y</div><div class="line">if [ $glibc_version = glibc-2.12-1.166.el6_7.7.x86_64 ];then</div><div class="line">  echo -e &quot; $FGreen $glibc_version Update Sucesed! $Ed&quot;</div><div class="line">else </div><div class="line">  echo -e &quot; $FRed $glibc_version Update Faild! $Ed&quot;</div><div class="line">fi</div><div class="line">&#125;</div><div class="line"></div><div class="line"># el7 Update glibc</div><div class="line">el7() &#123;</div><div class="line">wget http://172.16.6.18/resource/files/CentOS7.x/local_mirror.repo -O /etc/yum.repos.d/local_mirror.repo</div><div class="line">wget http://172.16.6.18/resource/files/CentOS7.x/epel.repo -O /etc/yum.repos.d/epel.repo</div><div class="line">yum clean all;yum makecache</div><div class="line">yum update glibc -y</div><div class="line">if [ $glibc_version = glbc-2.17-106.el7_2.4.x86_64 ];then</div><div class="line">  echo -e &quot; $FGreen $glibc_version Update Sucesed! $Ed&quot;</div><div class="line">else </div><div class="line">  echo -e &quot; $FRed $glibc_version Update Faild! $Ed&quot;</div><div class="line">fi</div><div class="line">&#125;</div><div class="line"></div><div class="line"># Check System </div><div class="line">if [ $system = CentOS ];then</div><div class="line">  echo -e &quot;$FGreen This System Version Is: $system continue update glibc version... $Ed&quot;</div><div class="line">  # Check release</div><div class="line">  if [ $release = el6 ];then</div><div class="line">    if [ `rpm -qa glibc` = glibc-2.12-1.166.el6_7.7.x86_64 ];then</div><div class="line">      echo -e &quot; $FGreen $glibc_version is the latest version $Ed&quot;</div><div class="line">    else </div><div class="line">      el6</div><div class="line">    fi</div><div class="line">  elif [ $release = el7 ];then</div><div class="line">    if [ `rpm -qa glibc` = glibc-2.17-106.el7_2.4.x86_64 ];then</div><div class="line">      echo -e &quot; $FGreen $glibc_version is the latest version $Ed&quot;</div><div class="line">    else</div><div class="line">      el7</div><div class="line">    fi</div><div class="line">  else </div><div class="line">    echo -e &quot;$FRed Unknow Error $Ed&quot;</div><div class="line">    exit;</div><div class="line">  fi</div><div class="line">else</div><div class="line">  echo -e &quot;$FRed This System Version Is Not CentOS $Ed&quot;</div><div class="line">  exit;</div><div class="line">fi</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/18/glibc-getaddrinfo-repair.html" data-id="civlqiu8n0065c15mb8p82mru" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/glibc/">glibc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/security/">security</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-setup-reverse-proxy-by-nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/16/how-to-setup-reverse-proxy-by-nginx.html" class="article-date">
  <time datetime="2016-02-16T09:02:21.000Z" itemprop="datePublished">2016-02-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/16/how-to-setup-reverse-proxy-by-nginx.html">Nginx玩转反向代理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><h3 id="初识反向代理"><a href="#初识反向代理" class="headerlink" title="初识反向代理"></a>初识反向代理</h3><p>反向代理 (Reverse Proxy) 是指以代理服务器来接受 Internet 的连接请求，然后将请求转发给内部服务器，并将从服务器得到的结构返回给 Internet 请求客户端，喜事的代理服务器对外表现为一个反向代理服务器。</p>
<p><img src="http://ofc9x1ccn.bkt.clouddn.com/nginx/Reverse_Proxy.png" alt="Reverse_Proxy" title="反向代理示意图"></p>
<h3 id="反向代理作用"><a href="#反向代理作用" class="headerlink" title="反向代理作用"></a>反向代理作用</h3><ul>
<li>保护网站安全 – 任何来自 Internet 的请求都必须先经过代理服务器</li>
<li>通过配置缓存功能加速 Web 请求 – 可以缓存后端 Web 服务器的某些静态资源，减轻 Web 服务器的负载</li>
<li>实现负载均衡 – 充当负载均衡服务器均衡的分发请求，平衡集群中各个服务器的负载压力</li>
</ul>
<h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><p>安装过程参考 nginx+php-fpm 这篇文章的安装过程</p>
<h2 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h2><p>简单的反向代理就是 http，不需要缓存控制等高级功能，仅仅一个简单的代理，比如 nginx+php-fpm 也是一种反向代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">location ~ .*\.(php|php5)$ &#123;</div><div class="line">   fastcgi_pass 127.0.0.1:9000;</div><div class="line">   include        fastcgi.conf;</div><div class="line">   try_files $uri =404;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而相对复杂一些的就是反向代理一些网站，会应用到缓存控制机制。</p>
<h3 id="简单反向代理"><a href="#简单反向代理" class="headerlink" title="简单反向代理"></a>简单反向代理</h3><ul>
<li>在 nginx.conf 配置文件中的 http 块中添加下面内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// 反向代理参数</div><div class="line">proxy_connect_timeout 5;                        // nginx 跟后端服务器连接超时时间(代理连接超时)                       </div><div class="line">proxy_send_timeout 60;</div><div class="line">proxy_read_timeout 5;                           // 连接成功后，后端服务器响应时间(代理接收超时)</div><div class="line">proxy_buffer_size 32k;                          // 设置代理服务器（nginx）保存用户头信息的缓冲区大小</div><div class="line">proxy_buffers 4 64k;                            // proxy_buffers 缓冲区</div><div class="line">proxy_busy_buffers_size 128k;                   // 高负荷下缓冲大小（proxy_buffers*2）</div><div class="line">proxy_temp_file_write_size 128k;                  </div><div class="line">proxy_ignore_client_abort on;                   // 不允许代理端主动关闭连接</div><div class="line">proxy_headers_hash_max_size 51200;</div><div class="line">proxy_headers_hash_bucket_size 6400;</div><div class="line"></div><div class="line">// 配置临时目录、缓存路径(同一个硬盘分区，注意权限)</div><div class="line">proxy_temp_path   /cache/proxy_temp 1 2;</div><div class="line">proxy_cache_path  /cache/proxy_cache levels=1:2 keys_zone=cache_one:200m inactive=1d max_size=10g;</div><div class="line"></div><div class="line">// keys_zone=cache_one:200m 表示这个 zone 名称为 cache_one，分配的内存大小为 200MB</div><div class="line">// levels=1:2 表示缓存目录的第一级目录是 1 个字符，第二级目录是 2 个字符</div><div class="line">// inactive=1d 表示这个 zone 中的缓存文件如果在 1 天内都没有被访问，那么文件会被 cache manager 进程删除</div><div class="line">// max_size=10G 表示这个 zone 的硬盘容量为 10G</div></pre></td></tr></table></figure>
<ul>
<li>在虚拟主机配置文件 proxy.zerounix.com.conf 文件中添加下面内容</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  proxy.zerounix.com;</div><div class="line">        index index.html index.htm index.php;</div><div class="line">        access_log  logs/proxy.zerounix.com_access.log access;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            proxy_redirect off;</div><div class="line">            proxy_set_header Host $host;</div><div class="line">            proxy_set_header X-Real-IP $remote_addr;</div><div class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</div><div class="line">            proxy_set_header X-Forwarded-For $remote_addr;</div><div class="line">            proxy_pass http://172.16.11.211;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">// 只对图片、js、css 等静态文件进行缓存</div><div class="line"></div><div class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|js|css)$ &#123;</div><div class="line">            proxy_next_upstream http_502 http_504 error timeout invalid_header;</div><div class="line">            proxy_cache cache_one;</div><div class="line">            proxy_cache_valid  200 304 12h;</div><div class="line">            proxy_cache_valid 301 302 1m;</div><div class="line">            proxy_cache_valid any 1m;</div><div class="line">            proxy_cache_key $host$uri$is_args$args;</div><div class="line">            proxy_set_header Host $host;</div><div class="line">            proxy_set_header X-Real-IP $remote_addr;</div><div class="line">            proxy_set_header X-Forwarded-For $remote_addr;</div><div class="line">            proxy_set_header Accept-Encoding &quot;none&quot;;</div><div class="line">            proxy_ignore_headers &quot;Cache-Control&quot; &quot;Expires&quot;;</div><div class="line">            proxy_pass http://172.16.11.211;</div><div class="line">            expires      1h;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        location ~ .*\.(php|jsp|cgi)?$ &#123;</div><div class="line">            proxy_set_header Host $host;</div><div class="line">            proxy_set_header X-Forwarded-For  $remote_addr;</div><div class="line">            proxy_pass http://172.16.11.211;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        error_page  500 502 503 504  /50x.html;</div><div class="line"></div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用SSL的反向代理"><a href="#使用SSL的反向代理" class="headerlink" title="使用SSL的反向代理"></a>使用SSL的反向代理</h3><ul>
<li>安装nginx</li>
</ul>
<p>需要将将 ‘–with-http_sub_module、ngx_cache_purge-2.3’ 编译到 nginx 中<br>下载链接<a href="http://labs.frickle.com/files/" target="_blank" rel="external">http://labs.frickle.com/files/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 编译参数</div><div class="line">./configure --prefix=/usr/local/nginx --add-module=../ngx_cache_purge-2.3 \</div><div class="line">--with-http_sub_module --with-http_stub_status_module --with-http_ssl_module --with-http_flv_module \</div><div class="line">--with-http_gzip_static_module --with-ld-opt=-ljemalloc</div></pre></td></tr></table></figure>
<ul>
<li>签发证书</li>
</ul>
<p>自己签发免费 ssl 证书，为 nginx 生成自签名 ss l证书(访问时需添加信任。也可以使用第三方签名后的证书，如免费的 startssl)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/nginx/conf</div><div class="line">openssl genrsa -out server.key 1024</div><div class="line">openssl req -new -key server.key -out server.csr</div><div class="line">openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</div></pre></td></tr></table></figure></p>
<ul>
<li>配置反向代理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">proxy_temp_path   /cache/proxy_temp 1 2;</div><div class="line">proxy_cache_path  /cache/proxy_cache levels=1:2 keys_zone=cache_one:200m inactive=1d max_size=10g;</div><div class="line">proxy_cache_key &quot;$host$request_uri&quot;;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">listen 80;</div><div class="line">server_name proxy.zerounix.com;</div><div class="line">rewrite ^(.*) http://proxy.zerounix.com$1 permanent;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server</div><div class="line">    &#123;</div><div class="line">        listen 443;</div><div class="line">        server_name proxy.zerounix.com;</div><div class="line"></div><div class="line">        upstream google &#123;</div><div class="line">            server 173.194.127.144:80 max_fails=3;</div><div class="line">            server 173.194.127.147:80 max_fails=3;</div><div class="line">            server 173.194.127.148:80 max_fails=3;</div><div class="line">            server 173.194.127.145:80 max_fails=3;</div><div class="line">            server 173.194.127.146:80 max_fails=3;  </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        ssl on;</div><div class="line">        ssl_certificate      /usr/local/nginx/ssl/nginx.crt;      </div><div class="line">        ssl_certificate_key  /usr/local/nginx/ssl/nginx.key;   </div><div class="line">        ssl_protocols   TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:RC4-SHA:!aNULL:!eNULL:!EXPORT:!DES:!3DES:!MD5:!DSS:!PKS;</div><div class="line">        ssl_prefer_server_ciphers  on;</div><div class="line">        ssl_session_cache       shared:SSL:10m;</div><div class="line">        ssl_session_timeout     5m;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            proxy_cache one;</div><div class="line">            proxy_cache_valid  200 302  1h;</div><div class="line">            proxy_cache_valid  404      1m;</div><div class="line">            proxy_redirect http://www.google.com/ /;</div><div class="line">            proxy_cookie_domain google.com proxy.zerounix.com;</div><div class="line">            proxy_pass              http://google;</div><div class="line">            proxy_set_header Host &quot;www.google.com&quot;;</div><div class="line">            proxy_set_header Accept-Encoding &quot;&quot;;</div><div class="line">            proxy_set_header User-Agent $http_user_agent;</div><div class="line">            proxy_set_header Accept-Language &quot;zh-CN&quot;;</div><div class="line">            proxy_set_header Cookie &quot;PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=zh-CN:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2w1IQ-Maw&quot;;            </div><div class="line">            sub_filter www.google.com proxy.zerounix.com;</div><div class="line">            sub_filter_once off</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>1 监听了 80 和 443 端口，可以在 Linux自己生成证书。<br>2 定义了个 upstream google，放了 5 个谷歌的 ip（通过 nslookup www.google.com 命令获取（yum -y install bind-utils）），如果不这样做，就等着被谷歌的验证码搞崩溃吧。<br>3 也设置了反向代理缓存，某些资源不用重复去请求谷歌获取，加快搜索速度<br>4 proxy_redirect <a href="http://www.google.com/" target="_blank" rel="external">http://www.google.com/</a> /; 这行的作用是把谷歌服务器返回的302响应头里的域名替换成我们的，不然浏览器还是会直接请求 www.google.com，那样反向代理就失效了。<br>5 proxy_cookie_domain google.com proxy.zerounix.com; 把 cookie 的作用域替换成我们的域名<br>6 proxy_pass <a href="http://google" target="_blank" rel="external">http://google</a>; 反向代理到 upstream google<br>7 proxy_set_header Accept-Encoding “”; 防止谷歌返回压缩的内容，因为压缩的内容我们无法作域名替换<br>8 proxy_set_header Accept-Language “zh-CN”;设置语言为中文<br>9 proxy_set_header Cookie “PREF=ID=047808f19f6de346:U=0f62f33dd8549d11:FF=2:LD=zh-CN:NW=1:TM=1325338577:LM=1332142444:GM=1:SG=2:S=rE0SyJh2w1IQ-Maw”; 这行很关键，传固定的 cookie 给谷歌，是为了禁止即时搜索，因为开启即时搜索无法替换内容。还有设置为新窗口打开网站，这个符合我们打开链接的习惯<br>10 sub_filter www.google.com proxy.zerounix.com当然是把谷歌的域名替换成我们的了，注意需要安装 nginx 的 sub_filter 模块(编译加上–with-http_sub_module参数)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/16/how-to-setup-reverse-proxy-by-nginx.html" data-id="civlqiucg00fnc15m1owg9hrp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/proxy/">proxy</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-support-https" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/16/nginx-support-https.html" class="article-date">
  <time datetime="2016-02-16T03:20:10.000Z" itemprop="datePublished">2016-02-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>►<a class="article-category-link" href="/categories/Web/Nginx/">Nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/16/nginx-support-https.html">通过HTTPS访问Web</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://ofc9x1ccn.bkt.clouddn.com/nginx/https_title.jpg" alt="HTTPS_Title"></p>
<h2 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>HTTPS 目前已经是所有重视隐私和安全性的网站的首选，例如国外的 Google、Facebook、Twitter，国内则是淘宝、百度、京东等都已都支持了全站 HTTPS，可以想象以下，如果一个网站没有加密，那么你的所有账户密码都是通过明文来传输，当涉及到隐私和金融问题，不加密是多么可怕的事情。</p>
<p>随着技术的发展，HTTPS 网站已不再是大型网站的专利，所有普通的个人站点和blog可以以自己动手搭建一个安全加密的网站。</p>
<h3 id="什么是-HTTPS、SSL-证书"><a href="#什么是-HTTPS、SSL-证书" class="headerlink" title="什么是 HTTPS、SSL 证书"></a>什么是 HTTPS、SSL 证书</h3><ul>
<li><p>HTTPS</p>
<blockquote>
<p>超文本传输安全协议（缩写：HTTPS，英语：Hypertext Transfer Protocol Secure）是超文本传输协议和 SSL/TLS 的组合，用以提供加密通讯及对网络服务器身份的鉴定。HTTPS 连接经常被用于万维网上的交易支付和企业信息系统中敏感信息的传输。HTTPS 不应与在 RFC 2660 中定义的安全超文本传输协议 （S-HTTP） 相混。</p>
</blockquote>
</li>
<li><p>SSL 证书</p>
</li>
</ul>
<p>SSL 证书是数字证书的一种，遵守 SSL 协议，使用 Secure Socket Layer 协议在浏览器和 Web 服务器之间建立一条安全通道，从而实现数据信息在客户端和服务器之间的加密传输，保证双方传递信息的安全性，不可被第三方窃听；用户可以通过服务器证书验证他所访问的网站是否真实可靠。</p>
<p>等多关于 HTTPS、SSl 证书的信息，请 Google.</p>
<h2 id="使用-OpenSSL-生成自签名证书"><a href="#使用-OpenSSL-生成自签名证书" class="headerlink" title="使用 OpenSSL 生成自签名证书"></a>使用 OpenSSL 生成自签名证书</h2><h3 id="制作-CA-证书"><a href="#制作-CA-证书" class="headerlink" title="制作 CA 证书"></a>制作 CA 证书</h3><ul>
<li>修改 CA 配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">vim /etc/pki/tls/openssl.conf</div><div class="line">[ CA_default ]</div><div class="line"></div><div class="line">dir             = /etc/pki/CA           # Where everything is kept</div><div class="line">certs           = $dir/certs            # Where the issued certs are kept</div><div class="line">crl_dir         = $dir/crl              # Where the issued crl are kept</div><div class="line">database        = $dir/index.txt        # database index file.</div><div class="line">#unique_subject = no                    # Set to &apos;no&apos; to allow creation of</div><div class="line">                                        # several ctificates with same subject.</div><div class="line">new_certs_dir   = $dir/newcerts         # default place for new certs.</div><div class="line"></div><div class="line">certificate     = $dir/cacert.pem       # The CA certificate</div><div class="line">serial          = $dir/serial           # The current serial number</div><div class="line">crlnumber       = $dir/crlnumber        # the current crl number</div><div class="line">                                        # must be commented out to leave a V1 CRL</div><div class="line">crl             = $dir/crl.pem          # The current CRL</div><div class="line">private_key     = $dir/private/cakey.pem# The private key</div><div class="line">RANDFILE        = $dir/private/.rand    # private random number file</div><div class="line"></div><div class="line"></div><div class="line">default_days    = 3650                   # how long to certify for</div><div class="line"></div><div class="line">[ policy_match ]</div><div class="line">countryName             = match</div><div class="line">stateOrProvinceName     = optional</div><div class="line">localityName            = optional</div><div class="line">organizationName        = optional</div><div class="line">organizationalUnitName  = optional</div><div class="line">commonName              = supplied</div><div class="line">emailAddress            = optional</div><div class="line"></div><div class="line"></div><div class="line">[ req_distinguished_name ]</div><div class="line">countryName                     = Country Name (2 letter code)</div><div class="line">countryName_default             = CN</div><div class="line">countryName_min                 = 2</div><div class="line">countryName_max                 = 2</div><div class="line"></div><div class="line"></div><div class="line">stateOrProvinceName             = State or Province Name (full name)</div><div class="line">stateOrProvinceName_default     = BJ</div></pre></td></tr></table></figure>
<ul>
<li>在 CA 目录下创建两个初始文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">touch index.txt serial</div><div class="line">echo 01 &gt; serial</div></pre></td></tr></table></figure>
<ul>
<li>生成根密钥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /etc/pki/CA/</div><div class="line">(umask 077; openssl genrsa -out private/cakey.pem 2048 )</div></pre></td></tr></table></figure>
<ul>
<li>生成根证书</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(umask 077;openssl req -new -x509 -key private/cakey.pem -out cacert.pem)</div></pre></td></tr></table></figure>
<p>会提示输入一些内容，因为是私有的，所以可以随便输入（之前修改的 openssl.cnf 会在这里呈现），最好记住能与后面保持一致。上面的自签证书 <code>cacert.pem</code> 应该生成在 <code>/etc/pki/CA</code> 下</p>
<h3 id="制作服务器证书"><a href="#制作服务器证书" class="headerlink" title="制作服务器证书"></a>制作服务器证书</h3><ul>
<li>生成服务器 ssl 密钥</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/local/nginx/ssl</div><div class="line">cd /usr/local/nginx/ssl</div><div class="line">openssl genrsa -out nginx.key 2048</div></pre></td></tr></table></figure>
<ul>
<li>为 ningx 生成证书签署请求</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 同样会提示输入一些内容，其它随便，除了 `Commone Name` 一定要是你要授予证书的服务器域名或主机名，challenge password 不填。</div><div class="line">openssl req -new -key nginx.key -out nginx.csr</div></pre></td></tr></table></figure>
<ul>
<li>用私有 CA 来签署证书</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">openssl ca -in nginx.csr -out nginx.crt</div><div class="line">Using configuration from /etc/pki/tls/openssl.cnf</div><div class="line">Check that the request matches the signature</div><div class="line">Signature ok</div><div class="line">Certificate Details:</div><div class="line">        Serial Number: 1 (0x1)</div><div class="line">        Validity</div><div class="line">            Not Before: Feb  5 07:17:48 2016 GMT</div><div class="line">            Not After : Feb  2 07:17:48 2026 GMT</div><div class="line">        Subject:</div><div class="line">            countryName               = CN</div><div class="line">            stateOrProvinceName       = BJ</div><div class="line">            localityName              = BJ</div><div class="line">            organizationName          = Default Company Ltd</div><div class="line">            commonName                = *.zerounix.com</div><div class="line">        X509v3 extensions:</div><div class="line">            X509v3 Basic Constraints: </div><div class="line">                CA:FALSE</div><div class="line">            Netscape Comment: </div><div class="line">                OpenSSL Generated Certificate</div><div class="line">            X509v3 Subject Key Identifier: </div><div class="line">                18:A2:A4:B8:69:03:23:FE:94:7C:D8:95:A8:B9:95:B6:E7:28:D7:58</div><div class="line">            X509v3 Authority Key Identifier: </div><div class="line">                keyid:0D:01:60:ED:AF:82:A6:DB:46:42:BB:D7:F5:BD:4C:22:B8:6E:9F:33</div><div class="line"></div><div class="line">Certificate is to be certified until Feb  2 07:17:48 2026 GMT (3650 days)</div><div class="line">Sign the certificate? [y/n]:y</div><div class="line"></div><div class="line"></div><div class="line">1 out of 1 certificate requests certified, commit? [y/n]y</div><div class="line">Write out database with 1 new entries</div><div class="line">Data Base Updated</div><div class="line"></div><div class="line">另外在极少数情况下，上面的命令生成的证书不能识别，试试下面的命令：</div><div class="line">openssl x509 -req -in server.csr -CA /etc/pki/CA/cacert.pem -CAkey /etc/pki/CA/private/cakey.pem -CAcreateserial -out server.crt</div></pre></td></tr></table></figure>
<p>上面签发过程其实默认使用了 <code>-cert cacert.pem -keyfile cakey.pem</code> ，这两个文件就是前两步生成的位于 <code>/etc/pki/CA</code> 下的根密钥和根证书。将生成的 crt 证书发回 nginx 服务器使用。</p>
<ul>
<li>精简上面的步骤如下</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/local/ngnix/ssl</div><div class="line">cd /usr/lcoal/nginx/ssl</div><div class="line">// 创建根证书私钥</div><div class="line">openssl genrsa -des3 -out ca.key 2048</div><div class="line">// 创建根证书 (这里 /C 表示国家 (Country)，只能是国家字母缩写，如 CN、US 等； /ST 表示州或者省 (State/Provice)； /L 表示城市或者地区(Locality)；/O 表示组织名 (Organization Name)；/OU 其他显示内容，一般会显示在颁发者这栏)</div><div class="line">openssl req -new -x509 -days 36500 -key ca.key -out ca.crt -subj &quot;/C=CN/ST=BeiJing/L=BeiJing/O=Your Company Name/OU=Your Root CA&quot;</div><div class="line">// 创建服务器 ssl 证书私钥</div><div class="line">openssl genrsa -des3 -out server.key 2048</div><div class="line">// 建立 SSL 证书( /O 字段内容必须与刚才的 CA 根证书相同；/CN 字段为公用名称 (Common Name) ，必须为网站的域名(不带 www)；/OU 字段最好也与为网站域名，当然选择其他名字也没关系)</div><div class="line">openssl req -new -key server.key -out server.csr -subj &quot;/C=CN/ST=BeiJing/L=BeiJing/O=Your Company Name/OU=zerounix.com/CN=zerounix.com&quot;</div><div class="line">// 准备</div><div class="line">mkdir demoCA</div><div class="line">cd demoCA</div><div class="line">mkdir newcerts</div><div class="line">touch index.txt</div><div class="line">echo &apos;01&apos; &gt; serial</div><div class="line">cd ..</div><div class="line">// 自签名证书</div><div class="line">openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile ca.key</div></pre></td></tr></table></figure>
<p>更为简单的步骤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openssl genrsa -des3 -out server.key 2048</div><div class="line">openssl req -new -key server.key -out server.csr</div></pre></td></tr></table></figure></p>
<h2 id="配置-Nginx-支持-SSL"><a href="#配置-Nginx-支持-SSL" class="headerlink" title="配置 Nginx 支持 SSL"></a>配置 Nginx 支持 SSL</h2><h3 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">    listen 443 ssl;</div><div class="line">    server_name www.zerounix.com;</div><div class="line">    root /data/website/www.zerounix.com;</div><div class="line">    charset utf-8;</div><div class="line">    index index.php index.html;</div><div class="line">    ssl on;                                                    // 开启 ssl 支持</div><div class="line">    ssl_certificate      /usr/local/nginx/ssl/nginx.crt;       // 证书位置</div><div class="line">    ssl_certificate_key  /usr/local/nginx/ssl/nginx.key;       // 私钥</div><div class="line">    ssl_session_timeout  5m;</div><div class="line">    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;                  // 指定密码为 openssl 支持的格式</div><div class="line">    ssl_ciphers         HIGH:!aNULL:!MD5;                      // 加密方法</div><div class="line">    ssl_prefer_server_ciphers on;</div><div class="line">    access_log  logs/www.zerounix.com_access.log access;</div><div class="line">    error_log   logs/www.zerounix.com_error.log;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        try_files $uri $uri/ /index.php$is_args$args;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    location ~ .*\.(php|php5)$ &#123;</div><div class="line">        #fastcgi_pass 127.0.0.1:9000;</div><div class="line">        fastcgi_pass   unix:/dev/shm/php-fpm.socket;</div><div class="line">        include        fastcgi.conf;</div><div class="line">        try_files $uri =404;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="通过第三方-SSL-签发机构签发SSL证书"><a href="#通过第三方-SSL-签发机构签发SSL证书" class="headerlink" title="通过第三方 SSL 签发机构签发SSL证书"></a>通过第三方 SSL 签发机构签发SSL证书</h2><h3 id="使用-OpenSSL-生成-SSL-Key-和-CSR"><a href="#使用-OpenSSL-生成-SSL-Key-和-CSR" class="headerlink" title="使用 OpenSSL 生成 SSL Key 和 CSR"></a>使用 OpenSSL 生成 SSL Key 和 CSR</h3><p>由于只有浏览器或者系统信赖的 CA 才可以让所有的访问者通畅的访问你的加密网站，而不是出现证书错误的提示。所以我们跳过自签证书的步骤，直接开始签署第三方可信任的 SSL 证书吧。<br>OpenSSL 在 Linux、OS X 等常规的系统下默认都安装了，因为一些安全问题，一般现在的第三方 SSL 证书签发机构都要求起码 2048 位的 RSA 加密的私钥。同时，普通的 SSL 证书认证分两种形式，一种是 DV（Domain Validated），还有一种是 OV （Organization Validated），前者只需要验证域名，后者需要验证你的组织或公司，在安全性方面，肯定是后者要好。无论你用 DV 还是 OV 生成私钥，都需要填写一些基本信息，这里我们假设如下：<br>域名，也称为 Common Name，因为特殊的证书不一定是域名：example.com</p>
<ul>
<li>组织或公司名字 （Organization）：Example, Inc.</li>
<li>部门（Department）：可以不填写，这里我们写 Web Security</li>
<li>城市（City）：Beijing</li>
<li>省份（State / Province）：Beijing</li>
<li>国家（Country）：CN</li>
<li>加密强度：2048 位，如果你的机器性能强劲，也可以选择 4096 位</li>
</ul>
<p>按照以上信息，使用 OpenSSL 生成 key 和 csr 的命令如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl req -new -newkey rsa:2048 -sha256 -nodes -out example_com.csr -keyout example_com.key -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=Example Inc./OU=Web Security/CN=example.com&quot;</div></pre></td></tr></table></figure></p>
<p>PS：如果是泛域名证书，则应该填写 <code>*.example.com</code><br>你可以在系统的任何地方运行这个命令，会自动在当前目录生成 example_com.csr 和 example_com.key 这两个文件<br>接下来你可以查看一下 example_com.csr，得到类似这么一长串的文字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">-----BEGIN CERTIFICATE REQUEST-----</div><div class="line">MIICujCCAaICAQAwdTELMAkGA1UEBhMCQ04xEDAOBgNVBAgTB0JlaWppbmcxEDAO  </div><div class="line">BgNVBAcTB0JlaWppbmcxFTATBgNVBAoTDEV4YW1wbGUgSW5jLjEVMBMGA1UECxMM  </div><div class="line">V2ViIFNlY3VyaXR5MRQwEgYDVQQDEwtleGFtcGxlLmNvbTCCASIwDQYJKoZIhvcN  </div><div class="line">AQEBBQADggEPADCCAQoCggEBAPME+nvVCdGN9VWn+vp7JkMoOdpOurYMPvclIbsI  </div><div class="line">iD7mGN982Ocl22O9wCV/4tL6DpTcXfNX+eWd7CNEKT4i+JYGqllqP3/CojhkemiY  </div><div class="line">SF3jwncvP6VoST/HsZeMyNB71XwYnxFCGqSyE3QjxmQ9ae38H2LIpCllfd1l7iVp  </div><div class="line">AX4i2+HvGTHFzb0XnmMLzq4HyVuEIMoYwiZX8hq+kwEAhKpBdfawkOcIRkbOlFew  </div><div class="line">SEjLyHY+nruXutmQx1d7lzZCxut5Sm5At9al0bf5FOaaJylTEwNEpFkP3L29GtoU  </div><div class="line">qg1t9Q8WufIfK9vXqQqwg8J1muK7kksnbYcoPnNgPx36kZsCAwEAAaAAMA0GCSqG  </div><div class="line">SIb3DQEBBQUAA4IBAQCHgIuhpcgrsNwDuW6731/DeVwq2x3ZRqRBuj9/M8oONQen  </div><div class="line">1QIacBifEMr+Ma+C+wIpt3bHvtXEF8cCAJAR9sQ4Svy7M0w25DwrwaWIjxcf/J8U  </div><div class="line">audL/029CkAuewFCdBILTRAAeDqxsAsUyiBIGTIT+uqi+EpGG4OlyKK/MF13FxDj  </div><div class="line">/oKyrSJDtp1Xr9R7iqGCs/Zl5qWmDaLN7/qxBK6vX2R/HLhOK0aKi1ZQ4cZeP7Mr</div><div class="line">8EzjDIAko87Nb/aIsFyKrt6Ze3jOF0/vnnpw7pMvhq+folWdTVXddjd9Dpr2x1nc  </div><div class="line">y5hnop4k6kVRXDjQ4OTduQq4P+SzU4hb41GIQEz4  </div><div class="line">-----END CERTIFICATE REQUEST-----</div></pre></td></tr></table></figure></p>
<p>这个 CSR 文件就是你需要提交给 SSL 认证机构的，当你的域名或组织通过验证后，认证机构就会颁发给你一个 example_com.crt</p>
<p>而 example_com.key 是需要用在 Nginx 配置里和 example_com.crt 配合使用的，需要好好保管，千万别泄露给任何第三方</p>
<h3 id="Nginx-配置-HTTPS-网站以及增加安全的配置"><a href="#Nginx-配置-HTTPS-网站以及增加安全的配置" class="headerlink" title="Nginx 配置 HTTPS 网站以及增加安全的配置"></a>Nginx 配置 HTTPS 网站以及增加安全的配置</h3><p>你需要提交 CSR 文件给第三方 SSL 认证机构，通过认证后，他们会颁发给你一个 CRT 文件，我们命名为 example_com.crt<br>同时，为了统一，你可以把这三个文件都移动到 /etc/ssl/private/ 目录。<br>然后可以修改 Nginx 配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">server &#123;  </div><div class="line">    listen 80;</div><div class="line">    listen [::]:80 ssl ipv6only=on; </div><div class="line">    listen 443 ssl;</div><div class="line">    listen [::]:443 ssl ipv6only=on;</div><div class="line">    server_name example.com;</div><div class="line"></div><div class="line">    ssl on;</div><div class="line">    ssl_certificate /etc/ssl/private/example_com.crt;</div><div class="line">    ssl_certificate_key /etc/ssl/private/example_com.key;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>检测配置文件没问题后重新读取 Nginx 即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx -t &amp;&amp; nginx -s reload</div></pre></td></tr></table></figure></p>
<p>但是这么做并不安全，默认是 SHA-1 形式，而现在主流的方案应该都避免 SHA-1，为了确保更强的安全性，我们可以采取迪菲－赫尔曼密钥交换</p>
<p>首先，进入 /etc/ssl/certs 目录并生成一个 dhparam.pem<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /etc/ssl/certs  </div><div class="line">openssl dhparam -out dhparam.pem 2048 # 如果你的机器性能足够强大，可以用 4096 位加密</div></pre></td></tr></table></figure></p>
<p>生成完毕后，在 Nginx 的 SSL 配置后面加入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ssl_prefer_server_ciphers on;</div><div class="line">ssl_dhparam /etc/ssl/certs/dhparam.pem;</div><div class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</div><div class="line">ssl_ciphers &quot;EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4&quot;;</div><div class="line">keepalive_timeout 70;</div><div class="line">ssl_session_cache shared:SSL:10m;</div><div class="line">ssl_session_timeout 10m;</div></pre></td></tr></table></figure></p>
<p>同时，如果是全站 HTTPS 并且不考虑 HTTP 的话，可以加入 HSTS 告诉你的浏览器本网站全站加密，并且强制用 HTTPS 访问<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">add_header Strict-Transport-Security max-age=63072000;</div><div class="line">add_header X-Frame-Options DENY;</div><div class="line">add_header X-Content-Type-Options nosniff;</div></pre></td></tr></table></figure></p>
<p>同时也可以单独开一个 Nginx 配置，把 HTTP 的访问请求都用 301 跳转到 HTTPS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">server &#123;  </div><div class="line">        listen 80;</div><div class="line">        listen [::]:80 ipv6only=on;</div><div class="line">        server_name     example.com;</div><div class="line">        return 301 http://example.com$request_uri;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="可靠的第三方-SSL-签发机构"><a href="#可靠的第三方-SSL-签发机构" class="headerlink" title="可靠的第三方 SSL 签发机构"></a>可靠的第三方 SSL 签发机构</h3><p>众所周知，前段时间某 NIC 机构爆出过针对 Google 域名的证书签发的丑闻，所以可见选择一家靠谱的第三方 SSL 签发机构是多么的重要。</p>
<p>目前一般市面上针对中小站长和企业的 SSL 证书颁发机构有：</p>
<p><a href="http://www.startssl.com/" target="_blank" rel="external">StartSSL</a></p>
<p><a href="http://www.comodo.com/" target="_blank" rel="external">Comodo</a> / 子品牌 <a href="http://www.positivessl.com/" target="_blank" rel="external">Positive SSL</a></p>
<p><a href="http://www.globalsign.com/en/" target="_blank" rel="external">GlobalSign</a> / 子品牌<a href="http://www.alphassl.com/" target="_blank" rel="external">AlphaSSL</a></p>
<p><a href="http://www.geotrust.com/" target="_blank" rel="external">GeoTrust</a> / 子品牌 <a href="http://www.rapidssl.com/" target="_blank" rel="external">RapidSSL</a></p>
<p>其中 Postivie SSL、AlphaSSL、RapidSSL 等都是子品牌，一般都是三级四级证书，所以你会需要增加 CA 证书链到你的 CRT 文件里。</p>
<p>以 Comodo Positive SSL 为例，需要串联 CA 证书，假设你的域名是 example.com</p>
<p>那么，串联的命令是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat example_com.crt COMODORSADomainValidationSecureServerCA.crt COMODORSAAddTrustCA.crt AddTrustExternalCARoot.crt &gt; example_com.signed.crt</div></pre></td></tr></table></figure></p>
<p>在 Nginx 配置里使用 example_com.signed.crt 即可</p>
<p>如果是一般常见的 AplhaSSL 泛域名证书，他们是不会发给你 CA 证书链的，那么在你的 CRT 文件后面需要加入 AlphaSSL 的 CA 证书链</p>
<p><a href="http://www.alphassl.com/support/install-root-certificate.html" target="_blank" rel="external">AlphaSSL Intermediate CA</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://czero000.github.io/2016/02/16/nginx-support-https.html" data-id="civlqiud900gmc15mypvzmn76" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/https/">https</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/8/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Database/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/Redis/">Redis</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/">System</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/System/Bash/">Bash</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/CentOS/">CentOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Command/">Command</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/DNS/">DNS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Debian/">Debian</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Gitlab/">Gitlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/IPTABLES/">IPTABLES</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/L2TP/">L2TP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Monitor/">Monitor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/NFS/">NFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Other/">Other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Proxy/">Proxy</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/RRDTOOL/">RRDTOOL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/System/Security/">Security</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web/Apache/">Apache</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/Nginx/">Nginx</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化/">虚拟化</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/虚拟化/KVM/">KVM</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/">运维技术</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/ELK/">ELK</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/GlusterFS/">GlusterFS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维技术/MooseFS/">MooseFS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/">运维自动化</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/Ansible/">Ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/Cobbler/">Cobbler</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维自动化/SaltStack/">SaltStack</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/">Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP状态码/">HTTP状态码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MooseFS/">MooseFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache/">apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bind/">bind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cacti/">cacti</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos/">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chinese/">chinese</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chromium/">chromium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cobbler/">cobbler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/">curl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debian/">debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/download/">download</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dropbox/">dropbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch-elk/">elasticsearch.elk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elk/">elk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/em1/">em1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/epel/">epel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eth0/">eth0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fishshell/">fishshell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitlab/">gitlab</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gitolite/">gitolite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glances/">glances</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glibc/">glibc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glusterfs/">glusterfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iftop/">iftop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inotify/">inotify</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kibana/">kibana</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kvm/">kvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/l2tp/">l2tp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrotate/">logrotate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash/">logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logstash-forwarder/">logstash-forwarder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/megacli/">megacli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mindmap/">mindmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/monitor/">monitor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mycli/">mycli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nfs/">nfs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-vim/">nginx.vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ntp/">ntp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openssl/">openssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/parted/">parted</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/passwd/">passwd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php-fpm/">php-fpm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pptp/">pptp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proxy/">proxy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raid/">raid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rrdtool/">rrdtool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saltstack/">saltstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/servicewrapper/">servicewrapper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsocks/">shadowsocks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/smokeping/">smokeping</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socks5/">socks5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ss5/">ss5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/transmission/">transmission</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/virsh/">virsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vncserver/">vncserver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xz/">xz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yum/">yum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书写指南/">书写指南</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Blog/" style="font-size: 10px;">Blog</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/HTTP状态码/" style="font-size: 10px;">HTTP状态码</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/MooseFS/" style="font-size: 10px;">MooseFS</a> <a href="/tags/ansible/" style="font-size: 17.5px;">ansible</a> <a href="/tags/apache/" style="font-size: 10px;">apache</a> <a href="/tags/awk/" style="font-size: 11.25px;">awk</a> <a href="/tags/bash/" style="font-size: 18.75px;">bash</a> <a href="/tags/bind/" style="font-size: 11.25px;">bind</a> <a href="/tags/cacti/" style="font-size: 10px;">cacti</a> <a href="/tags/centos/" style="font-size: 12.5px;">centos</a> <a href="/tags/chinese/" style="font-size: 11.25px;">chinese</a> <a href="/tags/chromium/" style="font-size: 10px;">chromium</a> <a href="/tags/cobbler/" style="font-size: 11.25px;">cobbler</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/debian/" style="font-size: 10px;">debian</a> <a href="/tags/docker/" style="font-size: 12.5px;">docker</a> <a href="/tags/download/" style="font-size: 10px;">download</a> <a href="/tags/dropbox/" style="font-size: 10px;">dropbox</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/elasticsearch-elk/" style="font-size: 10px;">elasticsearch.elk</a> <a href="/tags/elk/" style="font-size: 12.5px;">elk</a> <a href="/tags/em1/" style="font-size: 10px;">em1</a> <a href="/tags/epel/" style="font-size: 10px;">epel</a> <a href="/tags/eth0/" style="font-size: 10px;">eth0</a> <a href="/tags/fishshell/" style="font-size: 10px;">fishshell</a> <a href="/tags/git/" style="font-size: 13.75px;">git</a> <a href="/tags/gitlab/" style="font-size: 10px;">gitlab</a> <a href="/tags/gitolite/" style="font-size: 10px;">gitolite</a> <a href="/tags/glances/" style="font-size: 10px;">glances</a> <a href="/tags/glibc/" style="font-size: 10px;">glibc</a> <a href="/tags/glusterfs/" style="font-size: 12.5px;">glusterfs</a> <a href="/tags/gpt/" style="font-size: 10px;">gpt</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/iftop/" style="font-size: 10px;">iftop</a> <a href="/tags/inotify/" style="font-size: 11.25px;">inotify</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/kibana/" style="font-size: 10px;">kibana</a> <a href="/tags/kvm/" style="font-size: 10px;">kvm</a> <a href="/tags/l2tp/" style="font-size: 10px;">l2tp</a> <a href="/tags/logrotate/" style="font-size: 10px;">logrotate</a> <a href="/tags/logstash/" style="font-size: 11.25px;">logstash</a> <a href="/tags/logstash-forwarder/" style="font-size: 10px;">logstash-forwarder</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/megacli/" style="font-size: 11.25px;">megacli</a> <a href="/tags/mindmap/" style="font-size: 11.25px;">mindmap</a> <a href="/tags/monitor/" style="font-size: 15px;">monitor</a> <a href="/tags/mycli/" style="font-size: 10px;">mycli</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nfs/" style="font-size: 10px;">nfs</a> <a href="/tags/nginx/" style="font-size: 20px;">nginx</a> <a href="/tags/nginx-vim/" style="font-size: 10px;">nginx.vim</a> <a href="/tags/ntp/" style="font-size: 10px;">ntp</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/parted/" style="font-size: 10px;">parted</a> <a href="/tags/passwd/" style="font-size: 10px;">passwd</a> <a href="/tags/php/" style="font-size: 10px;">php</a> <a href="/tags/php-fpm/" style="font-size: 10px;">php-fpm</a> <a href="/tags/pptp/" style="font-size: 11.25px;">pptp</a> <a href="/tags/proxy/" style="font-size: 15px;">proxy</a> <a href="/tags/python/" style="font-size: 12.5px;">python</a> <a href="/tags/raid/" style="font-size: 10px;">raid</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/rrdtool/" style="font-size: 10px;">rrdtool</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/saltstack/" style="font-size: 16.25px;">saltstack</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/servicewrapper/" style="font-size: 10px;">servicewrapper</a> <a href="/tags/shadowsocks/" style="font-size: 10px;">shadowsocks</a> <a href="/tags/smokeping/" style="font-size: 13.75px;">smokeping</a> <a href="/tags/socks5/" style="font-size: 11.25px;">socks5</a> <a href="/tags/ss5/" style="font-size: 10px;">ss5</a> <a href="/tags/transmission/" style="font-size: 10px;">transmission</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/virsh/" style="font-size: 10px;">virsh</a> <a href="/tags/vncserver/" style="font-size: 10px;">vncserver</a> <a href="/tags/xz/" style="font-size: 10px;">xz</a> <a href="/tags/yum/" style="font-size: 10px;">yum</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a> <a href="/tags/书写指南/" style="font-size: 10px;">书写指南</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/17/Git-basic.html">Git基础</a>
          </li>
        
          <li>
            <a href="/2016/10/26/ansible-managment-windows.html">使用ansible管理windows主机</a>
          </li>
        
          <li>
            <a href="/2016/10/20/git-different-sshkey.html">配置不同ssh-key访问不同git仓库</a>
          </li>
        
          <li>
            <a href="/2016/10/20/l2tp-vpn.html">IPsec和L2TP搭建VPN</a>
          </li>
        
          <li>
            <a href="/2016/10/20/ansible-dynamic-create-vhost.html">通过jinja2生成虚拟主机配置</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 C.c<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>